ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 1


   1              		.syntax unified
   2              		.cpu cortex-m4
   3              		.eabi_attribute 27, 1
   4              		.eabi_attribute 28, 1
   5              		.fpu fpv4-sp-d16
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.thumb
  16              		.syntax unified
  17              		.file	"usb_core.c"
  18              		.text
  19              	.Ltext0:
  20              		.cfi_sections	.debug_frame
  21              		.section	.text.USB_OTG_EnableCommonInt,"ax",%progbits
  22              		.align	2
  23              		.thumb
  24              		.thumb_func
  26              	USB_OTG_EnableCommonInt:
  27              	.LFB124:
  28              		.file 1 "USB/core/usb_core.c"
   1:USB/core/usb_core.c **** /**
   2:USB/core/usb_core.c ****   ******************************************************************************
   3:USB/core/usb_core.c ****   * @file    usb_core.c
   4:USB/core/usb_core.c ****   * @author  MCD Application Team
   5:USB/core/usb_core.c ****   * @version V2.1.0
   6:USB/core/usb_core.c ****   * @date    19-March-2012
   7:USB/core/usb_core.c ****   * @brief   USB-OTG Core Layer
   8:USB/core/usb_core.c ****   ******************************************************************************
   9:USB/core/usb_core.c ****   * @attention
  10:USB/core/usb_core.c ****   *
  11:USB/core/usb_core.c ****   * <h2><center>&copy; COPYRIGHT 2012 STMicroelectronics</center></h2>
  12:USB/core/usb_core.c ****   *
  13:USB/core/usb_core.c ****   * Licensed under MCD-ST Liberty SW License Agreement V2, (the "License");
  14:USB/core/usb_core.c ****   * You may not use this file except in compliance with the License.
  15:USB/core/usb_core.c ****   * You may obtain a copy of the License at:
  16:USB/core/usb_core.c ****   *
  17:USB/core/usb_core.c ****   *        http://www.st.com/software_license_agreement_liberty_v2
  18:USB/core/usb_core.c ****   *
  19:USB/core/usb_core.c ****   * Unless required by applicable law or agreed to in writing, software 
  20:USB/core/usb_core.c ****   * distributed under the License is distributed on an "AS IS" BASIS, 
  21:USB/core/usb_core.c ****   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  22:USB/core/usb_core.c ****   * See the License for the specific language governing permissions and
  23:USB/core/usb_core.c ****   * limitations under the License.
  24:USB/core/usb_core.c ****   *
  25:USB/core/usb_core.c ****   ******************************************************************************
  26:USB/core/usb_core.c ****   */
  27:USB/core/usb_core.c **** 
  28:USB/core/usb_core.c **** /* Includes ------------------------------------------------------------------*/
  29:USB/core/usb_core.c **** #include "usb_core.h"
  30:USB/core/usb_core.c **** #include "usb_bsp.h"
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 2


  31:USB/core/usb_core.c **** 
  32:USB/core/usb_core.c **** 
  33:USB/core/usb_core.c **** /** @addtogroup USB_OTG_DRIVER
  34:USB/core/usb_core.c **** * @{
  35:USB/core/usb_core.c **** */
  36:USB/core/usb_core.c **** 
  37:USB/core/usb_core.c **** /** @defgroup USB_CORE 
  38:USB/core/usb_core.c **** * @brief This file includes the USB-OTG Core Layer
  39:USB/core/usb_core.c **** * @{
  40:USB/core/usb_core.c **** */
  41:USB/core/usb_core.c **** 
  42:USB/core/usb_core.c **** 
  43:USB/core/usb_core.c **** /** @defgroup USB_CORE_Private_Defines
  44:USB/core/usb_core.c **** * @{
  45:USB/core/usb_core.c **** */ 
  46:USB/core/usb_core.c **** 
  47:USB/core/usb_core.c **** /**
  48:USB/core/usb_core.c **** * @}
  49:USB/core/usb_core.c **** */ 
  50:USB/core/usb_core.c **** 
  51:USB/core/usb_core.c **** 
  52:USB/core/usb_core.c **** /** @defgroup USB_CORE_Private_TypesDefinitions
  53:USB/core/usb_core.c **** * @{
  54:USB/core/usb_core.c **** */ 
  55:USB/core/usb_core.c **** /**
  56:USB/core/usb_core.c **** * @}
  57:USB/core/usb_core.c **** */ 
  58:USB/core/usb_core.c **** 
  59:USB/core/usb_core.c **** 
  60:USB/core/usb_core.c **** 
  61:USB/core/usb_core.c **** /** @defgroup USB_CORE_Private_Macros
  62:USB/core/usb_core.c **** * @{
  63:USB/core/usb_core.c **** */ 
  64:USB/core/usb_core.c **** /**
  65:USB/core/usb_core.c **** * @}
  66:USB/core/usb_core.c **** */ 
  67:USB/core/usb_core.c **** 
  68:USB/core/usb_core.c **** 
  69:USB/core/usb_core.c **** /** @defgroup USB_CORE_Private_Variables
  70:USB/core/usb_core.c **** * @{
  71:USB/core/usb_core.c **** */ 
  72:USB/core/usb_core.c **** /**
  73:USB/core/usb_core.c **** * @}
  74:USB/core/usb_core.c **** */ 
  75:USB/core/usb_core.c **** 
  76:USB/core/usb_core.c **** 
  77:USB/core/usb_core.c **** /** @defgroup USB_CORE_Private_FunctionPrototypes
  78:USB/core/usb_core.c **** * @{
  79:USB/core/usb_core.c **** */ 
  80:USB/core/usb_core.c **** /**
  81:USB/core/usb_core.c **** * @}
  82:USB/core/usb_core.c **** */ 
  83:USB/core/usb_core.c **** 
  84:USB/core/usb_core.c **** 
  85:USB/core/usb_core.c **** /** @defgroup USB_CORE_Private_Functions
  86:USB/core/usb_core.c **** * @{
  87:USB/core/usb_core.c **** */ 
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 3


  88:USB/core/usb_core.c **** 
  89:USB/core/usb_core.c **** /**
  90:USB/core/usb_core.c **** * @brief  USB_OTG_EnableCommonInt
  91:USB/core/usb_core.c **** *         Initializes the commmon interrupts, used in both device and modes
  92:USB/core/usb_core.c **** * @param  pdev : Selected device
  93:USB/core/usb_core.c **** * @retval None
  94:USB/core/usb_core.c **** */
  95:USB/core/usb_core.c **** static void USB_OTG_EnableCommonInt(USB_OTG_CORE_HANDLE *pdev)
  96:USB/core/usb_core.c **** {
  29              		.loc 1 96 0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		@ link register save eliminated.
  34              	.LVL0:
  97:USB/core/usb_core.c ****   USB_OTG_GINTMSK_TypeDef  int_mask;
  98:USB/core/usb_core.c ****   
  99:USB/core/usb_core.c ****   int_mask.d32 = 0;
 100:USB/core/usb_core.c ****   /* Clear any pending USB_OTG Interrupts */
 101:USB/core/usb_core.c **** #ifndef USE_OTG_MODE
 102:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.GREGS->GOTGINT, 0xFFFFFFFF);
  35              		.loc 1 102 0
  36 0000 C368     		ldr	r3, [r0, #12]
  37 0002 4FF0FF32 		mov	r2, #-1
  38 0006 5A60     		str	r2, [r3, #4]
 103:USB/core/usb_core.c **** #endif
 104:USB/core/usb_core.c ****   /* Clear any pending interrupts */
 105:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.GREGS->GINTSTS, 0xBFFFFFFF);
  39              		.loc 1 105 0
  40 0008 C368     		ldr	r3, [r0, #12]
  41 000a 6FF08042 		mvn	r2, #1073741824
  42 000e 5A61     		str	r2, [r3, #20]
 106:USB/core/usb_core.c ****   /* Enable the interrupts in the INTMSK */
 107:USB/core/usb_core.c ****   int_mask.b.wkupintr = 1;
 108:USB/core/usb_core.c ****   int_mask.b.usbsuspend = 1; 
  43              		.loc 1 108 0
  44 0010 014B     		ldr	r3, .L2
  45              	.LVL1:
 109:USB/core/usb_core.c ****   
 110:USB/core/usb_core.c **** #ifdef USE_OTG_MODE
 111:USB/core/usb_core.c ****   int_mask.b.otgintr = 1;
 112:USB/core/usb_core.c ****   int_mask.b.sessreqintr = 1;
 113:USB/core/usb_core.c ****   int_mask.b.conidstschng = 1;
 114:USB/core/usb_core.c **** #endif
 115:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.GREGS->GINTMSK, int_mask.d32);
  46              		.loc 1 115 0
  47 0012 C268     		ldr	r2, [r0, #12]
  48              	.LVL2:
  49 0014 9361     		str	r3, [r2, #24]
  50 0016 7047     		bx	lr
  51              	.L3:
  52              		.align	2
  53              	.L2:
  54 0018 00080080 		.word	-2147481600
  55              		.cfi_endproc
  56              	.LFE124:
  58              		.section	.text.USB_OTG_CoreReset,"ax",%progbits
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 4


  59              		.align	2
  60              		.thumb
  61              		.thumb_func
  63              	USB_OTG_CoreReset:
  64              	.LFB125:
 116:USB/core/usb_core.c **** }
 117:USB/core/usb_core.c **** 
 118:USB/core/usb_core.c **** /**
 119:USB/core/usb_core.c **** * @brief  USB_OTG_CoreReset : Soft reset of the core
 120:USB/core/usb_core.c **** * @param  pdev : Selected device
 121:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 122:USB/core/usb_core.c **** */
 123:USB/core/usb_core.c **** static USB_OTG_STS USB_OTG_CoreReset(USB_OTG_CORE_HANDLE *pdev)
 124:USB/core/usb_core.c **** {
  65              		.loc 1 124 0
  66              		.cfi_startproc
  67              		@ args = 0, pretend = 0, frame = 8
  68              		@ frame_needed = 0, uses_anonymous_args = 0
  69              	.LVL3:
  70 0000 30B5     		push	{r4, r5, lr}
  71              	.LCFI0:
  72              		.cfi_def_cfa_offset 12
  73              		.cfi_offset 4, -12
  74              		.cfi_offset 5, -8
  75              		.cfi_offset 14, -4
  76 0002 83B0     		sub	sp, sp, #12
  77              	.LCFI1:
  78              		.cfi_def_cfa_offset 24
  79 0004 0546     		mov	r5, r0
  80              	.LVL4:
 125:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 126:USB/core/usb_core.c ****   __IO USB_OTG_GRSTCTL_TypeDef  greset;
 127:USB/core/usb_core.c ****   uint32_t count = 0;
 128:USB/core/usb_core.c ****   
 129:USB/core/usb_core.c ****   greset.d32 = 0;
  81              		.loc 1 129 0
  82 0006 0024     		movs	r4, #0
  83 0008 0194     		str	r4, [sp, #4]
  84              	.LVL5:
  85              	.L6:
 130:USB/core/usb_core.c ****   /* Wait for AHB master IDLE state. */
 131:USB/core/usb_core.c ****   do
 132:USB/core/usb_core.c ****   {
 133:USB/core/usb_core.c ****     USB_OTG_BSP_uDelay(3);
  86              		.loc 1 133 0
  87 000a 0320     		movs	r0, #3
  88 000c FFF7FEFF 		bl	USB_OTG_BSP_uDelay
  89              	.LVL6:
 134:USB/core/usb_core.c ****     greset.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->GRSTCTL);
  90              		.loc 1 134 0
  91 0010 EB68     		ldr	r3, [r5, #12]
  92 0012 1A69     		ldr	r2, [r3, #16]
  93 0014 0192     		str	r2, [sp, #4]
 135:USB/core/usb_core.c ****     if (++count > 200000)
  94              		.loc 1 135 0
  95 0016 0134     		adds	r4, r4, #1
  96              	.LVL7:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 5


  97 0018 0E4A     		ldr	r2, .L10
  98 001a 9442     		cmp	r4, r2
  99 001c 17D8     		bhi	.L5
 136:USB/core/usb_core.c ****     {
 137:USB/core/usb_core.c ****       return USB_OTG_OK;
 138:USB/core/usb_core.c ****     }
 139:USB/core/usb_core.c ****   }
 140:USB/core/usb_core.c ****   while (greset.b.ahbidle == 0);
 100              		.loc 1 140 0
 101 001e 019A     		ldr	r2, [sp, #4]
 102 0020 002A     		cmp	r2, #0
 103 0022 F2DA     		bge	.L6
 104              	.LVL8:
 141:USB/core/usb_core.c ****   /* Core Soft Reset */
 142:USB/core/usb_core.c ****   count = 0;
 143:USB/core/usb_core.c ****   greset.b.csftrst = 1;
 105              		.loc 1 143 0
 106 0024 019A     		ldr	r2, [sp, #4]
 107 0026 42F00102 		orr	r2, r2, #1
 108 002a 0192     		str	r2, [sp, #4]
 144:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GRSTCTL, greset.d32 );
 109              		.loc 1 144 0
 110 002c 019A     		ldr	r2, [sp, #4]
 111 002e 1A61     		str	r2, [r3, #16]
 142:USB/core/usb_core.c ****   greset.b.csftrst = 1;
 112              		.loc 1 142 0
 113 0030 0023     		movs	r3, #0
 114              	.LVL9:
 115              	.L8:
 145:USB/core/usb_core.c ****   do
 146:USB/core/usb_core.c ****   {
 147:USB/core/usb_core.c ****     greset.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->GRSTCTL);
 116              		.loc 1 147 0
 117 0032 EA68     		ldr	r2, [r5, #12]
 118 0034 1269     		ldr	r2, [r2, #16]
 119 0036 0192     		str	r2, [sp, #4]
 148:USB/core/usb_core.c ****     if (++count > 200000)
 120              		.loc 1 148 0
 121 0038 0133     		adds	r3, r3, #1
 122              	.LVL10:
 123 003a 064A     		ldr	r2, .L10
 124 003c 9342     		cmp	r3, r2
 125 003e 03D8     		bhi	.L7
 149:USB/core/usb_core.c ****     {
 150:USB/core/usb_core.c ****       break;
 151:USB/core/usb_core.c ****     }
 152:USB/core/usb_core.c ****   }
 153:USB/core/usb_core.c ****   while (greset.b.csftrst == 1);
 126              		.loc 1 153 0
 127 0040 019A     		ldr	r2, [sp, #4]
 128 0042 12F0010F 		tst	r2, #1
 129 0046 F4D1     		bne	.L8
 130              	.L7:
 154:USB/core/usb_core.c ****   /* Wait for 3 PHY Clocks*/
 155:USB/core/usb_core.c ****   USB_OTG_BSP_uDelay(3);
 131              		.loc 1 155 0
 132 0048 0320     		movs	r0, #3
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 6


 133 004a FFF7FEFF 		bl	USB_OTG_BSP_uDelay
 134              	.LVL11:
 135              	.L5:
 156:USB/core/usb_core.c ****   return status;
 157:USB/core/usb_core.c **** }
 136              		.loc 1 157 0
 137 004e 0020     		movs	r0, #0
 138 0050 03B0     		add	sp, sp, #12
 139              	.LCFI2:
 140              		.cfi_def_cfa_offset 12
 141              		@ sp needed
 142 0052 30BD     		pop	{r4, r5, pc}
 143              	.LVL12:
 144              	.L11:
 145              		.align	2
 146              	.L10:
 147 0054 400D0300 		.word	200000
 148              		.cfi_endproc
 149              	.LFE125:
 151              		.section	.text.USB_OTG_WritePacket,"ax",%progbits
 152              		.align	2
 153              		.global	USB_OTG_WritePacket
 154              		.thumb
 155              		.thumb_func
 157              	USB_OTG_WritePacket:
 158              	.LFB126:
 158:USB/core/usb_core.c **** 
 159:USB/core/usb_core.c **** /**
 160:USB/core/usb_core.c **** * @brief  USB_OTG_WritePacket : Writes a packet into the Tx FIFO associated 
 161:USB/core/usb_core.c **** *         with the EP
 162:USB/core/usb_core.c **** * @param  pdev : Selected device
 163:USB/core/usb_core.c **** * @param  src : source pointer
 164:USB/core/usb_core.c **** * @param  ch_ep_num : end point number
 165:USB/core/usb_core.c **** * @param  bytes : No. of bytes
 166:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 167:USB/core/usb_core.c **** */
 168:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_WritePacket(USB_OTG_CORE_HANDLE *pdev, 
 169:USB/core/usb_core.c ****                                 uint8_t             *src, 
 170:USB/core/usb_core.c ****                                 uint8_t             ch_ep_num, 
 171:USB/core/usb_core.c ****                                 uint16_t            len)
 172:USB/core/usb_core.c **** {
 159              		.loc 1 172 0
 160              		.cfi_startproc
 161              		@ args = 0, pretend = 0, frame = 0
 162              		@ frame_needed = 0, uses_anonymous_args = 0
 163              		@ link register save eliminated.
 164              	.LVL13:
 165 0000 10B4     		push	{r4}
 166              	.LCFI3:
 167              		.cfi_def_cfa_offset 4
 168              		.cfi_offset 4, -4
 169              	.LVL14:
 173:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 174:USB/core/usb_core.c ****   if (pdev->cfg.dma_enable == 0)
 170              		.loc 1 174 0
 171 0002 C478     		ldrb	r4, [r0, #3]	@ zero_extendqisi2
 172 0004 6CB9     		cbnz	r4, .L13
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 7


 173              	.LVL15:
 174              	.LBB2:
 175:USB/core/usb_core.c ****   {
 176:USB/core/usb_core.c ****     uint32_t count32b= 0 , i= 0;
 177:USB/core/usb_core.c ****     __IO uint32_t *fifo;
 178:USB/core/usb_core.c ****     
 179:USB/core/usb_core.c ****     count32b =  (len + 3) / 4;
 175              		.loc 1 179 0
 176 0006 0333     		adds	r3, r3, #3
 177              	.LVL16:
 178 0008 9B10     		asrs	r3, r3, #2
 179              	.LVL17:
 180:USB/core/usb_core.c ****     fifo = pdev->regs.DFIFO[ch_ep_num];
 180              		.loc 1 180 0
 181 000a 3232     		adds	r2, r2, #50
 182              	.LVL18:
 183 000c 00EB8200 		add	r0, r0, r2, lsl #2
 184              	.LVL19:
 185 0010 8468     		ldr	r4, [r0, #8]
 186              	.LVL20:
 181:USB/core/usb_core.c ****     for (i = 0; i < count32b; i++, src+=4)
 187              		.loc 1 181 0
 188 0012 0022     		movs	r2, #0
 189 0014 03E0     		b	.L15
 190              	.LVL21:
 191              	.L16:
 182:USB/core/usb_core.c ****     {
 183:USB/core/usb_core.c ****       USB_OTG_WRITE_REG32( fifo, *((__packed uint32_t *)src) );
 192              		.loc 1 183 0 discriminator 3
 193 0016 51F8040B 		ldr	r0, [r1], #4
 194              	.LVL22:
 195 001a 2060     		str	r0, [r4]
 181:USB/core/usb_core.c ****     for (i = 0; i < count32b; i++, src+=4)
 196              		.loc 1 181 0 discriminator 3
 197 001c 0132     		adds	r2, r2, #1
 198              	.LVL23:
 199              	.L15:
 181:USB/core/usb_core.c ****     for (i = 0; i < count32b; i++, src+=4)
 200              		.loc 1 181 0 is_stmt 0 discriminator 1
 201 001e 9A42     		cmp	r2, r3
 202 0020 F9D3     		bcc	.L16
 203              	.LVL24:
 204              	.L13:
 205              	.LBE2:
 184:USB/core/usb_core.c ****     }
 185:USB/core/usb_core.c ****   }
 186:USB/core/usb_core.c ****   return status;
 187:USB/core/usb_core.c **** }
 206              		.loc 1 187 0 is_stmt 1
 207 0022 0020     		movs	r0, #0
 208 0024 5DF8044B 		ldr	r4, [sp], #4
 209              	.LCFI4:
 210              		.cfi_restore 4
 211              		.cfi_def_cfa_offset 0
 212 0028 7047     		bx	lr
 213              		.cfi_endproc
 214              	.LFE126:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 8


 216 002a 00BF     		.section	.text.USB_OTG_ReadPacket,"ax",%progbits
 217              		.align	2
 218              		.global	USB_OTG_ReadPacket
 219              		.thumb
 220              		.thumb_func
 222              	USB_OTG_ReadPacket:
 223              	.LFB127:
 188:USB/core/usb_core.c **** 
 189:USB/core/usb_core.c **** 
 190:USB/core/usb_core.c **** /**
 191:USB/core/usb_core.c **** * @brief  USB_OTG_ReadPacket : Reads a packet from the Rx FIFO
 192:USB/core/usb_core.c **** * @param  pdev : Selected device
 193:USB/core/usb_core.c **** * @param  dest : Destination Pointer
 194:USB/core/usb_core.c **** * @param  bytes : No. of bytes
 195:USB/core/usb_core.c **** * @retval None
 196:USB/core/usb_core.c **** */
 197:USB/core/usb_core.c **** void *USB_OTG_ReadPacket(USB_OTG_CORE_HANDLE *pdev, 
 198:USB/core/usb_core.c ****                          uint8_t *dest, 
 199:USB/core/usb_core.c ****                          uint16_t len)
 200:USB/core/usb_core.c **** {
 224              		.loc 1 200 0
 225              		.cfi_startproc
 226              		@ args = 0, pretend = 0, frame = 0
 227              		@ frame_needed = 0, uses_anonymous_args = 0
 228              		@ link register save eliminated.
 229              	.LVL25:
 230 0000 10B4     		push	{r4}
 231              	.LCFI5:
 232              		.cfi_def_cfa_offset 4
 233              		.cfi_offset 4, -4
 234              	.LVL26:
 201:USB/core/usb_core.c ****   uint32_t i=0;
 202:USB/core/usb_core.c ****   uint32_t count32b = (len + 3) / 4;
 235              		.loc 1 202 0
 236 0002 0332     		adds	r2, r2, #3
 237              	.LVL27:
 238 0004 9210     		asrs	r2, r2, #2
 239              	.LVL28:
 203:USB/core/usb_core.c ****   
 204:USB/core/usb_core.c ****   __IO uint32_t *fifo = pdev->regs.DFIFO[0];
 240              		.loc 1 204 0
 241 0006 D0F8D040 		ldr	r4, [r0, #208]
 242              	.LVL29:
 205:USB/core/usb_core.c ****   
 206:USB/core/usb_core.c ****   for ( i = 0; i < count32b; i++, dest += 4 )
 243              		.loc 1 206 0
 244 000a 0023     		movs	r3, #0
 245 000c 03E0     		b	.L20
 246              	.LVL30:
 247              	.L21:
 207:USB/core/usb_core.c ****   {
 208:USB/core/usb_core.c ****     *(__packed uint32_t *)dest = USB_OTG_READ_REG32(fifo);
 248              		.loc 1 208 0 discriminator 3
 249 000e 2068     		ldr	r0, [r4]
 250 0010 41F8040B 		str	r0, [r1], #4
 251              	.LVL31:
 206:USB/core/usb_core.c ****   {
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 9


 252              		.loc 1 206 0 discriminator 3
 253 0014 0133     		adds	r3, r3, #1
 254              	.LVL32:
 255              	.L20:
 206:USB/core/usb_core.c ****   {
 256              		.loc 1 206 0 is_stmt 0 discriminator 1
 257 0016 9342     		cmp	r3, r2
 258 0018 F9D3     		bcc	.L21
 209:USB/core/usb_core.c ****     
 210:USB/core/usb_core.c ****   }
 211:USB/core/usb_core.c ****   return ((void *)dest);
 212:USB/core/usb_core.c **** }
 259              		.loc 1 212 0 is_stmt 1
 260 001a 0846     		mov	r0, r1
 261 001c 5DF8044B 		ldr	r4, [sp], #4
 262              	.LCFI6:
 263              		.cfi_restore 4
 264              		.cfi_def_cfa_offset 0
 265              	.LVL33:
 266 0020 7047     		bx	lr
 267              		.cfi_endproc
 268              	.LFE127:
 270 0022 00BF     		.section	.text.USB_OTG_SelectCore,"ax",%progbits
 271              		.align	2
 272              		.global	USB_OTG_SelectCore
 273              		.thumb
 274              		.thumb_func
 276              	USB_OTG_SelectCore:
 277              	.LFB128:
 213:USB/core/usb_core.c **** 
 214:USB/core/usb_core.c **** /**
 215:USB/core/usb_core.c **** * @brief  USB_OTG_SelectCore 
 216:USB/core/usb_core.c **** *         Initialize core registers address.
 217:USB/core/usb_core.c **** * @param  pdev : Selected device
 218:USB/core/usb_core.c **** * @param  coreID : USB OTG Core ID
 219:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 220:USB/core/usb_core.c **** */
 221:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_SelectCore(USB_OTG_CORE_HANDLE *pdev, 
 222:USB/core/usb_core.c ****                                USB_OTG_CORE_ID_TypeDef coreID)
 223:USB/core/usb_core.c **** {
 278              		.loc 1 223 0
 279              		.cfi_startproc
 280              		@ args = 0, pretend = 0, frame = 0
 281              		@ frame_needed = 0, uses_anonymous_args = 0
 282              		@ link register save eliminated.
 283              	.LVL34:
 284 0000 30B4     		push	{r4, r5}
 285              	.LCFI7:
 286              		.cfi_def_cfa_offset 8
 287              		.cfi_offset 4, -8
 288              		.cfi_offset 5, -4
 289              	.LVL35:
 224:USB/core/usb_core.c ****   uint32_t i , baseAddress = 0;
 225:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 226:USB/core/usb_core.c ****   
 227:USB/core/usb_core.c ****   pdev->cfg.dma_enable       = 0;
 290              		.loc 1 227 0
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 10


 291 0002 0023     		movs	r3, #0
 292 0004 C370     		strb	r3, [r0, #3]
 228:USB/core/usb_core.c ****   
 229:USB/core/usb_core.c ****   /* at startup the core is in FS mode */
 230:USB/core/usb_core.c ****   pdev->cfg.speed            = USB_OTG_SPEED_FULL;
 293              		.loc 1 230 0
 294 0006 0123     		movs	r3, #1
 295 0008 8370     		strb	r3, [r0, #2]
 231:USB/core/usb_core.c ****   pdev->cfg.mps              = USB_OTG_FS_MAX_PACKET_SIZE ;    
 296              		.loc 1 231 0
 297 000a 4023     		movs	r3, #64
 298 000c 8380     		strh	r3, [r0, #4]	@ movhi
 232:USB/core/usb_core.c ****   
 233:USB/core/usb_core.c ****   /* initialize device cfg following its address */
 234:USB/core/usb_core.c ****   if (coreID == USB_OTG_FS_CORE_ID)
 299              		.loc 1 234 0
 300 000e 0129     		cmp	r1, #1
 301 0010 0DD1     		bne	.L24
 302              	.LVL36:
 235:USB/core/usb_core.c ****   {
 236:USB/core/usb_core.c ****     baseAddress                = USB_OTG_FS_BASE_ADDR;
 237:USB/core/usb_core.c ****     pdev->cfg.coreID           = USB_OTG_FS_CORE_ID;
 303              		.loc 1 237 0
 304 0012 0123     		movs	r3, #1
 305 0014 C372     		strb	r3, [r0, #11]
 238:USB/core/usb_core.c ****     pdev->cfg.host_channels    = 8 ;
 306              		.loc 1 238 0
 307 0016 0823     		movs	r3, #8
 308 0018 0370     		strb	r3, [r0]
 239:USB/core/usb_core.c ****     pdev->cfg.dev_endpoints    = 4 ;
 309              		.loc 1 239 0
 310 001a 0423     		movs	r3, #4
 311 001c 4370     		strb	r3, [r0, #1]
 240:USB/core/usb_core.c ****     pdev->cfg.TotalFifoSize    = 320; /* in 32-bits */
 312              		.loc 1 240 0
 313 001e 4FF4A073 		mov	r3, #320
 314 0022 C380     		strh	r3, [r0, #6]	@ movhi
 241:USB/core/usb_core.c ****     pdev->cfg.phy_itface       = USB_OTG_EMBEDDED_PHY;     
 315              		.loc 1 241 0
 316 0024 0223     		movs	r3, #2
 317 0026 0372     		strb	r3, [r0, #8]
 236:USB/core/usb_core.c ****     pdev->cfg.coreID           = USB_OTG_FS_CORE_ID;
 318              		.loc 1 236 0
 319 0028 4FF0A044 		mov	r4, #1342177280
 320 002c 0CE0     		b	.L25
 321              	.LVL37:
 322              	.L24:
 242:USB/core/usb_core.c ****     
 243:USB/core/usb_core.c **** #ifdef USB_OTG_FS_SOF_OUTPUT_ENABLED    
 244:USB/core/usb_core.c ****     pdev->cfg.Sof_output       = 1;    
 245:USB/core/usb_core.c **** #endif 
 246:USB/core/usb_core.c ****     
 247:USB/core/usb_core.c **** #ifdef USB_OTG_FS_LOW_PWR_MGMT_SUPPORT    
 248:USB/core/usb_core.c ****     pdev->cfg.low_power        = 1;    
 249:USB/core/usb_core.c **** #endif     
 250:USB/core/usb_core.c ****   }
 251:USB/core/usb_core.c ****   else if (coreID == USB_OTG_HS_CORE_ID)
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 11


 323              		.loc 1 251 0
 324 002e 51B9     		cbnz	r1, .L32
 325              	.LVL38:
 252:USB/core/usb_core.c ****   {
 253:USB/core/usb_core.c ****     baseAddress                = USB_OTG_HS_BASE_ADDR;
 254:USB/core/usb_core.c ****     pdev->cfg.coreID           = USB_OTG_HS_CORE_ID;    
 326              		.loc 1 254 0
 327 0030 0023     		movs	r3, #0
 328 0032 C372     		strb	r3, [r0, #11]
 255:USB/core/usb_core.c ****     pdev->cfg.host_channels    = 12 ;
 329              		.loc 1 255 0
 330 0034 0C23     		movs	r3, #12
 331 0036 0370     		strb	r3, [r0]
 256:USB/core/usb_core.c ****     pdev->cfg.dev_endpoints    = 6 ;
 332              		.loc 1 256 0
 333 0038 0623     		movs	r3, #6
 334 003a 4370     		strb	r3, [r0, #1]
 257:USB/core/usb_core.c ****     pdev->cfg.TotalFifoSize    = 1280;/* in 32-bits */
 335              		.loc 1 257 0
 336 003c 4FF4A063 		mov	r3, #1280
 337 0040 C380     		strh	r3, [r0, #6]	@ movhi
 253:USB/core/usb_core.c ****     pdev->cfg.coreID           = USB_OTG_HS_CORE_ID;    
 338              		.loc 1 253 0
 339 0042 234C     		ldr	r4, .L34
 340 0044 00E0     		b	.L25
 341              	.LVL39:
 342              	.L32:
 224:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 343              		.loc 1 224 0
 344 0046 0024     		movs	r4, #0
 345              	.LVL40:
 346              	.L25:
 258:USB/core/usb_core.c ****     
 259:USB/core/usb_core.c **** #ifdef USB_OTG_ULPI_PHY_ENABLED
 260:USB/core/usb_core.c ****     pdev->cfg.phy_itface       = USB_OTG_ULPI_PHY;
 261:USB/core/usb_core.c **** #else    
 262:USB/core/usb_core.c **** #ifdef USB_OTG_EMBEDDED_PHY_ENABLED
 263:USB/core/usb_core.c ****     pdev->cfg.phy_itface       = USB_OTG_EMBEDDED_PHY;
 264:USB/core/usb_core.c **** #endif  
 265:USB/core/usb_core.c **** #endif      
 266:USB/core/usb_core.c ****     
 267:USB/core/usb_core.c **** #ifdef USB_OTG_HS_INTERNAL_DMA_ENABLED    
 268:USB/core/usb_core.c ****     pdev->cfg.dma_enable       = 1;    
 269:USB/core/usb_core.c **** #endif
 270:USB/core/usb_core.c ****     
 271:USB/core/usb_core.c **** #ifdef USB_OTG_HS_SOF_OUTPUT_ENABLED    
 272:USB/core/usb_core.c ****     pdev->cfg.Sof_output       = 1;    
 273:USB/core/usb_core.c **** #endif 
 274:USB/core/usb_core.c ****     
 275:USB/core/usb_core.c **** #ifdef USB_OTG_HS_LOW_PWR_MGMT_SUPPORT    
 276:USB/core/usb_core.c ****     pdev->cfg.low_power        = 1;    
 277:USB/core/usb_core.c **** #endif 
 278:USB/core/usb_core.c ****     
 279:USB/core/usb_core.c ****   }
 280:USB/core/usb_core.c ****   
 281:USB/core/usb_core.c ****   pdev->regs.GREGS = (USB_OTG_GREGS *)(baseAddress + \
 347              		.loc 1 281 0
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 12


 348 0048 C460     		str	r4, [r0, #12]
 282:USB/core/usb_core.c ****     USB_OTG_CORE_GLOBAL_REGS_OFFSET);
 283:USB/core/usb_core.c ****   pdev->regs.DREGS =  (USB_OTG_DREGS  *)  (baseAddress + \
 349              		.loc 1 283 0
 350 004a 04F50063 		add	r3, r4, #2048
 351 004e 0361     		str	r3, [r0, #16]
 352              	.LVL41:
 284:USB/core/usb_core.c ****     USB_OTG_DEV_GLOBAL_REG_OFFSET);
 285:USB/core/usb_core.c ****   
 286:USB/core/usb_core.c ****   for (i = 0; i < pdev->cfg.dev_endpoints; i++)
 353              		.loc 1 286 0
 354 0050 0023     		movs	r3, #0
 355 0052 0FE0     		b	.L26
 356              	.LVL42:
 357              	.L27:
 287:USB/core/usb_core.c ****   {
 288:USB/core/usb_core.c ****     pdev->regs.INEP_REGS[i]  = (USB_OTG_INEPREGS *)  \
 289:USB/core/usb_core.c ****       (baseAddress + USB_OTG_DEV_IN_EP_REG_OFFSET + \
 358              		.loc 1 289 0 discriminator 3
 359 0054 04EB4312 		add	r2, r4, r3, lsl #5
 360 0058 02F51065 		add	r5, r2, #2304
 288:USB/core/usb_core.c ****       (baseAddress + USB_OTG_DEV_IN_EP_REG_OFFSET + \
 361              		.loc 1 288 0 discriminator 3
 362 005c 191D     		adds	r1, r3, #4
 363 005e 00EB8101 		add	r1, r0, r1, lsl #2
 364 0062 8D60     		str	r5, [r1, #8]
 290:USB/core/usb_core.c ****         (i * USB_OTG_EP_REG_OFFSET));
 291:USB/core/usb_core.c ****     pdev->regs.OUTEP_REGS[i] = (USB_OTG_OUTEPREGS *) \
 292:USB/core/usb_core.c ****       (baseAddress + USB_OTG_DEV_OUT_EP_REG_OFFSET + \
 365              		.loc 1 292 0 discriminator 3
 366 0064 02F53062 		add	r2, r2, #2816
 291:USB/core/usb_core.c ****       (baseAddress + USB_OTG_DEV_OUT_EP_REG_OFFSET + \
 367              		.loc 1 291 0 discriminator 3
 368 0068 03F11401 		add	r1, r3, #20
 369 006c 00EB8101 		add	r1, r0, r1, lsl #2
 370 0070 4A60     		str	r2, [r1, #4]
 286:USB/core/usb_core.c ****   {
 371              		.loc 1 286 0 discriminator 3
 372 0072 0133     		adds	r3, r3, #1
 373              	.LVL43:
 374              	.L26:
 286:USB/core/usb_core.c ****   {
 375              		.loc 1 286 0 is_stmt 0 discriminator 1
 376 0074 4278     		ldrb	r2, [r0, #1]	@ zero_extendqisi2
 377 0076 9342     		cmp	r3, r2
 378 0078 ECD3     		bcc	.L27
 293:USB/core/usb_core.c ****         (i * USB_OTG_EP_REG_OFFSET));
 294:USB/core/usb_core.c ****   }
 295:USB/core/usb_core.c ****   pdev->regs.HREGS = (USB_OTG_HREGS *)(baseAddress + \
 379              		.loc 1 295 0 is_stmt 1
 380 007a 04F58063 		add	r3, r4, #1024
 381              	.LVL44:
 382 007e 4361     		str	r3, [r0, #20]
 296:USB/core/usb_core.c ****     USB_OTG_HOST_GLOBAL_REG_OFFSET);
 297:USB/core/usb_core.c ****   pdev->regs.HPRT0 = (uint32_t *)(baseAddress + USB_OTG_HOST_PORT_REGS_OFFSET);
 383              		.loc 1 297 0
 384 0080 04F58863 		add	r3, r4, #1088
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 13


 385 0084 C0F8CC30 		str	r3, [r0, #204]
 386              	.LVL45:
 298:USB/core/usb_core.c ****   
 299:USB/core/usb_core.c ****   for (i = 0; i < pdev->cfg.host_channels; i++)
 387              		.loc 1 299 0
 388 0088 0023     		movs	r3, #0
 389 008a 09E0     		b	.L28
 390              	.LVL46:
 391              	.L29:
 300:USB/core/usb_core.c ****   {
 301:USB/core/usb_core.c ****     pdev->regs.HC_REGS[i] = (USB_OTG_HC_REGS *)(baseAddress + \
 302:USB/core/usb_core.c ****       USB_OTG_HOST_CHAN_REGS_OFFSET + \
 392              		.loc 1 302 0 discriminator 3
 393 008c 04EB4311 		add	r1, r4, r3, lsl #5
 394 0090 01F5A061 		add	r1, r1, #1280
 301:USB/core/usb_core.c ****       USB_OTG_HOST_CHAN_REGS_OFFSET + \
 395              		.loc 1 301 0 discriminator 3
 396 0094 03F12202 		add	r2, r3, #34
 397 0098 00EB8202 		add	r2, r0, r2, lsl #2
 398 009c 9160     		str	r1, [r2, #8]
 299:USB/core/usb_core.c ****   {
 399              		.loc 1 299 0 discriminator 3
 400 009e 0133     		adds	r3, r3, #1
 401              	.LVL47:
 402              	.L28:
 299:USB/core/usb_core.c ****   {
 403              		.loc 1 299 0 is_stmt 0 discriminator 1
 404 00a0 0578     		ldrb	r5, [r0]	@ zero_extendqisi2
 405 00a2 AB42     		cmp	r3, r5
 406 00a4 F2D3     		bcc	.L29
 407 00a6 0023     		movs	r3, #0
 408              	.LVL48:
 409 00a8 09E0     		b	.L30
 410              	.LVL49:
 411              	.L31:
 303:USB/core/usb_core.c ****         (i * USB_OTG_CHAN_REGS_OFFSET));
 304:USB/core/usb_core.c ****   }
 305:USB/core/usb_core.c ****   for (i = 0; i < pdev->cfg.host_channels; i++)
 306:USB/core/usb_core.c ****   {
 307:USB/core/usb_core.c ****     pdev->regs.DFIFO[i] = (uint32_t *)(baseAddress + USB_OTG_DATA_FIFO_OFFSET +\
 412              		.loc 1 307 0 is_stmt 1 discriminator 3
 413 00aa 04EB0331 		add	r1, r4, r3, lsl #12
 414 00ae 01F58051 		add	r1, r1, #4096
 415 00b2 03F13202 		add	r2, r3, #50
 416 00b6 00EB8202 		add	r2, r0, r2, lsl #2
 417 00ba 9160     		str	r1, [r2, #8]
 305:USB/core/usb_core.c ****   {
 418              		.loc 1 305 0 discriminator 3
 419 00bc 0133     		adds	r3, r3, #1
 420              	.LVL50:
 421              	.L30:
 305:USB/core/usb_core.c ****   {
 422              		.loc 1 305 0 is_stmt 0 discriminator 1
 423 00be AB42     		cmp	r3, r5
 424 00c0 F3D3     		bcc	.L31
 308:USB/core/usb_core.c ****       (i * USB_OTG_DATA_FIFO_SIZE));
 309:USB/core/usb_core.c ****   }
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 14


 310:USB/core/usb_core.c ****   pdev->regs.PCGCCTL = (uint32_t *)(baseAddress + USB_OTG_PCGCCTL_OFFSET);
 425              		.loc 1 310 0 is_stmt 1
 426 00c2 04F56064 		add	r4, r4, #3584
 427              	.LVL51:
 428 00c6 C0F80C41 		str	r4, [r0, #268]
 311:USB/core/usb_core.c ****   
 312:USB/core/usb_core.c ****   return status;
 313:USB/core/usb_core.c **** }
 429              		.loc 1 313 0
 430 00ca 0020     		movs	r0, #0
 431              	.LVL52:
 432 00cc 30BC     		pop	{r4, r5}
 433              	.LCFI8:
 434              		.cfi_restore 5
 435              		.cfi_restore 4
 436              		.cfi_def_cfa_offset 0
 437              	.LVL53:
 438 00ce 7047     		bx	lr
 439              	.L35:
 440              		.align	2
 441              	.L34:
 442 00d0 00000440 		.word	1074003968
 443              		.cfi_endproc
 444              	.LFE128:
 446              		.section	.text.USB_OTG_CoreInit,"ax",%progbits
 447              		.align	2
 448              		.global	USB_OTG_CoreInit
 449              		.thumb
 450              		.thumb_func
 452              	USB_OTG_CoreInit:
 453              	.LFB129:
 314:USB/core/usb_core.c **** 
 315:USB/core/usb_core.c **** 
 316:USB/core/usb_core.c **** /**
 317:USB/core/usb_core.c **** * @brief  USB_OTG_CoreInit
 318:USB/core/usb_core.c **** *         Initializes the USB_OTG controller registers and prepares the core
 319:USB/core/usb_core.c **** *         device mode or host mode operation.
 320:USB/core/usb_core.c **** * @param  pdev : Selected device
 321:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 322:USB/core/usb_core.c **** */
 323:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_CoreInit(USB_OTG_CORE_HANDLE *pdev)
 324:USB/core/usb_core.c **** {
 454              		.loc 1 324 0
 455              		.cfi_startproc
 456              		@ args = 0, pretend = 0, frame = 0
 457              		@ frame_needed = 0, uses_anonymous_args = 0
 458              	.LVL54:
 459 0000 38B5     		push	{r3, r4, r5, lr}
 460              	.LCFI9:
 461              		.cfi_def_cfa_offset 16
 462              		.cfi_offset 3, -16
 463              		.cfi_offset 4, -12
 464              		.cfi_offset 5, -8
 465              		.cfi_offset 14, -4
 466 0002 0446     		mov	r4, r0
 467              	.LVL55:
 325:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 15


 326:USB/core/usb_core.c ****   USB_OTG_GUSBCFG_TypeDef  usbcfg;
 327:USB/core/usb_core.c ****   USB_OTG_GCCFG_TypeDef    gccfg;
 328:USB/core/usb_core.c ****   USB_OTG_GAHBCFG_TypeDef  ahbcfg;
 329:USB/core/usb_core.c ****   
 330:USB/core/usb_core.c ****   usbcfg.d32 = 0;
 331:USB/core/usb_core.c ****   gccfg.d32 = 0;
 332:USB/core/usb_core.c ****   ahbcfg.d32 = 0;
 333:USB/core/usb_core.c ****   
 334:USB/core/usb_core.c ****   
 335:USB/core/usb_core.c ****   
 336:USB/core/usb_core.c ****   if (pdev->cfg.phy_itface == USB_OTG_ULPI_PHY)
 468              		.loc 1 336 0
 469 0004 037A     		ldrb	r3, [r0, #8]	@ zero_extendqisi2
 470 0006 012B     		cmp	r3, #1
 471 0008 22D1     		bne	.L37
 472 000a 0025     		movs	r5, #0
 473              	.LVL56:
 337:USB/core/usb_core.c ****   {
 338:USB/core/usb_core.c ****     gccfg.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->GCCFG);
 474              		.loc 1 338 0
 475 000c C268     		ldr	r2, [r0, #12]
 476 000e 936B     		ldr	r3, [r2, #56]
 477              	.LVL57:
 339:USB/core/usb_core.c ****     gccfg.b.pwdn = 0;
 478              		.loc 1 339 0
 479 0010 6FF31043 		bfc	r3, #16, #1
 340:USB/core/usb_core.c ****     
 341:USB/core/usb_core.c ****     if (pdev->cfg.Sof_output)
 480              		.loc 1 341 0
 481 0014 417A     		ldrb	r1, [r0, #9]	@ zero_extendqisi2
 482 0016 09B1     		cbz	r1, .L38
 342:USB/core/usb_core.c ****     {
 343:USB/core/usb_core.c ****       gccfg.b.sofouten = 1;   
 483              		.loc 1 343 0
 484 0018 43F48013 		orr	r3, r3, #1048576
 485              	.LVL58:
 486              	.L38:
 344:USB/core/usb_core.c ****     }
 345:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32 (&pdev->regs.GREGS->GCCFG, gccfg.d32);
 487              		.loc 1 345 0
 488 001c 9363     		str	r3, [r2, #56]
 346:USB/core/usb_core.c ****     
 347:USB/core/usb_core.c ****     /* Init The ULPI Interface */
 348:USB/core/usb_core.c ****     usbcfg.d32 = 0;
 349:USB/core/usb_core.c ****     usbcfg.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->GUSBCFG);
 489              		.loc 1 349 0
 490 001e E268     		ldr	r2, [r4, #12]
 491 0020 D368     		ldr	r3, [r2, #12]
 492              	.LVL59:
 350:USB/core/usb_core.c ****     
 351:USB/core/usb_core.c ****     usbcfg.b.physel            = 0; /* HS Interface */
 493              		.loc 1 351 0
 494 0022 6FF38613 		bfc	r3, #6, #1
 495              	.LVL60:
 352:USB/core/usb_core.c **** #ifdef USB_OTG_INTERNAL_VBUS_ENABLED
 353:USB/core/usb_core.c ****     usbcfg.b.ulpi_ext_vbus_drv = 0; /* Use internal VBUS */
 354:USB/core/usb_core.c **** #else
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 16


 355:USB/core/usb_core.c **** #ifdef USB_OTG_EXTERNAL_VBUS_ENABLED    
 356:USB/core/usb_core.c ****     usbcfg.b.ulpi_ext_vbus_drv = 1; /* Use external VBUS */
 357:USB/core/usb_core.c **** #endif
 358:USB/core/usb_core.c **** #endif 
 359:USB/core/usb_core.c ****     usbcfg.b.term_sel_dl_pulse = 0; /* Data line pulsing using utmi_txvalid */    
 496              		.loc 1 359 0
 497 0026 6FF39653 		bfc	r3, #22, #1
 360:USB/core/usb_core.c ****     
 361:USB/core/usb_core.c ****     usbcfg.b.ulpi_fsls = 0;
 498              		.loc 1 361 0
 499 002a 6FF35143 		bfc	r3, #17, #1
 362:USB/core/usb_core.c ****     usbcfg.b.ulpi_clk_sus_m = 0;
 500              		.loc 1 362 0
 501 002e 6FF3D343 		bfc	r3, #19, #1
 363:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32 (&pdev->regs.GREGS->GUSBCFG, usbcfg.d32);
 502              		.loc 1 363 0
 503 0032 D360     		str	r3, [r2, #12]
 364:USB/core/usb_core.c ****     
 365:USB/core/usb_core.c ****     /* Reset after a PHY select  */
 366:USB/core/usb_core.c ****     USB_OTG_CoreReset(pdev);
 504              		.loc 1 366 0
 505 0034 2046     		mov	r0, r4
 506              	.LVL61:
 507 0036 FFF7FEFF 		bl	USB_OTG_CoreReset
 508              	.LVL62:
 367:USB/core/usb_core.c ****     
 368:USB/core/usb_core.c ****     if(pdev->cfg.dma_enable == 1)
 509              		.loc 1 368 0
 510 003a E378     		ldrb	r3, [r4, #3]	@ zero_extendqisi2
 511 003c 012B     		cmp	r3, #1
 512 003e 19D1     		bne	.L39
 369:USB/core/usb_core.c ****     {
 370:USB/core/usb_core.c ****       
 371:USB/core/usb_core.c ****       ahbcfg.b.hburstlen = 5; /* 64 x 32-bits*/
 513              		.loc 1 371 0
 514 0040 0523     		movs	r3, #5
 515 0042 63F34405 		bfi	r5, r3, #1, #4
 516              	.LVL63:
 372:USB/core/usb_core.c ****       ahbcfg.b.dmaenable = 1;
 517              		.loc 1 372 0
 518 0046 45F02005 		orr	r5, r5, #32
 519              	.LVL64:
 373:USB/core/usb_core.c ****       USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GAHBCFG, ahbcfg.d32);
 520              		.loc 1 373 0
 521 004a E368     		ldr	r3, [r4, #12]
 522              	.LVL65:
 523 004c 9D60     		str	r5, [r3, #8]
 524 004e 11E0     		b	.L39
 525              	.LVL66:
 526              	.L37:
 374:USB/core/usb_core.c ****       
 375:USB/core/usb_core.c ****     }    
 376:USB/core/usb_core.c ****   }
 377:USB/core/usb_core.c ****   else /* FS interface (embedded Phy) */
 378:USB/core/usb_core.c ****   {
 379:USB/core/usb_core.c ****     
 380:USB/core/usb_core.c ****     usbcfg.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->GUSBCFG);;
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 17


 527              		.loc 1 380 0
 528 0050 C268     		ldr	r2, [r0, #12]
 529 0052 D168     		ldr	r1, [r2, #12]
 381:USB/core/usb_core.c ****     usbcfg.b.physel  = 1; /* FS Interface */
 530              		.loc 1 381 0
 531 0054 41F04003 		orr	r3, r1, #64
 532              	.LVL67:
 382:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32 (&pdev->regs.GREGS->GUSBCFG, usbcfg.d32);
 533              		.loc 1 382 0
 534 0058 D360     		str	r3, [r2, #12]
 383:USB/core/usb_core.c ****     /* Reset after a PHY select and set Host mode */
 384:USB/core/usb_core.c ****     USB_OTG_CoreReset(pdev);
 535              		.loc 1 384 0
 536 005a FFF7FEFF 		bl	USB_OTG_CoreReset
 537              	.LVL68:
 385:USB/core/usb_core.c ****     /* Deactivate the power down*/
 386:USB/core/usb_core.c ****     gccfg.d32 = 0;
 387:USB/core/usb_core.c ****     gccfg.b.pwdn = 1;
 388:USB/core/usb_core.c ****     
 389:USB/core/usb_core.c ****     gccfg.b.vbussensingA = 1 ;
 390:USB/core/usb_core.c ****     gccfg.b.vbussensingB = 1 ;     
 391:USB/core/usb_core.c **** #ifndef VBUS_SENSING_ENABLED
 392:USB/core/usb_core.c ****     gccfg.b.disablevbussensing = 1; 
 538              		.loc 1 392 0
 539 005e 4FF43413 		mov	r3, #2949120
 393:USB/core/usb_core.c **** #endif    
 394:USB/core/usb_core.c ****     
 395:USB/core/usb_core.c ****     if(pdev->cfg.Sof_output)
 540              		.loc 1 395 0
 541 0062 627A     		ldrb	r2, [r4, #9]	@ zero_extendqisi2
 542 0064 0AB1     		cbz	r2, .L40
 396:USB/core/usb_core.c ****     {
 397:USB/core/usb_core.c ****       gccfg.b.sofouten = 1;  
 543              		.loc 1 397 0
 544 0066 4FF47413 		mov	r3, #3997696
 545              	.L40:
 398:USB/core/usb_core.c ****     }
 399:USB/core/usb_core.c ****     
 400:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32 (&pdev->regs.GREGS->GCCFG, gccfg.d32);
 546              		.loc 1 400 0
 547 006a E268     		ldr	r2, [r4, #12]
 548              	.LVL69:
 549 006c 9363     		str	r3, [r2, #56]
 401:USB/core/usb_core.c ****     USB_OTG_BSP_mDelay(20);
 550              		.loc 1 401 0
 551 006e 1420     		movs	r0, #20
 552 0070 FFF7FEFF 		bl	USB_OTG_BSP_mDelay
 553              	.LVL70:
 554              	.L39:
 402:USB/core/usb_core.c ****   }
 403:USB/core/usb_core.c ****   /* case the HS core is working in FS mode */
 404:USB/core/usb_core.c ****   if(pdev->cfg.dma_enable == 1)
 555              		.loc 1 404 0
 556 0074 E378     		ldrb	r3, [r4, #3]	@ zero_extendqisi2
 557 0076 012B     		cmp	r3, #1
 558 0078 07D1     		bne	.L41
 405:USB/core/usb_core.c ****   {
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 18


 406:USB/core/usb_core.c ****     
 407:USB/core/usb_core.c ****     ahbcfg.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->GAHBCFG);
 559              		.loc 1 407 0
 560 007a E368     		ldr	r3, [r4, #12]
 561 007c 9D68     		ldr	r5, [r3, #8]
 562              	.LVL71:
 408:USB/core/usb_core.c ****     ahbcfg.b.hburstlen = 5; /* 64 x 32-bits*/
 563              		.loc 1 408 0
 564 007e 0522     		movs	r2, #5
 565 0080 62F34405 		bfi	r5, r2, #1, #4
 566              	.LVL72:
 409:USB/core/usb_core.c ****     ahbcfg.b.dmaenable = 1;
 567              		.loc 1 409 0
 568 0084 45F02005 		orr	r5, r5, #32
 569              	.LVL73:
 410:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GAHBCFG, ahbcfg.d32);
 570              		.loc 1 410 0
 571 0088 9D60     		str	r5, [r3, #8]
 572              	.L41:
 411:USB/core/usb_core.c ****     
 412:USB/core/usb_core.c ****   }
 413:USB/core/usb_core.c ****   /* initialize OTG features */
 414:USB/core/usb_core.c **** #ifdef  USE_OTG_MODE
 415:USB/core/usb_core.c ****   usbcfg.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->GUSBCFG);
 416:USB/core/usb_core.c ****   usbcfg.b.hnpcap = 1;
 417:USB/core/usb_core.c ****   usbcfg.b.srpcap = 1;
 418:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GUSBCFG, usbcfg.d32);
 419:USB/core/usb_core.c ****   USB_OTG_EnableCommonInt(pdev);
 420:USB/core/usb_core.c **** #endif
 421:USB/core/usb_core.c ****   return status;
 422:USB/core/usb_core.c **** }
 573              		.loc 1 422 0
 574 008a 0020     		movs	r0, #0
 575 008c 38BD     		pop	{r3, r4, r5, pc}
 576              		.cfi_endproc
 577              	.LFE129:
 579 008e 00BF     		.section	.text.USB_OTG_EnableGlobalInt,"ax",%progbits
 580              		.align	2
 581              		.global	USB_OTG_EnableGlobalInt
 582              		.thumb
 583              		.thumb_func
 585              	USB_OTG_EnableGlobalInt:
 586              	.LFB130:
 423:USB/core/usb_core.c **** /**
 424:USB/core/usb_core.c **** * @brief  USB_OTG_EnableGlobalInt
 425:USB/core/usb_core.c **** *         Enables the controller's Global Int in the AHB Config reg
 426:USB/core/usb_core.c **** * @param  pdev : Selected device
 427:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 428:USB/core/usb_core.c **** */
 429:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_EnableGlobalInt(USB_OTG_CORE_HANDLE *pdev)
 430:USB/core/usb_core.c **** {
 587              		.loc 1 430 0
 588              		.cfi_startproc
 589              		@ args = 0, pretend = 0, frame = 0
 590              		@ frame_needed = 0, uses_anonymous_args = 0
 591              		@ link register save eliminated.
 592              	.LVL74:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 19


 431:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 432:USB/core/usb_core.c ****   USB_OTG_GAHBCFG_TypeDef  ahbcfg;
 433:USB/core/usb_core.c ****   
 434:USB/core/usb_core.c ****   ahbcfg.d32 = 0;
 435:USB/core/usb_core.c ****   ahbcfg.b.glblintrmsk = 1; /* Enable interrupts */
 436:USB/core/usb_core.c ****   USB_OTG_MODIFY_REG32(&pdev->regs.GREGS->GAHBCFG, 0, ahbcfg.d32);
 593              		.loc 1 436 0
 594 0000 C268     		ldr	r2, [r0, #12]
 595 0002 9368     		ldr	r3, [r2, #8]
 596 0004 43F00103 		orr	r3, r3, #1
 597 0008 9360     		str	r3, [r2, #8]
 437:USB/core/usb_core.c ****   return status;
 438:USB/core/usb_core.c **** }
 598              		.loc 1 438 0
 599 000a 0020     		movs	r0, #0
 600              	.LVL75:
 601 000c 7047     		bx	lr
 602              		.cfi_endproc
 603              	.LFE130:
 605 000e 00BF     		.section	.text.USB_OTG_DisableGlobalInt,"ax",%progbits
 606              		.align	2
 607              		.global	USB_OTG_DisableGlobalInt
 608              		.thumb
 609              		.thumb_func
 611              	USB_OTG_DisableGlobalInt:
 612              	.LFB131:
 439:USB/core/usb_core.c **** 
 440:USB/core/usb_core.c **** 
 441:USB/core/usb_core.c **** /**
 442:USB/core/usb_core.c **** * @brief  USB_OTG_DisableGlobalInt
 443:USB/core/usb_core.c **** *         Enables the controller's Global Int in the AHB Config reg
 444:USB/core/usb_core.c **** * @param  pdev : Selected device
 445:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 446:USB/core/usb_core.c **** */
 447:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_DisableGlobalInt(USB_OTG_CORE_HANDLE *pdev)
 448:USB/core/usb_core.c **** {
 613              		.loc 1 448 0
 614              		.cfi_startproc
 615              		@ args = 0, pretend = 0, frame = 0
 616              		@ frame_needed = 0, uses_anonymous_args = 0
 617              		@ link register save eliminated.
 618              	.LVL76:
 449:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 450:USB/core/usb_core.c ****   USB_OTG_GAHBCFG_TypeDef  ahbcfg;
 451:USB/core/usb_core.c ****   ahbcfg.d32 = 0;
 452:USB/core/usb_core.c ****   ahbcfg.b.glblintrmsk = 1; /* Enable interrupts */
 453:USB/core/usb_core.c ****   USB_OTG_MODIFY_REG32(&pdev->regs.GREGS->GAHBCFG, ahbcfg.d32, 0);
 619              		.loc 1 453 0
 620 0000 C268     		ldr	r2, [r0, #12]
 621 0002 9368     		ldr	r3, [r2, #8]
 622 0004 23F00103 		bic	r3, r3, #1
 623 0008 9360     		str	r3, [r2, #8]
 454:USB/core/usb_core.c ****   return status;
 455:USB/core/usb_core.c **** }
 624              		.loc 1 455 0
 625 000a 0020     		movs	r0, #0
 626              	.LVL77:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 20


 627 000c 7047     		bx	lr
 628              		.cfi_endproc
 629              	.LFE131:
 631 000e 00BF     		.section	.text.USB_OTG_FlushTxFifo,"ax",%progbits
 632              		.align	2
 633              		.global	USB_OTG_FlushTxFifo
 634              		.thumb
 635              		.thumb_func
 637              	USB_OTG_FlushTxFifo:
 638              	.LFB132:
 456:USB/core/usb_core.c **** 
 457:USB/core/usb_core.c **** 
 458:USB/core/usb_core.c **** /**
 459:USB/core/usb_core.c **** * @brief  USB_OTG_FlushTxFifo : Flush a Tx FIFO
 460:USB/core/usb_core.c **** * @param  pdev : Selected device
 461:USB/core/usb_core.c **** * @param  num : FO num
 462:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 463:USB/core/usb_core.c **** */
 464:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_FlushTxFifo (USB_OTG_CORE_HANDLE *pdev , uint32_t num )
 465:USB/core/usb_core.c **** {
 639              		.loc 1 465 0
 640              		.cfi_startproc
 641              		@ args = 0, pretend = 0, frame = 8
 642              		@ frame_needed = 0, uses_anonymous_args = 0
 643              	.LVL78:
 644 0000 00B5     		push	{lr}
 645              	.LCFI10:
 646              		.cfi_def_cfa_offset 4
 647              		.cfi_offset 14, -4
 648 0002 83B0     		sub	sp, sp, #12
 649              	.LCFI11:
 650              		.cfi_def_cfa_offset 16
 651              	.LVL79:
 466:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 467:USB/core/usb_core.c ****   __IO USB_OTG_GRSTCTL_TypeDef  greset;
 468:USB/core/usb_core.c ****   
 469:USB/core/usb_core.c ****   uint32_t count = 0;
 470:USB/core/usb_core.c ****   greset.d32 = 0;
 652              		.loc 1 470 0
 653 0004 0023     		movs	r3, #0
 654 0006 0193     		str	r3, [sp, #4]
 471:USB/core/usb_core.c ****   greset.b.txfflsh = 1;
 655              		.loc 1 471 0
 656 0008 019A     		ldr	r2, [sp, #4]
 657 000a 42F02002 		orr	r2, r2, #32
 658 000e 0192     		str	r2, [sp, #4]
 472:USB/core/usb_core.c ****   greset.b.txfnum  = num;
 659              		.loc 1 472 0
 660 0010 019A     		ldr	r2, [sp, #4]
 661 0012 61F38A12 		bfi	r2, r1, #6, #5
 662 0016 0192     		str	r2, [sp, #4]
 473:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.GREGS->GRSTCTL, greset.d32 );
 663              		.loc 1 473 0
 664 0018 C268     		ldr	r2, [r0, #12]
 665 001a 0199     		ldr	r1, [sp, #4]
 666              	.LVL80:
 667 001c 1161     		str	r1, [r2, #16]
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 21


 668              	.LVL81:
 669              	.L47:
 474:USB/core/usb_core.c ****   do
 475:USB/core/usb_core.c ****   {
 476:USB/core/usb_core.c ****     greset.d32 = USB_OTG_READ_REG32( &pdev->regs.GREGS->GRSTCTL);
 670              		.loc 1 476 0
 671 001e C268     		ldr	r2, [r0, #12]
 672 0020 1269     		ldr	r2, [r2, #16]
 673 0022 0192     		str	r2, [sp, #4]
 477:USB/core/usb_core.c ****     if (++count > 200000)
 674              		.loc 1 477 0
 675 0024 0133     		adds	r3, r3, #1
 676              	.LVL82:
 677 0026 074A     		ldr	r2, .L49
 678 0028 9342     		cmp	r3, r2
 679 002a 03D8     		bhi	.L46
 478:USB/core/usb_core.c ****     {
 479:USB/core/usb_core.c ****       break;
 480:USB/core/usb_core.c ****     }
 481:USB/core/usb_core.c ****   }
 482:USB/core/usb_core.c ****   while (greset.b.txfflsh == 1);
 680              		.loc 1 482 0
 681 002c 019A     		ldr	r2, [sp, #4]
 682 002e 12F0200F 		tst	r2, #32
 683 0032 F4D1     		bne	.L47
 684              	.L46:
 483:USB/core/usb_core.c ****   /* Wait for 3 PHY Clocks*/
 484:USB/core/usb_core.c ****   USB_OTG_BSP_uDelay(3);
 685              		.loc 1 484 0
 686 0034 0320     		movs	r0, #3
 687              	.LVL83:
 688 0036 FFF7FEFF 		bl	USB_OTG_BSP_uDelay
 689              	.LVL84:
 485:USB/core/usb_core.c ****   return status;
 486:USB/core/usb_core.c **** }
 690              		.loc 1 486 0
 691 003a 0020     		movs	r0, #0
 692 003c 03B0     		add	sp, sp, #12
 693              	.LCFI12:
 694              		.cfi_def_cfa_offset 4
 695              		@ sp needed
 696 003e 5DF804FB 		ldr	pc, [sp], #4
 697              	.L50:
 698 0042 00BF     		.align	2
 699              	.L49:
 700 0044 400D0300 		.word	200000
 701              		.cfi_endproc
 702              	.LFE132:
 704              		.section	.text.USB_OTG_FlushRxFifo,"ax",%progbits
 705              		.align	2
 706              		.global	USB_OTG_FlushRxFifo
 707              		.thumb
 708              		.thumb_func
 710              	USB_OTG_FlushRxFifo:
 711              	.LFB133:
 487:USB/core/usb_core.c **** 
 488:USB/core/usb_core.c **** 
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 22


 489:USB/core/usb_core.c **** /**
 490:USB/core/usb_core.c **** * @brief  USB_OTG_FlushRxFifo : Flush a Rx FIFO
 491:USB/core/usb_core.c **** * @param  pdev : Selected device
 492:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 493:USB/core/usb_core.c **** */
 494:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_FlushRxFifo( USB_OTG_CORE_HANDLE *pdev )
 495:USB/core/usb_core.c **** {
 712              		.loc 1 495 0
 713              		.cfi_startproc
 714              		@ args = 0, pretend = 0, frame = 8
 715              		@ frame_needed = 0, uses_anonymous_args = 0
 716              	.LVL85:
 717 0000 00B5     		push	{lr}
 718              	.LCFI13:
 719              		.cfi_def_cfa_offset 4
 720              		.cfi_offset 14, -4
 721 0002 83B0     		sub	sp, sp, #12
 722              	.LCFI14:
 723              		.cfi_def_cfa_offset 16
 724              	.LVL86:
 496:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 497:USB/core/usb_core.c ****   __IO USB_OTG_GRSTCTL_TypeDef  greset;
 498:USB/core/usb_core.c ****   uint32_t count = 0;
 499:USB/core/usb_core.c ****   
 500:USB/core/usb_core.c ****   greset.d32 = 0;
 725              		.loc 1 500 0
 726 0004 0023     		movs	r3, #0
 727 0006 0193     		str	r3, [sp, #4]
 501:USB/core/usb_core.c ****   greset.b.rxfflsh = 1;
 728              		.loc 1 501 0
 729 0008 019A     		ldr	r2, [sp, #4]
 730 000a 42F01002 		orr	r2, r2, #16
 731 000e 0192     		str	r2, [sp, #4]
 502:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.GREGS->GRSTCTL, greset.d32 );
 732              		.loc 1 502 0
 733 0010 C268     		ldr	r2, [r0, #12]
 734 0012 0199     		ldr	r1, [sp, #4]
 735 0014 1161     		str	r1, [r2, #16]
 736              	.LVL87:
 737              	.L53:
 503:USB/core/usb_core.c ****   do
 504:USB/core/usb_core.c ****   {
 505:USB/core/usb_core.c ****     greset.d32 = USB_OTG_READ_REG32( &pdev->regs.GREGS->GRSTCTL);
 738              		.loc 1 505 0
 739 0016 C268     		ldr	r2, [r0, #12]
 740 0018 1269     		ldr	r2, [r2, #16]
 741 001a 0192     		str	r2, [sp, #4]
 506:USB/core/usb_core.c ****     if (++count > 200000)
 742              		.loc 1 506 0
 743 001c 0133     		adds	r3, r3, #1
 744              	.LVL88:
 745 001e 074A     		ldr	r2, .L55
 746 0020 9342     		cmp	r3, r2
 747 0022 03D8     		bhi	.L52
 507:USB/core/usb_core.c ****     {
 508:USB/core/usb_core.c ****       break;
 509:USB/core/usb_core.c ****     }
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 23


 510:USB/core/usb_core.c ****   }
 511:USB/core/usb_core.c ****   while (greset.b.rxfflsh == 1);
 748              		.loc 1 511 0
 749 0024 019A     		ldr	r2, [sp, #4]
 750 0026 12F0100F 		tst	r2, #16
 751 002a F4D1     		bne	.L53
 752              	.L52:
 512:USB/core/usb_core.c ****   /* Wait for 3 PHY Clocks*/
 513:USB/core/usb_core.c ****   USB_OTG_BSP_uDelay(3);
 753              		.loc 1 513 0
 754 002c 0320     		movs	r0, #3
 755              	.LVL89:
 756 002e FFF7FEFF 		bl	USB_OTG_BSP_uDelay
 757              	.LVL90:
 514:USB/core/usb_core.c ****   return status;
 515:USB/core/usb_core.c **** }
 758              		.loc 1 515 0
 759 0032 0020     		movs	r0, #0
 760 0034 03B0     		add	sp, sp, #12
 761              	.LCFI15:
 762              		.cfi_def_cfa_offset 4
 763              		@ sp needed
 764 0036 5DF804FB 		ldr	pc, [sp], #4
 765              	.L56:
 766 003a 00BF     		.align	2
 767              	.L55:
 768 003c 400D0300 		.word	200000
 769              		.cfi_endproc
 770              	.LFE133:
 772              		.section	.text.USB_OTG_SetCurrentMode,"ax",%progbits
 773              		.align	2
 774              		.global	USB_OTG_SetCurrentMode
 775              		.thumb
 776              		.thumb_func
 778              	USB_OTG_SetCurrentMode:
 779              	.LFB134:
 516:USB/core/usb_core.c **** 
 517:USB/core/usb_core.c **** 
 518:USB/core/usb_core.c **** /**
 519:USB/core/usb_core.c **** * @brief  USB_OTG_SetCurrentMode : Set ID line
 520:USB/core/usb_core.c **** * @param  pdev : Selected device
 521:USB/core/usb_core.c **** * @param  mode :  (Host/device)
 522:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 523:USB/core/usb_core.c **** */
 524:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_SetCurrentMode(USB_OTG_CORE_HANDLE *pdev , uint8_t mode)
 525:USB/core/usb_core.c **** {
 780              		.loc 1 525 0
 781              		.cfi_startproc
 782              		@ args = 0, pretend = 0, frame = 0
 783              		@ frame_needed = 0, uses_anonymous_args = 0
 784              	.LVL91:
 785 0000 08B5     		push	{r3, lr}
 786              	.LCFI16:
 787              		.cfi_def_cfa_offset 8
 788              		.cfi_offset 3, -8
 789              		.cfi_offset 14, -4
 790              	.LVL92:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 24


 526:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 527:USB/core/usb_core.c ****   USB_OTG_GUSBCFG_TypeDef  usbcfg;
 528:USB/core/usb_core.c ****   
 529:USB/core/usb_core.c ****   usbcfg.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->GUSBCFG);
 791              		.loc 1 529 0
 792 0002 C268     		ldr	r2, [r0, #12]
 793 0004 D368     		ldr	r3, [r2, #12]
 794              	.LVL93:
 530:USB/core/usb_core.c ****   
 531:USB/core/usb_core.c ****   usbcfg.b.force_host = 0;
 795              		.loc 1 531 0
 796 0006 6FF35D73 		bfc	r3, #29, #1
 532:USB/core/usb_core.c ****   usbcfg.b.force_dev = 0;
 797              		.loc 1 532 0
 798 000a 6FF39E73 		bfc	r3, #30, #1
 533:USB/core/usb_core.c ****   
 534:USB/core/usb_core.c ****   if ( mode == HOST_MODE)
 799              		.loc 1 534 0
 800 000e 0129     		cmp	r1, #1
 801 0010 02D1     		bne	.L58
 535:USB/core/usb_core.c ****   {
 536:USB/core/usb_core.c ****     usbcfg.b.force_host = 1;
 802              		.loc 1 536 0
 803 0012 43F00053 		orr	r3, r3, #536870912
 804              	.LVL94:
 805 0016 02E0     		b	.L59
 806              	.LVL95:
 807              	.L58:
 537:USB/core/usb_core.c ****   }
 538:USB/core/usb_core.c ****   else if ( mode == DEVICE_MODE)
 808              		.loc 1 538 0
 809 0018 09B9     		cbnz	r1, .L59
 539:USB/core/usb_core.c ****   {
 540:USB/core/usb_core.c ****     usbcfg.b.force_dev = 1;
 810              		.loc 1 540 0
 811 001a 43F08043 		orr	r3, r3, #1073741824
 812              	.LVL96:
 813              	.L59:
 541:USB/core/usb_core.c ****   }
 542:USB/core/usb_core.c ****   
 543:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GUSBCFG, usbcfg.d32);
 814              		.loc 1 543 0
 815 001e D360     		str	r3, [r2, #12]
 544:USB/core/usb_core.c ****   USB_OTG_BSP_mDelay(50);
 816              		.loc 1 544 0
 817 0020 3220     		movs	r0, #50
 818              	.LVL97:
 819 0022 FFF7FEFF 		bl	USB_OTG_BSP_mDelay
 820              	.LVL98:
 545:USB/core/usb_core.c ****   return status;
 546:USB/core/usb_core.c **** }
 821              		.loc 1 546 0
 822 0026 0020     		movs	r0, #0
 823 0028 08BD     		pop	{r3, pc}
 824              		.cfi_endproc
 825              	.LFE134:
 827 002a 00BF     		.section	.text.USB_OTG_GetMode,"ax",%progbits
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 25


 828              		.align	2
 829              		.global	USB_OTG_GetMode
 830              		.thumb
 831              		.thumb_func
 833              	USB_OTG_GetMode:
 834              	.LFB135:
 547:USB/core/usb_core.c **** 
 548:USB/core/usb_core.c **** 
 549:USB/core/usb_core.c **** /**
 550:USB/core/usb_core.c **** * @brief  USB_OTG_GetMode : Get current mode
 551:USB/core/usb_core.c **** * @param  pdev : Selected device
 552:USB/core/usb_core.c **** * @retval current mode
 553:USB/core/usb_core.c **** */
 554:USB/core/usb_core.c **** uint32_t USB_OTG_GetMode(USB_OTG_CORE_HANDLE *pdev)
 555:USB/core/usb_core.c **** {
 835              		.loc 1 555 0
 836              		.cfi_startproc
 837              		@ args = 0, pretend = 0, frame = 0
 838              		@ frame_needed = 0, uses_anonymous_args = 0
 839              		@ link register save eliminated.
 840              	.LVL99:
 556:USB/core/usb_core.c ****   return (USB_OTG_READ_REG32(&pdev->regs.GREGS->GINTSTS ) & 0x1);
 841              		.loc 1 556 0
 842 0000 C368     		ldr	r3, [r0, #12]
 843 0002 5869     		ldr	r0, [r3, #20]
 844              	.LVL100:
 557:USB/core/usb_core.c **** }
 845              		.loc 1 557 0
 846 0004 00F00100 		and	r0, r0, #1
 847 0008 7047     		bx	lr
 848              		.cfi_endproc
 849              	.LFE135:
 851              		.section	.text.USB_OTG_IsDeviceMode,"ax",%progbits
 852              		.align	2
 853              		.global	USB_OTG_IsDeviceMode
 854              		.thumb
 855              		.thumb_func
 857              	USB_OTG_IsDeviceMode:
 858              	.LFB136:
 558:USB/core/usb_core.c **** 
 559:USB/core/usb_core.c **** 
 560:USB/core/usb_core.c **** /**
 561:USB/core/usb_core.c **** * @brief  USB_OTG_IsDeviceMode : Check if it is device mode
 562:USB/core/usb_core.c **** * @param  pdev : Selected device
 563:USB/core/usb_core.c **** * @retval num_in_ep
 564:USB/core/usb_core.c **** */
 565:USB/core/usb_core.c **** uint8_t USB_OTG_IsDeviceMode(USB_OTG_CORE_HANDLE *pdev)
 566:USB/core/usb_core.c **** {
 859              		.loc 1 566 0
 860              		.cfi_startproc
 861              		@ args = 0, pretend = 0, frame = 0
 862              		@ frame_needed = 0, uses_anonymous_args = 0
 863              	.LVL101:
 864 0000 08B5     		push	{r3, lr}
 865              	.LCFI17:
 866              		.cfi_def_cfa_offset 8
 867              		.cfi_offset 3, -8
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 26


 868              		.cfi_offset 14, -4
 567:USB/core/usb_core.c ****   return (USB_OTG_GetMode(pdev) != HOST_MODE);
 869              		.loc 1 567 0
 870 0002 FFF7FEFF 		bl	USB_OTG_GetMode
 871              	.LVL102:
 568:USB/core/usb_core.c **** }
 872              		.loc 1 568 0
 873 0006 10F1FF30 		adds	r0, r0, #-1
 874 000a 18BF     		it	ne
 875 000c 0120     		movne	r0, #1
 876 000e 08BD     		pop	{r3, pc}
 877              		.cfi_endproc
 878              	.LFE136:
 880              		.section	.text.USB_OTG_IsHostMode,"ax",%progbits
 881              		.align	2
 882              		.global	USB_OTG_IsHostMode
 883              		.thumb
 884              		.thumb_func
 886              	USB_OTG_IsHostMode:
 887              	.LFB137:
 569:USB/core/usb_core.c **** 
 570:USB/core/usb_core.c **** 
 571:USB/core/usb_core.c **** /**
 572:USB/core/usb_core.c **** * @brief  USB_OTG_IsHostMode : Check if it is host mode
 573:USB/core/usb_core.c **** * @param  pdev : Selected device
 574:USB/core/usb_core.c **** * @retval num_in_ep
 575:USB/core/usb_core.c **** */
 576:USB/core/usb_core.c **** uint8_t USB_OTG_IsHostMode(USB_OTG_CORE_HANDLE *pdev)
 577:USB/core/usb_core.c **** {
 888              		.loc 1 577 0
 889              		.cfi_startproc
 890              		@ args = 0, pretend = 0, frame = 0
 891              		@ frame_needed = 0, uses_anonymous_args = 0
 892              	.LVL103:
 893 0000 08B5     		push	{r3, lr}
 894              	.LCFI18:
 895              		.cfi_def_cfa_offset 8
 896              		.cfi_offset 3, -8
 897              		.cfi_offset 14, -4
 578:USB/core/usb_core.c ****   return (USB_OTG_GetMode(pdev) == HOST_MODE);
 898              		.loc 1 578 0
 899 0002 FFF7FEFF 		bl	USB_OTG_GetMode
 900              	.LVL104:
 579:USB/core/usb_core.c **** }
 901              		.loc 1 579 0
 902 0006 0128     		cmp	r0, #1
 903 0008 14BF     		ite	ne
 904 000a 0020     		movne	r0, #0
 905 000c 0120     		moveq	r0, #1
 906 000e 08BD     		pop	{r3, pc}
 907              		.cfi_endproc
 908              	.LFE137:
 910              		.section	.text.USB_OTG_ReadCoreItr,"ax",%progbits
 911              		.align	2
 912              		.global	USB_OTG_ReadCoreItr
 913              		.thumb
 914              		.thumb_func
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 27


 916              	USB_OTG_ReadCoreItr:
 917              	.LFB138:
 580:USB/core/usb_core.c **** 
 581:USB/core/usb_core.c **** 
 582:USB/core/usb_core.c **** /**
 583:USB/core/usb_core.c **** * @brief  USB_OTG_ReadCoreItr : returns the Core Interrupt register
 584:USB/core/usb_core.c **** * @param  pdev : Selected device
 585:USB/core/usb_core.c **** * @retval Status
 586:USB/core/usb_core.c **** */
 587:USB/core/usb_core.c **** uint32_t USB_OTG_ReadCoreItr(USB_OTG_CORE_HANDLE *pdev)
 588:USB/core/usb_core.c **** {
 918              		.loc 1 588 0
 919              		.cfi_startproc
 920              		@ args = 0, pretend = 0, frame = 0
 921              		@ frame_needed = 0, uses_anonymous_args = 0
 922              		@ link register save eliminated.
 923              	.LVL105:
 589:USB/core/usb_core.c ****   uint32_t v = 0;
 590:USB/core/usb_core.c ****   v = USB_OTG_READ_REG32(&pdev->regs.GREGS->GINTSTS);
 924              		.loc 1 590 0
 925 0000 C368     		ldr	r3, [r0, #12]
 926 0002 5869     		ldr	r0, [r3, #20]
 927              	.LVL106:
 591:USB/core/usb_core.c ****   v &= USB_OTG_READ_REG32(&pdev->regs.GREGS->GINTMSK);
 928              		.loc 1 591 0
 929 0004 9B69     		ldr	r3, [r3, #24]
 930              	.LVL107:
 592:USB/core/usb_core.c ****   return v;
 593:USB/core/usb_core.c **** }
 931              		.loc 1 593 0
 932 0006 1840     		ands	r0, r0, r3
 933              	.LVL108:
 934 0008 7047     		bx	lr
 935              		.cfi_endproc
 936              	.LFE138:
 938 000a 00BF     		.section	.text.USB_OTG_ReadOtgItr,"ax",%progbits
 939              		.align	2
 940              		.global	USB_OTG_ReadOtgItr
 941              		.thumb
 942              		.thumb_func
 944              	USB_OTG_ReadOtgItr:
 945              	.LFB139:
 594:USB/core/usb_core.c **** 
 595:USB/core/usb_core.c **** 
 596:USB/core/usb_core.c **** /**
 597:USB/core/usb_core.c **** * @brief  USB_OTG_ReadOtgItr : returns the USB_OTG Interrupt register
 598:USB/core/usb_core.c **** * @param  pdev : Selected device
 599:USB/core/usb_core.c **** * @retval Status
 600:USB/core/usb_core.c **** */
 601:USB/core/usb_core.c **** uint32_t USB_OTG_ReadOtgItr (USB_OTG_CORE_HANDLE *pdev)
 602:USB/core/usb_core.c **** {
 946              		.loc 1 602 0
 947              		.cfi_startproc
 948              		@ args = 0, pretend = 0, frame = 0
 949              		@ frame_needed = 0, uses_anonymous_args = 0
 950              		@ link register save eliminated.
 951              	.LVL109:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 28


 603:USB/core/usb_core.c ****   return (USB_OTG_READ_REG32 (&pdev->regs.GREGS->GOTGINT));
 952              		.loc 1 603 0
 953 0000 C368     		ldr	r3, [r0, #12]
 954 0002 5868     		ldr	r0, [r3, #4]
 955              	.LVL110:
 604:USB/core/usb_core.c **** }
 956              		.loc 1 604 0
 957 0004 7047     		bx	lr
 958              		.cfi_endproc
 959              	.LFE139:
 961 0006 00BF     		.section	.text.USB_OTG_InitDevSpeed,"ax",%progbits
 962              		.align	2
 963              		.global	USB_OTG_InitDevSpeed
 964              		.thumb
 965              		.thumb_func
 967              	USB_OTG_InitDevSpeed:
 968              	.LFB140:
 605:USB/core/usb_core.c **** 
 606:USB/core/usb_core.c **** #ifdef USE_HOST_MODE
 607:USB/core/usb_core.c **** /**
 608:USB/core/usb_core.c **** * @brief  USB_OTG_CoreInitHost : Initializes USB_OTG controller for host mode
 609:USB/core/usb_core.c **** * @param  pdev : Selected device
 610:USB/core/usb_core.c **** * @retval status
 611:USB/core/usb_core.c **** */
 612:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_CoreInitHost(USB_OTG_CORE_HANDLE *pdev)
 613:USB/core/usb_core.c **** {
 614:USB/core/usb_core.c ****   USB_OTG_STS                     status = USB_OTG_OK;
 615:USB/core/usb_core.c ****   USB_OTG_FSIZ_TypeDef            nptxfifosize;
 616:USB/core/usb_core.c ****   USB_OTG_FSIZ_TypeDef            ptxfifosize;  
 617:USB/core/usb_core.c ****   USB_OTG_HCFG_TypeDef            hcfg;
 618:USB/core/usb_core.c ****   
 619:USB/core/usb_core.c **** #ifdef USE_OTG_MODE
 620:USB/core/usb_core.c ****   USB_OTG_OTGCTL_TypeDef          gotgctl;
 621:USB/core/usb_core.c **** #endif
 622:USB/core/usb_core.c ****   
 623:USB/core/usb_core.c ****   uint32_t                        i = 0;
 624:USB/core/usb_core.c ****   
 625:USB/core/usb_core.c ****   nptxfifosize.d32 = 0;  
 626:USB/core/usb_core.c ****   ptxfifosize.d32 = 0;
 627:USB/core/usb_core.c **** #ifdef USE_OTG_MODE
 628:USB/core/usb_core.c ****   gotgctl.d32 = 0;
 629:USB/core/usb_core.c **** #endif
 630:USB/core/usb_core.c ****   hcfg.d32 = 0;
 631:USB/core/usb_core.c ****   
 632:USB/core/usb_core.c ****   
 633:USB/core/usb_core.c ****   /* configure charge pump IO */
 634:USB/core/usb_core.c ****   USB_OTG_BSP_ConfigVBUS(pdev);
 635:USB/core/usb_core.c ****   
 636:USB/core/usb_core.c ****   /* Restart the Phy Clock */
 637:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(pdev->regs.PCGCCTL, 0);
 638:USB/core/usb_core.c ****   
 639:USB/core/usb_core.c ****   /* Initialize Host Configuration Register */
 640:USB/core/usb_core.c ****   if (pdev->cfg.phy_itface == USB_OTG_ULPI_PHY)
 641:USB/core/usb_core.c ****   {
 642:USB/core/usb_core.c ****     USB_OTG_InitFSLSPClkSel(pdev , HCFG_30_60_MHZ); 
 643:USB/core/usb_core.c ****   }
 644:USB/core/usb_core.c ****   else
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 29


 645:USB/core/usb_core.c ****   {
 646:USB/core/usb_core.c ****     USB_OTG_InitFSLSPClkSel(pdev , HCFG_48_MHZ); 
 647:USB/core/usb_core.c ****   }
 648:USB/core/usb_core.c ****   USB_OTG_ResetPort(pdev);
 649:USB/core/usb_core.c ****   
 650:USB/core/usb_core.c ****   hcfg.d32 = USB_OTG_READ_REG32(&pdev->regs.HREGS->HCFG);
 651:USB/core/usb_core.c ****   hcfg.b.fslssupp = 0;
 652:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HREGS->HCFG, hcfg.d32);
 653:USB/core/usb_core.c ****   
 654:USB/core/usb_core.c ****   /* Configure data FIFO sizes */
 655:USB/core/usb_core.c ****   /* Rx FIFO */
 656:USB/core/usb_core.c **** #ifdef USB_OTG_FS_CORE
 657:USB/core/usb_core.c ****   if(pdev->cfg.coreID == USB_OTG_FS_CORE_ID)
 658:USB/core/usb_core.c ****   {
 659:USB/core/usb_core.c ****     /* set Rx FIFO size */
 660:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GRXFSIZ, RX_FIFO_FS_SIZE);
 661:USB/core/usb_core.c ****     nptxfifosize.b.startaddr = RX_FIFO_FS_SIZE;   
 662:USB/core/usb_core.c ****     nptxfifosize.b.depth = TXH_NP_FS_FIFOSIZ;  
 663:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.GREGS->DIEPTXF0_HNPTXFSIZ, nptxfifosize.d32);
 664:USB/core/usb_core.c ****     
 665:USB/core/usb_core.c ****     ptxfifosize.b.startaddr = RX_FIFO_FS_SIZE + TXH_NP_FS_FIFOSIZ;
 666:USB/core/usb_core.c ****     ptxfifosize.b.depth     = TXH_P_FS_FIFOSIZ;
 667:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.GREGS->HPTXFSIZ, ptxfifosize.d32);      
 668:USB/core/usb_core.c ****   }
 669:USB/core/usb_core.c **** #endif
 670:USB/core/usb_core.c **** #ifdef USB_OTG_HS_CORE  
 671:USB/core/usb_core.c ****   if (pdev->cfg.coreID == USB_OTG_HS_CORE_ID)
 672:USB/core/usb_core.c ****   {
 673:USB/core/usb_core.c ****     /* set Rx FIFO size */
 674:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GRXFSIZ, RX_FIFO_HS_SIZE);
 675:USB/core/usb_core.c ****     nptxfifosize.b.startaddr = RX_FIFO_HS_SIZE;   
 676:USB/core/usb_core.c ****     nptxfifosize.b.depth = TXH_NP_HS_FIFOSIZ;  
 677:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.GREGS->DIEPTXF0_HNPTXFSIZ, nptxfifosize.d32);
 678:USB/core/usb_core.c ****     
 679:USB/core/usb_core.c ****     ptxfifosize.b.startaddr = RX_FIFO_HS_SIZE + TXH_NP_HS_FIFOSIZ;
 680:USB/core/usb_core.c ****     ptxfifosize.b.depth     = TXH_P_HS_FIFOSIZ;
 681:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.GREGS->HPTXFSIZ, ptxfifosize.d32);      
 682:USB/core/usb_core.c ****   }
 683:USB/core/usb_core.c **** #endif  
 684:USB/core/usb_core.c ****   
 685:USB/core/usb_core.c **** #ifdef USE_OTG_MODE
 686:USB/core/usb_core.c ****   /* Clear Host Set HNP Enable in the USB_OTG Control Register */
 687:USB/core/usb_core.c ****   gotgctl.b.hstsethnpen = 1;
 688:USB/core/usb_core.c ****   USB_OTG_MODIFY_REG32( &pdev->regs.GREGS->GOTGCTL, gotgctl.d32, 0);
 689:USB/core/usb_core.c **** #endif
 690:USB/core/usb_core.c ****   
 691:USB/core/usb_core.c ****   /* Make sure the FIFOs are flushed. */
 692:USB/core/usb_core.c ****   USB_OTG_FlushTxFifo(pdev, 0x10 );         /* all Tx FIFOs */
 693:USB/core/usb_core.c ****   USB_OTG_FlushRxFifo(pdev);
 694:USB/core/usb_core.c ****   
 695:USB/core/usb_core.c ****   
 696:USB/core/usb_core.c ****   /* Clear all pending HC Interrupts */
 697:USB/core/usb_core.c ****   for (i = 0; i < pdev->cfg.host_channels; i++)
 698:USB/core/usb_core.c ****   {
 699:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.HC_REGS[i]->HCINT, 0xFFFFFFFF );
 700:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.HC_REGS[i]->HCINTMSK, 0 );
 701:USB/core/usb_core.c ****   }
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 30


 702:USB/core/usb_core.c **** #ifndef USE_OTG_MODE
 703:USB/core/usb_core.c ****   USB_OTG_DriveVbus(pdev, 1);
 704:USB/core/usb_core.c **** #endif
 705:USB/core/usb_core.c ****   
 706:USB/core/usb_core.c ****   USB_OTG_EnableHostInt(pdev);
 707:USB/core/usb_core.c ****   return status;
 708:USB/core/usb_core.c **** }
 709:USB/core/usb_core.c **** 
 710:USB/core/usb_core.c **** /**
 711:USB/core/usb_core.c **** * @brief  USB_OTG_IsEvenFrame 
 712:USB/core/usb_core.c **** *         This function returns the frame number for sof packet
 713:USB/core/usb_core.c **** * @param  pdev : Selected device
 714:USB/core/usb_core.c **** * @retval Frame number
 715:USB/core/usb_core.c **** */
 716:USB/core/usb_core.c **** uint8_t USB_OTG_IsEvenFrame (USB_OTG_CORE_HANDLE *pdev) 
 717:USB/core/usb_core.c **** {
 718:USB/core/usb_core.c ****   return !(USB_OTG_READ_REG32(&pdev->regs.HREGS->HFNUM) & 0x1);
 719:USB/core/usb_core.c **** }
 720:USB/core/usb_core.c **** 
 721:USB/core/usb_core.c **** /**
 722:USB/core/usb_core.c **** * @brief  USB_OTG_DriveVbus : set/reset vbus
 723:USB/core/usb_core.c **** * @param  pdev : Selected device
 724:USB/core/usb_core.c **** * @param  state : VBUS state
 725:USB/core/usb_core.c **** * @retval None
 726:USB/core/usb_core.c **** */
 727:USB/core/usb_core.c **** void USB_OTG_DriveVbus (USB_OTG_CORE_HANDLE *pdev, uint8_t state)
 728:USB/core/usb_core.c **** {
 729:USB/core/usb_core.c ****   USB_OTG_HPRT0_TypeDef     hprt0;
 730:USB/core/usb_core.c ****   
 731:USB/core/usb_core.c ****   hprt0.d32 = 0;
 732:USB/core/usb_core.c ****   
 733:USB/core/usb_core.c ****   /* enable disable the external charge pump */
 734:USB/core/usb_core.c ****   USB_OTG_BSP_DriveVBUS(pdev, state);
 735:USB/core/usb_core.c ****   
 736:USB/core/usb_core.c ****   /* Turn on the Host port power. */
 737:USB/core/usb_core.c ****   hprt0.d32 = USB_OTG_ReadHPRT0(pdev);
 738:USB/core/usb_core.c ****   if ((hprt0.b.prtpwr == 0 ) && (state == 1 ))
 739:USB/core/usb_core.c ****   {
 740:USB/core/usb_core.c ****     hprt0.b.prtpwr = 1;
 741:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(pdev->regs.HPRT0, hprt0.d32);
 742:USB/core/usb_core.c ****   }
 743:USB/core/usb_core.c ****   if ((hprt0.b.prtpwr == 1 ) && (state == 0 ))
 744:USB/core/usb_core.c ****   {
 745:USB/core/usb_core.c ****     hprt0.b.prtpwr = 0;
 746:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(pdev->regs.HPRT0, hprt0.d32);
 747:USB/core/usb_core.c ****   }
 748:USB/core/usb_core.c ****   
 749:USB/core/usb_core.c ****   USB_OTG_BSP_mDelay(200);
 750:USB/core/usb_core.c **** }
 751:USB/core/usb_core.c **** /**
 752:USB/core/usb_core.c **** * @brief  USB_OTG_EnableHostInt: Enables the Host mode interrupts
 753:USB/core/usb_core.c **** * @param  pdev : Selected device
 754:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 755:USB/core/usb_core.c **** */
 756:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_EnableHostInt(USB_OTG_CORE_HANDLE *pdev)
 757:USB/core/usb_core.c **** {
 758:USB/core/usb_core.c ****   USB_OTG_STS       status = USB_OTG_OK;
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 31


 759:USB/core/usb_core.c ****   USB_OTG_GINTMSK_TypeDef  intmsk;
 760:USB/core/usb_core.c ****   intmsk.d32 = 0;
 761:USB/core/usb_core.c ****   /* Disable all interrupts. */
 762:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GINTMSK, 0);
 763:USB/core/usb_core.c ****   
 764:USB/core/usb_core.c ****   /* Clear any pending interrupts. */
 765:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GINTSTS, 0xFFFFFFFF);
 766:USB/core/usb_core.c ****   
 767:USB/core/usb_core.c ****   /* Enable the common interrupts */
 768:USB/core/usb_core.c ****   USB_OTG_EnableCommonInt(pdev);
 769:USB/core/usb_core.c ****   
 770:USB/core/usb_core.c ****   if (pdev->cfg.dma_enable == 0)
 771:USB/core/usb_core.c ****   {  
 772:USB/core/usb_core.c ****     intmsk.b.rxstsqlvl  = 1;
 773:USB/core/usb_core.c ****   }  
 774:USB/core/usb_core.c ****   intmsk.b.portintr   = 1;
 775:USB/core/usb_core.c ****   intmsk.b.hcintr     = 1;
 776:USB/core/usb_core.c ****   intmsk.b.disconnect = 1;  
 777:USB/core/usb_core.c ****   intmsk.b.sofintr    = 1;  
 778:USB/core/usb_core.c ****   intmsk.b.incomplisoout  = 1; 
 779:USB/core/usb_core.c ****   USB_OTG_MODIFY_REG32(&pdev->regs.GREGS->GINTMSK, intmsk.d32, intmsk.d32);
 780:USB/core/usb_core.c ****   return status;
 781:USB/core/usb_core.c **** }
 782:USB/core/usb_core.c **** 
 783:USB/core/usb_core.c **** /**
 784:USB/core/usb_core.c **** * @brief  USB_OTG_InitFSLSPClkSel : Initializes the FSLSPClkSel field of the 
 785:USB/core/usb_core.c **** *         HCFG register on the PHY type
 786:USB/core/usb_core.c **** * @param  pdev : Selected device
 787:USB/core/usb_core.c **** * @param  freq : clock frequency
 788:USB/core/usb_core.c **** * @retval None
 789:USB/core/usb_core.c **** */
 790:USB/core/usb_core.c **** void USB_OTG_InitFSLSPClkSel(USB_OTG_CORE_HANDLE *pdev , uint8_t freq)
 791:USB/core/usb_core.c **** {
 792:USB/core/usb_core.c ****   USB_OTG_HCFG_TypeDef   hcfg;
 793:USB/core/usb_core.c ****   
 794:USB/core/usb_core.c ****   hcfg.d32 = USB_OTG_READ_REG32(&pdev->regs.HREGS->HCFG);
 795:USB/core/usb_core.c ****   hcfg.b.fslspclksel = freq;
 796:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HREGS->HCFG, hcfg.d32);
 797:USB/core/usb_core.c **** }
 798:USB/core/usb_core.c **** 
 799:USB/core/usb_core.c **** 
 800:USB/core/usb_core.c **** /**
 801:USB/core/usb_core.c **** * @brief  USB_OTG_ReadHPRT0 : Reads HPRT0 to modify later
 802:USB/core/usb_core.c **** * @param  pdev : Selected device
 803:USB/core/usb_core.c **** * @retval HPRT0 value
 804:USB/core/usb_core.c **** */
 805:USB/core/usb_core.c **** uint32_t USB_OTG_ReadHPRT0(USB_OTG_CORE_HANDLE *pdev)
 806:USB/core/usb_core.c **** {
 807:USB/core/usb_core.c ****   USB_OTG_HPRT0_TypeDef  hprt0;
 808:USB/core/usb_core.c ****   
 809:USB/core/usb_core.c ****   hprt0.d32 = USB_OTG_READ_REG32(pdev->regs.HPRT0);
 810:USB/core/usb_core.c ****   hprt0.b.prtena = 0;
 811:USB/core/usb_core.c ****   hprt0.b.prtconndet = 0;
 812:USB/core/usb_core.c ****   hprt0.b.prtenchng = 0;
 813:USB/core/usb_core.c ****   hprt0.b.prtovrcurrchng = 0;
 814:USB/core/usb_core.c ****   return hprt0.d32;
 815:USB/core/usb_core.c **** }
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 32


 816:USB/core/usb_core.c **** 
 817:USB/core/usb_core.c **** 
 818:USB/core/usb_core.c **** /**
 819:USB/core/usb_core.c **** * @brief  USB_OTG_ReadHostAllChannels_intr : Register PCD Callbacks
 820:USB/core/usb_core.c **** * @param  pdev : Selected device
 821:USB/core/usb_core.c **** * @retval Status
 822:USB/core/usb_core.c **** */
 823:USB/core/usb_core.c **** uint32_t USB_OTG_ReadHostAllChannels_intr (USB_OTG_CORE_HANDLE *pdev)
 824:USB/core/usb_core.c **** {
 825:USB/core/usb_core.c ****   return (USB_OTG_READ_REG32 (&pdev->regs.HREGS->HAINT));
 826:USB/core/usb_core.c **** }
 827:USB/core/usb_core.c **** 
 828:USB/core/usb_core.c **** 
 829:USB/core/usb_core.c **** /**
 830:USB/core/usb_core.c **** * @brief  USB_OTG_ResetPort : Reset Host Port
 831:USB/core/usb_core.c **** * @param  pdev : Selected device
 832:USB/core/usb_core.c **** * @retval status
 833:USB/core/usb_core.c **** * @note : (1)The application must wait at least 10 ms (+ 10 ms security)
 834:USB/core/usb_core.c **** *   before clearing the reset bit.
 835:USB/core/usb_core.c **** */
 836:USB/core/usb_core.c **** uint32_t USB_OTG_ResetPort(USB_OTG_CORE_HANDLE *pdev)
 837:USB/core/usb_core.c **** {
 838:USB/core/usb_core.c ****   USB_OTG_HPRT0_TypeDef  hprt0;
 839:USB/core/usb_core.c ****   
 840:USB/core/usb_core.c ****   hprt0.d32 = USB_OTG_ReadHPRT0(pdev);
 841:USB/core/usb_core.c ****   hprt0.b.prtrst = 1;
 842:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(pdev->regs.HPRT0, hprt0.d32);
 843:USB/core/usb_core.c ****   USB_OTG_BSP_mDelay (10);                                /* See Note #1 */
 844:USB/core/usb_core.c ****   hprt0.b.prtrst = 0;
 845:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(pdev->regs.HPRT0, hprt0.d32);
 846:USB/core/usb_core.c ****   USB_OTG_BSP_mDelay (20);   
 847:USB/core/usb_core.c ****   return 1;
 848:USB/core/usb_core.c **** }
 849:USB/core/usb_core.c **** 
 850:USB/core/usb_core.c **** 
 851:USB/core/usb_core.c **** /**
 852:USB/core/usb_core.c **** * @brief  USB_OTG_HC_Init : Prepares a host channel for transferring packets
 853:USB/core/usb_core.c **** * @param  pdev : Selected device
 854:USB/core/usb_core.c **** * @param  hc_num : channel number
 855:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 856:USB/core/usb_core.c **** */
 857:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_HC_Init(USB_OTG_CORE_HANDLE *pdev , uint8_t hc_num)
 858:USB/core/usb_core.c **** {
 859:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 860:USB/core/usb_core.c ****   uint32_t intr_enable = 0;
 861:USB/core/usb_core.c ****   USB_OTG_HCINTMSK_TypeDef  hcintmsk;
 862:USB/core/usb_core.c ****   USB_OTG_GINTMSK_TypeDef    gintmsk;
 863:USB/core/usb_core.c ****   USB_OTG_HCCHAR_TypeDef     hcchar;
 864:USB/core/usb_core.c ****   USB_OTG_HCINTn_TypeDef     hcint;
 865:USB/core/usb_core.c ****   
 866:USB/core/usb_core.c ****   
 867:USB/core/usb_core.c ****   gintmsk.d32 = 0;
 868:USB/core/usb_core.c ****   hcintmsk.d32 = 0;
 869:USB/core/usb_core.c ****   hcchar.d32 = 0;
 870:USB/core/usb_core.c ****   
 871:USB/core/usb_core.c ****   /* Clear old interrupt conditions for this host channel. */
 872:USB/core/usb_core.c ****   hcint.d32 = 0xFFFFFFFF;
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 33


 873:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[hc_num]->HCINT, hcint.d32);
 874:USB/core/usb_core.c ****   
 875:USB/core/usb_core.c ****   /* Enable channel interrupts required for this transfer. */
 876:USB/core/usb_core.c ****   hcintmsk.d32 = 0;
 877:USB/core/usb_core.c ****   
 878:USB/core/usb_core.c ****   if (pdev->cfg.dma_enable == 1)
 879:USB/core/usb_core.c ****   {
 880:USB/core/usb_core.c ****     hcintmsk.b.ahberr = 1;
 881:USB/core/usb_core.c ****   }
 882:USB/core/usb_core.c ****   
 883:USB/core/usb_core.c ****   switch (pdev->host.hc[hc_num].ep_type) 
 884:USB/core/usb_core.c ****   {
 885:USB/core/usb_core.c ****   case EP_TYPE_CTRL:
 886:USB/core/usb_core.c ****   case EP_TYPE_BULK:
 887:USB/core/usb_core.c ****     hcintmsk.b.xfercompl = 1;
 888:USB/core/usb_core.c ****     hcintmsk.b.stall = 1;
 889:USB/core/usb_core.c ****     hcintmsk.b.xacterr = 1;
 890:USB/core/usb_core.c ****     hcintmsk.b.datatglerr = 1;
 891:USB/core/usb_core.c ****     hcintmsk.b.nak = 1;  
 892:USB/core/usb_core.c ****     if (pdev->host.hc[hc_num].ep_is_in) 
 893:USB/core/usb_core.c ****     {
 894:USB/core/usb_core.c ****       hcintmsk.b.bblerr = 1;
 895:USB/core/usb_core.c ****     } 
 896:USB/core/usb_core.c ****     else 
 897:USB/core/usb_core.c ****     {
 898:USB/core/usb_core.c ****       hcintmsk.b.nyet = 1;
 899:USB/core/usb_core.c ****       if (pdev->host.hc[hc_num].do_ping) 
 900:USB/core/usb_core.c ****       {
 901:USB/core/usb_core.c ****         hcintmsk.b.ack = 1;
 902:USB/core/usb_core.c ****       }
 903:USB/core/usb_core.c ****     }
 904:USB/core/usb_core.c ****     break;
 905:USB/core/usb_core.c ****   case EP_TYPE_INTR:
 906:USB/core/usb_core.c ****     hcintmsk.b.xfercompl = 1;
 907:USB/core/usb_core.c ****     hcintmsk.b.nak = 1;
 908:USB/core/usb_core.c ****     hcintmsk.b.stall = 1;
 909:USB/core/usb_core.c ****     hcintmsk.b.xacterr = 1;
 910:USB/core/usb_core.c ****     hcintmsk.b.datatglerr = 1;
 911:USB/core/usb_core.c ****     hcintmsk.b.frmovrun = 1;
 912:USB/core/usb_core.c ****     
 913:USB/core/usb_core.c ****     if (pdev->host.hc[hc_num].ep_is_in) 
 914:USB/core/usb_core.c ****     {
 915:USB/core/usb_core.c ****       hcintmsk.b.bblerr = 1;
 916:USB/core/usb_core.c ****     }
 917:USB/core/usb_core.c ****     
 918:USB/core/usb_core.c ****     break;
 919:USB/core/usb_core.c ****   case EP_TYPE_ISOC:
 920:USB/core/usb_core.c ****     hcintmsk.b.xfercompl = 1;
 921:USB/core/usb_core.c ****     hcintmsk.b.frmovrun = 1;
 922:USB/core/usb_core.c ****     hcintmsk.b.ack = 1;
 923:USB/core/usb_core.c ****     
 924:USB/core/usb_core.c ****     if (pdev->host.hc[hc_num].ep_is_in) 
 925:USB/core/usb_core.c ****     {
 926:USB/core/usb_core.c ****       hcintmsk.b.xacterr = 1;
 927:USB/core/usb_core.c ****       hcintmsk.b.bblerr = 1;
 928:USB/core/usb_core.c ****     }
 929:USB/core/usb_core.c ****     break;
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 34


 930:USB/core/usb_core.c ****   }
 931:USB/core/usb_core.c ****   
 932:USB/core/usb_core.c ****   
 933:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[hc_num]->HCINTMSK, hcintmsk.d32);
 934:USB/core/usb_core.c ****   
 935:USB/core/usb_core.c ****   
 936:USB/core/usb_core.c ****   /* Enable the top level host channel interrupt. */
 937:USB/core/usb_core.c ****   intr_enable = (1 << hc_num);
 938:USB/core/usb_core.c ****   USB_OTG_MODIFY_REG32(&pdev->regs.HREGS->HAINTMSK, 0, intr_enable);
 939:USB/core/usb_core.c ****   
 940:USB/core/usb_core.c ****   /* Make sure host channel interrupts are enabled. */
 941:USB/core/usb_core.c ****   gintmsk.b.hcintr = 1;
 942:USB/core/usb_core.c ****   USB_OTG_MODIFY_REG32(&pdev->regs.GREGS->GINTMSK, 0, gintmsk.d32);
 943:USB/core/usb_core.c ****   
 944:USB/core/usb_core.c ****   /* Program the HCCHAR register */
 945:USB/core/usb_core.c ****   hcchar.d32 = 0;
 946:USB/core/usb_core.c ****   hcchar.b.devaddr = pdev->host.hc[hc_num].dev_addr;
 947:USB/core/usb_core.c ****   hcchar.b.epnum   = pdev->host.hc[hc_num].ep_num;
 948:USB/core/usb_core.c ****   hcchar.b.epdir   = pdev->host.hc[hc_num].ep_is_in;
 949:USB/core/usb_core.c ****   hcchar.b.lspddev = (pdev->host.hc[hc_num].speed == HPRT0_PRTSPD_LOW_SPEED);
 950:USB/core/usb_core.c ****   hcchar.b.eptype  = pdev->host.hc[hc_num].ep_type;
 951:USB/core/usb_core.c ****   hcchar.b.mps     = pdev->host.hc[hc_num].max_packet;
 952:USB/core/usb_core.c ****   if (pdev->host.hc[hc_num].ep_type == HCCHAR_INTR)
 953:USB/core/usb_core.c ****   {
 954:USB/core/usb_core.c ****     hcchar.b.oddfrm  = 1;
 955:USB/core/usb_core.c ****   }
 956:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[hc_num]->HCCHAR, hcchar.d32);
 957:USB/core/usb_core.c ****   return status;
 958:USB/core/usb_core.c **** }
 959:USB/core/usb_core.c **** 
 960:USB/core/usb_core.c **** 
 961:USB/core/usb_core.c **** /**
 962:USB/core/usb_core.c **** * @brief  USB_OTG_HC_StartXfer : Start transfer
 963:USB/core/usb_core.c **** * @param  pdev : Selected device
 964:USB/core/usb_core.c **** * @param  hc_num : channel number
 965:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
 966:USB/core/usb_core.c **** */
 967:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_HC_StartXfer(USB_OTG_CORE_HANDLE *pdev , uint8_t hc_num)
 968:USB/core/usb_core.c **** {
 969:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
 970:USB/core/usb_core.c ****   USB_OTG_HCCHAR_TypeDef   hcchar;
 971:USB/core/usb_core.c ****   USB_OTG_HCTSIZn_TypeDef  hctsiz;
 972:USB/core/usb_core.c ****   USB_OTG_HNPTXSTS_TypeDef hnptxsts; 
 973:USB/core/usb_core.c ****   USB_OTG_HPTXSTS_TypeDef  hptxsts; 
 974:USB/core/usb_core.c ****   USB_OTG_GINTMSK_TypeDef  intmsk;
 975:USB/core/usb_core.c ****   uint16_t                 len_words = 0;   
 976:USB/core/usb_core.c ****   
 977:USB/core/usb_core.c ****   uint16_t num_packets;
 978:USB/core/usb_core.c ****   uint16_t max_hc_pkt_count;
 979:USB/core/usb_core.c ****   
 980:USB/core/usb_core.c ****   max_hc_pkt_count = 256;
 981:USB/core/usb_core.c ****   hctsiz.d32 = 0;
 982:USB/core/usb_core.c ****   hcchar.d32 = 0;
 983:USB/core/usb_core.c ****   intmsk.d32 = 0;
 984:USB/core/usb_core.c ****   
 985:USB/core/usb_core.c ****   /* Compute the expected number of packets associated to the transfer */
 986:USB/core/usb_core.c ****   if (pdev->host.hc[hc_num].xfer_len > 0)
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 35


 987:USB/core/usb_core.c ****   {
 988:USB/core/usb_core.c ****     num_packets = (pdev->host.hc[hc_num].xfer_len + \
 989:USB/core/usb_core.c ****       pdev->host.hc[hc_num].max_packet - 1) / pdev->host.hc[hc_num].max_packet;
 990:USB/core/usb_core.c ****     
 991:USB/core/usb_core.c ****     if (num_packets > max_hc_pkt_count)
 992:USB/core/usb_core.c ****     {
 993:USB/core/usb_core.c ****       num_packets = max_hc_pkt_count;
 994:USB/core/usb_core.c ****       pdev->host.hc[hc_num].xfer_len = num_packets * \
 995:USB/core/usb_core.c ****         pdev->host.hc[hc_num].max_packet;
 996:USB/core/usb_core.c ****     }
 997:USB/core/usb_core.c ****   }
 998:USB/core/usb_core.c ****   else
 999:USB/core/usb_core.c ****   {
1000:USB/core/usb_core.c ****     num_packets = 1;
1001:USB/core/usb_core.c ****   }
1002:USB/core/usb_core.c ****   if (pdev->host.hc[hc_num].ep_is_in)
1003:USB/core/usb_core.c ****   {
1004:USB/core/usb_core.c ****     pdev->host.hc[hc_num].xfer_len = num_packets * \
1005:USB/core/usb_core.c ****       pdev->host.hc[hc_num].max_packet;
1006:USB/core/usb_core.c ****   }
1007:USB/core/usb_core.c ****   /* Initialize the HCTSIZn register */
1008:USB/core/usb_core.c ****   hctsiz.b.xfersize = pdev->host.hc[hc_num].xfer_len;
1009:USB/core/usb_core.c ****   hctsiz.b.pktcnt = num_packets;
1010:USB/core/usb_core.c ****   hctsiz.b.pid = pdev->host.hc[hc_num].data_pid;
1011:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[hc_num]->HCTSIZ, hctsiz.d32);
1012:USB/core/usb_core.c ****   
1013:USB/core/usb_core.c ****   if (pdev->cfg.dma_enable == 1)
1014:USB/core/usb_core.c ****   {
1015:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[hc_num]->HCDMA, (unsigned int)pdev->host.hc[hc_num].xfe
1016:USB/core/usb_core.c ****   }
1017:USB/core/usb_core.c ****   
1018:USB/core/usb_core.c ****   
1019:USB/core/usb_core.c ****   hcchar.d32 = USB_OTG_READ_REG32(&pdev->regs.HC_REGS[hc_num]->HCCHAR);
1020:USB/core/usb_core.c ****   hcchar.b.oddfrm = USB_OTG_IsEvenFrame(pdev);
1021:USB/core/usb_core.c ****   
1022:USB/core/usb_core.c ****   /* Set host channel enable */
1023:USB/core/usb_core.c ****   hcchar.b.chen = 1;
1024:USB/core/usb_core.c ****   hcchar.b.chdis = 0;
1025:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[hc_num]->HCCHAR, hcchar.d32);
1026:USB/core/usb_core.c ****   
1027:USB/core/usb_core.c ****   if (pdev->cfg.dma_enable == 0) /* Slave mode */
1028:USB/core/usb_core.c ****   {  
1029:USB/core/usb_core.c ****     if((pdev->host.hc[hc_num].ep_is_in == 0) && 
1030:USB/core/usb_core.c ****        (pdev->host.hc[hc_num].xfer_len > 0))
1031:USB/core/usb_core.c ****     {
1032:USB/core/usb_core.c ****       switch(pdev->host.hc[hc_num].ep_type) 
1033:USB/core/usb_core.c ****       {
1034:USB/core/usb_core.c ****         /* Non periodic transfer */
1035:USB/core/usb_core.c ****       case EP_TYPE_CTRL:
1036:USB/core/usb_core.c ****       case EP_TYPE_BULK:
1037:USB/core/usb_core.c ****         
1038:USB/core/usb_core.c ****         hnptxsts.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->HNPTXSTS);
1039:USB/core/usb_core.c ****         len_words = (pdev->host.hc[hc_num].xfer_len + 3) / 4;
1040:USB/core/usb_core.c ****         
1041:USB/core/usb_core.c ****         /* check if there is enough space in FIFO space */
1042:USB/core/usb_core.c ****         if(len_words > hnptxsts.b.nptxfspcavail)
1043:USB/core/usb_core.c ****         {
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 36


1044:USB/core/usb_core.c ****           /* need to process data in nptxfempty interrupt */
1045:USB/core/usb_core.c ****           intmsk.b.nptxfempty = 1;
1046:USB/core/usb_core.c ****           USB_OTG_MODIFY_REG32( &pdev->regs.GREGS->GINTMSK, 0, intmsk.d32);  
1047:USB/core/usb_core.c ****         }
1048:USB/core/usb_core.c ****         
1049:USB/core/usb_core.c ****         break;
1050:USB/core/usb_core.c ****         /* Periodic transfer */
1051:USB/core/usb_core.c ****       case EP_TYPE_INTR:
1052:USB/core/usb_core.c ****       case EP_TYPE_ISOC:
1053:USB/core/usb_core.c ****         hptxsts.d32 = USB_OTG_READ_REG32(&pdev->regs.HREGS->HPTXSTS);
1054:USB/core/usb_core.c ****         len_words = (pdev->host.hc[hc_num].xfer_len + 3) / 4;
1055:USB/core/usb_core.c ****         /* check if there is enough space in FIFO space */
1056:USB/core/usb_core.c ****         if(len_words > hptxsts.b.ptxfspcavail) /* split the transfer */
1057:USB/core/usb_core.c ****         {
1058:USB/core/usb_core.c ****           /* need to process data in ptxfempty interrupt */
1059:USB/core/usb_core.c ****           intmsk.b.ptxfempty = 1;
1060:USB/core/usb_core.c ****           USB_OTG_MODIFY_REG32( &pdev->regs.GREGS->GINTMSK, 0, intmsk.d32);  
1061:USB/core/usb_core.c ****         }
1062:USB/core/usb_core.c ****         break;
1063:USB/core/usb_core.c ****         
1064:USB/core/usb_core.c ****       default:
1065:USB/core/usb_core.c ****         break;
1066:USB/core/usb_core.c ****       }
1067:USB/core/usb_core.c ****       
1068:USB/core/usb_core.c ****       /* Write packet into the Tx FIFO. */
1069:USB/core/usb_core.c ****       USB_OTG_WritePacket(pdev, 
1070:USB/core/usb_core.c ****                           pdev->host.hc[hc_num].xfer_buff , 
1071:USB/core/usb_core.c ****                           hc_num, pdev->host.hc[hc_num].xfer_len);
1072:USB/core/usb_core.c ****     }
1073:USB/core/usb_core.c ****   }
1074:USB/core/usb_core.c ****   return status;
1075:USB/core/usb_core.c **** }
1076:USB/core/usb_core.c **** 
1077:USB/core/usb_core.c **** 
1078:USB/core/usb_core.c **** /**
1079:USB/core/usb_core.c **** * @brief  USB_OTG_HC_Halt : Halt channel
1080:USB/core/usb_core.c **** * @param  pdev : Selected device
1081:USB/core/usb_core.c **** * @param  hc_num : channel number
1082:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1083:USB/core/usb_core.c **** */
1084:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_HC_Halt(USB_OTG_CORE_HANDLE *pdev , uint8_t hc_num)
1085:USB/core/usb_core.c **** {
1086:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
1087:USB/core/usb_core.c ****   USB_OTG_HNPTXSTS_TypeDef            nptxsts;
1088:USB/core/usb_core.c ****   USB_OTG_HPTXSTS_TypeDef             hptxsts;
1089:USB/core/usb_core.c ****   USB_OTG_HCCHAR_TypeDef              hcchar;
1090:USB/core/usb_core.c ****   
1091:USB/core/usb_core.c ****   nptxsts.d32 = 0;
1092:USB/core/usb_core.c ****   hptxsts.d32 = 0;
1093:USB/core/usb_core.c ****   hcchar.d32 = USB_OTG_READ_REG32(&pdev->regs.HC_REGS[hc_num]->HCCHAR);
1094:USB/core/usb_core.c ****   hcchar.b.chen = 1;
1095:USB/core/usb_core.c ****   hcchar.b.chdis = 1;
1096:USB/core/usb_core.c ****   
1097:USB/core/usb_core.c ****   /* Check for space in the request queue to issue the halt. */
1098:USB/core/usb_core.c ****   if (hcchar.b.eptype == HCCHAR_CTRL || hcchar.b.eptype == HCCHAR_BULK)
1099:USB/core/usb_core.c ****   {
1100:USB/core/usb_core.c ****     nptxsts.d32 = USB_OTG_READ_REG32(&pdev->regs.GREGS->HNPTXSTS);
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 37


1101:USB/core/usb_core.c ****     if (nptxsts.b.nptxqspcavail == 0)
1102:USB/core/usb_core.c ****     {
1103:USB/core/usb_core.c ****       hcchar.b.chen = 0;
1104:USB/core/usb_core.c ****     }
1105:USB/core/usb_core.c ****   }
1106:USB/core/usb_core.c ****   else
1107:USB/core/usb_core.c ****   {
1108:USB/core/usb_core.c ****     hptxsts.d32 = USB_OTG_READ_REG32(&pdev->regs.HREGS->HPTXSTS);
1109:USB/core/usb_core.c ****     if (hptxsts.b.ptxqspcavail == 0)
1110:USB/core/usb_core.c ****     {
1111:USB/core/usb_core.c ****       hcchar.b.chen = 0;
1112:USB/core/usb_core.c ****     }
1113:USB/core/usb_core.c ****   }
1114:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[hc_num]->HCCHAR, hcchar.d32);
1115:USB/core/usb_core.c ****   return status;
1116:USB/core/usb_core.c **** }
1117:USB/core/usb_core.c **** 
1118:USB/core/usb_core.c **** /**
1119:USB/core/usb_core.c **** * @brief  Issue a ping token
1120:USB/core/usb_core.c **** * @param  None
1121:USB/core/usb_core.c **** * @retval : None
1122:USB/core/usb_core.c **** */
1123:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_HC_DoPing(USB_OTG_CORE_HANDLE *pdev , uint8_t hc_num)
1124:USB/core/usb_core.c **** {
1125:USB/core/usb_core.c ****   USB_OTG_STS               status = USB_OTG_OK;
1126:USB/core/usb_core.c ****   USB_OTG_HCCHAR_TypeDef    hcchar;
1127:USB/core/usb_core.c ****   USB_OTG_HCTSIZn_TypeDef   hctsiz;  
1128:USB/core/usb_core.c ****   
1129:USB/core/usb_core.c ****   hctsiz.d32 = 0;
1130:USB/core/usb_core.c ****   hctsiz.b.dopng = 1;
1131:USB/core/usb_core.c ****   hctsiz.b.pktcnt = 1;
1132:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[hc_num]->HCTSIZ, hctsiz.d32);
1133:USB/core/usb_core.c ****   
1134:USB/core/usb_core.c ****   hcchar.d32 = USB_OTG_READ_REG32(&pdev->regs.HC_REGS[hc_num]->HCCHAR);
1135:USB/core/usb_core.c ****   hcchar.b.chen = 1;
1136:USB/core/usb_core.c ****   hcchar.b.chdis = 0;
1137:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[hc_num]->HCCHAR, hcchar.d32);
1138:USB/core/usb_core.c ****   return status;  
1139:USB/core/usb_core.c **** }
1140:USB/core/usb_core.c **** 
1141:USB/core/usb_core.c **** /**
1142:USB/core/usb_core.c **** * @brief  Stop the device and clean up fifo's
1143:USB/core/usb_core.c **** * @param  None
1144:USB/core/usb_core.c **** * @retval : None
1145:USB/core/usb_core.c **** */
1146:USB/core/usb_core.c **** void USB_OTG_StopHost(USB_OTG_CORE_HANDLE *pdev)
1147:USB/core/usb_core.c **** {
1148:USB/core/usb_core.c ****   USB_OTG_HCCHAR_TypeDef  hcchar;
1149:USB/core/usb_core.c ****   uint32_t                i;
1150:USB/core/usb_core.c ****   
1151:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HREGS->HAINTMSK , 0);
1152:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.HREGS->HAINT,      0xFFFFFFFF);
1153:USB/core/usb_core.c ****   /* Flush out any leftover queued requests. */
1154:USB/core/usb_core.c ****   
1155:USB/core/usb_core.c ****   for (i = 0; i < pdev->cfg.host_channels; i++)
1156:USB/core/usb_core.c ****   {
1157:USB/core/usb_core.c ****     hcchar.d32 = USB_OTG_READ_REG32(&pdev->regs.HC_REGS[i]->HCCHAR);
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 38


1158:USB/core/usb_core.c ****     hcchar.b.chen = 0;
1159:USB/core/usb_core.c ****     hcchar.b.chdis = 1;
1160:USB/core/usb_core.c ****     hcchar.b.epdir = 0;
1161:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.HC_REGS[i]->HCCHAR, hcchar.d32);
1162:USB/core/usb_core.c ****   }
1163:USB/core/usb_core.c ****   
1164:USB/core/usb_core.c ****   /* Flush the FIFO */
1165:USB/core/usb_core.c ****   USB_OTG_FlushRxFifo(pdev);
1166:USB/core/usb_core.c ****   USB_OTG_FlushTxFifo(pdev ,  0x10 );  
1167:USB/core/usb_core.c **** }
1168:USB/core/usb_core.c **** #endif
1169:USB/core/usb_core.c **** #ifdef USE_DEVICE_MODE
1170:USB/core/usb_core.c **** /*         PCD Core Layer       */
1171:USB/core/usb_core.c **** 
1172:USB/core/usb_core.c **** /**
1173:USB/core/usb_core.c **** * @brief  USB_OTG_InitDevSpeed :Initializes the DevSpd field of DCFG register 
1174:USB/core/usb_core.c **** *         depending the PHY type and the enumeration speed of the device.
1175:USB/core/usb_core.c **** * @param  pdev : Selected device
1176:USB/core/usb_core.c **** * @retval : None
1177:USB/core/usb_core.c **** */
1178:USB/core/usb_core.c **** void USB_OTG_InitDevSpeed(USB_OTG_CORE_HANDLE *pdev , uint8_t speed)
1179:USB/core/usb_core.c **** {
 969              		.loc 1 1179 0
 970              		.cfi_startproc
 971              		@ args = 0, pretend = 0, frame = 0
 972              		@ frame_needed = 0, uses_anonymous_args = 0
 973              		@ link register save eliminated.
 974              	.LVL111:
1180:USB/core/usb_core.c ****   USB_OTG_DCFG_TypeDef   dcfg;
1181:USB/core/usb_core.c ****   
1182:USB/core/usb_core.c ****   dcfg.d32 = USB_OTG_READ_REG32(&pdev->regs.DREGS->DCFG);
 975              		.loc 1 1182 0
 976 0000 0269     		ldr	r2, [r0, #16]
 977 0002 1368     		ldr	r3, [r2]
1183:USB/core/usb_core.c ****   dcfg.b.devspd = speed;
 978              		.loc 1 1183 0
 979 0004 61F30103 		bfi	r3, r1, #0, #2
 980              	.LVL112:
1184:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.DREGS->DCFG, dcfg.d32);
 981              		.loc 1 1184 0
 982 0008 1360     		str	r3, [r2]
 983 000a 7047     		bx	lr
 984              		.cfi_endproc
 985              	.LFE140:
 987              		.section	.text.USB_OTG_EnableDevInt,"ax",%progbits
 988              		.align	2
 989              		.global	USB_OTG_EnableDevInt
 990              		.thumb
 991              		.thumb_func
 993              	USB_OTG_EnableDevInt:
 994              	.LFB142:
1185:USB/core/usb_core.c **** }
1186:USB/core/usb_core.c **** 
1187:USB/core/usb_core.c **** 
1188:USB/core/usb_core.c **** /**
1189:USB/core/usb_core.c **** * @brief  USB_OTG_CoreInitDev : Initializes the USB_OTG controller registers 
1190:USB/core/usb_core.c **** *         for device mode
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 39


1191:USB/core/usb_core.c **** * @param  pdev : Selected device
1192:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1193:USB/core/usb_core.c **** */
1194:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_CoreInitDev (USB_OTG_CORE_HANDLE *pdev)
1195:USB/core/usb_core.c **** {
1196:USB/core/usb_core.c ****   USB_OTG_STS             status       = USB_OTG_OK;
1197:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef  depctl;
1198:USB/core/usb_core.c ****   uint32_t i;
1199:USB/core/usb_core.c ****   USB_OTG_DCFG_TypeDef    dcfg;
1200:USB/core/usb_core.c ****   USB_OTG_FSIZ_TypeDef    nptxfifosize;
1201:USB/core/usb_core.c ****   USB_OTG_FSIZ_TypeDef    txfifosize;
1202:USB/core/usb_core.c ****   USB_OTG_DIEPMSK_TypeDef msk;
1203:USB/core/usb_core.c ****   USB_OTG_DTHRCTL_TypeDef dthrctl;  
1204:USB/core/usb_core.c ****   
1205:USB/core/usb_core.c ****   depctl.d32 = 0;
1206:USB/core/usb_core.c ****   dcfg.d32 = 0;
1207:USB/core/usb_core.c ****   nptxfifosize.d32 = 0;
1208:USB/core/usb_core.c ****   txfifosize.d32 = 0;
1209:USB/core/usb_core.c ****   msk.d32 = 0;
1210:USB/core/usb_core.c ****   
1211:USB/core/usb_core.c ****   /* Restart the Phy Clock */
1212:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(pdev->regs.PCGCCTL, 0);
1213:USB/core/usb_core.c ****   /* Device configuration register */
1214:USB/core/usb_core.c ****   dcfg.d32 = USB_OTG_READ_REG32( &pdev->regs.DREGS->DCFG);
1215:USB/core/usb_core.c ****   dcfg.b.perfrint = DCFG_FRAME_INTERVAL_80;
1216:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DCFG, dcfg.d32 );
1217:USB/core/usb_core.c ****   
1218:USB/core/usb_core.c **** #ifdef USB_OTG_FS_CORE
1219:USB/core/usb_core.c ****   if(pdev->cfg.coreID == USB_OTG_FS_CORE_ID  )
1220:USB/core/usb_core.c ****   {  
1221:USB/core/usb_core.c ****     
1222:USB/core/usb_core.c ****     /* Set Full speed phy */
1223:USB/core/usb_core.c ****     USB_OTG_InitDevSpeed (pdev , USB_OTG_SPEED_PARAM_FULL);
1224:USB/core/usb_core.c ****     
1225:USB/core/usb_core.c ****     /* set Rx FIFO size */
1226:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GRXFSIZ, RX_FIFO_FS_SIZE);
1227:USB/core/usb_core.c ****     
1228:USB/core/usb_core.c ****     /* EP0 TX*/
1229:USB/core/usb_core.c ****     nptxfifosize.b.depth     = TX0_FIFO_FS_SIZE;
1230:USB/core/usb_core.c ****     nptxfifosize.b.startaddr = RX_FIFO_FS_SIZE;
1231:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF0_HNPTXFSIZ, nptxfifosize.d32 );
1232:USB/core/usb_core.c ****     
1233:USB/core/usb_core.c ****     
1234:USB/core/usb_core.c ****     /* EP1 TX*/
1235:USB/core/usb_core.c ****     txfifosize.b.startaddr = nptxfifosize.b.startaddr + nptxfifosize.b.depth;
1236:USB/core/usb_core.c ****     txfifosize.b.depth = TX1_FIFO_FS_SIZE;
1237:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[0], txfifosize.d32 );
1238:USB/core/usb_core.c ****     
1239:USB/core/usb_core.c ****     
1240:USB/core/usb_core.c ****     /* EP2 TX*/
1241:USB/core/usb_core.c ****     txfifosize.b.startaddr += txfifosize.b.depth;
1242:USB/core/usb_core.c ****     txfifosize.b.depth = TX2_FIFO_FS_SIZE;
1243:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[1], txfifosize.d32 );
1244:USB/core/usb_core.c ****     
1245:USB/core/usb_core.c ****     
1246:USB/core/usb_core.c ****     /* EP3 TX*/  
1247:USB/core/usb_core.c ****     txfifosize.b.startaddr += txfifosize.b.depth;
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 40


1248:USB/core/usb_core.c ****     txfifosize.b.depth = TX3_FIFO_FS_SIZE;
1249:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[2], txfifosize.d32 );
1250:USB/core/usb_core.c ****   }
1251:USB/core/usb_core.c **** #endif
1252:USB/core/usb_core.c **** #ifdef USB_OTG_HS_CORE
1253:USB/core/usb_core.c ****   if(pdev->cfg.coreID == USB_OTG_HS_CORE_ID  )
1254:USB/core/usb_core.c ****   {
1255:USB/core/usb_core.c ****     
1256:USB/core/usb_core.c ****     /* Set High speed phy */
1257:USB/core/usb_core.c ****     
1258:USB/core/usb_core.c ****     if(pdev->cfg.phy_itface  == USB_OTG_ULPI_PHY)
1259:USB/core/usb_core.c ****     {
1260:USB/core/usb_core.c ****       USB_OTG_InitDevSpeed (pdev , USB_OTG_SPEED_PARAM_HIGH);
1261:USB/core/usb_core.c ****     }
1262:USB/core/usb_core.c ****     else /* set High speed phy in Full speed mode */
1263:USB/core/usb_core.c ****     {
1264:USB/core/usb_core.c ****       USB_OTG_InitDevSpeed (pdev , USB_OTG_SPEED_PARAM_HIGH_IN_FULL);
1265:USB/core/usb_core.c ****     }
1266:USB/core/usb_core.c ****     
1267:USB/core/usb_core.c ****     /* set Rx FIFO size */
1268:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.GREGS->GRXFSIZ, RX_FIFO_HS_SIZE);
1269:USB/core/usb_core.c ****     
1270:USB/core/usb_core.c ****     /* EP0 TX*/
1271:USB/core/usb_core.c ****     nptxfifosize.b.depth     = TX0_FIFO_HS_SIZE;
1272:USB/core/usb_core.c ****     nptxfifosize.b.startaddr = RX_FIFO_HS_SIZE;
1273:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF0_HNPTXFSIZ, nptxfifosize.d32 );
1274:USB/core/usb_core.c ****     
1275:USB/core/usb_core.c ****     
1276:USB/core/usb_core.c ****     /* EP1 TX*/
1277:USB/core/usb_core.c ****     txfifosize.b.startaddr = nptxfifosize.b.startaddr + nptxfifosize.b.depth;
1278:USB/core/usb_core.c ****     txfifosize.b.depth = TX1_FIFO_HS_SIZE;
1279:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[0], txfifosize.d32 );
1280:USB/core/usb_core.c ****     
1281:USB/core/usb_core.c ****     
1282:USB/core/usb_core.c ****     /* EP2 TX*/
1283:USB/core/usb_core.c ****     txfifosize.b.startaddr += txfifosize.b.depth;
1284:USB/core/usb_core.c ****     txfifosize.b.depth = TX2_FIFO_HS_SIZE;
1285:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[1], txfifosize.d32 );
1286:USB/core/usb_core.c ****     
1287:USB/core/usb_core.c ****     
1288:USB/core/usb_core.c ****     /* EP3 TX*/  
1289:USB/core/usb_core.c ****     txfifosize.b.startaddr += txfifosize.b.depth;
1290:USB/core/usb_core.c ****     txfifosize.b.depth = TX3_FIFO_HS_SIZE;
1291:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[2], txfifosize.d32 );
1292:USB/core/usb_core.c ****     
1293:USB/core/usb_core.c ****     /* EP4 TX*/
1294:USB/core/usb_core.c ****     txfifosize.b.startaddr += txfifosize.b.depth;
1295:USB/core/usb_core.c ****     txfifosize.b.depth = TX4_FIFO_HS_SIZE;
1296:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[3], txfifosize.d32 );
1297:USB/core/usb_core.c ****     
1298:USB/core/usb_core.c ****     
1299:USB/core/usb_core.c ****     /* EP5 TX*/  
1300:USB/core/usb_core.c ****     txfifosize.b.startaddr += txfifosize.b.depth;
1301:USB/core/usb_core.c ****     txfifosize.b.depth = TX5_FIFO_HS_SIZE;
1302:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[4], txfifosize.d32 );
1303:USB/core/usb_core.c ****   }
1304:USB/core/usb_core.c **** #endif  
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 41


1305:USB/core/usb_core.c ****   /* Flush the FIFOs */
1306:USB/core/usb_core.c ****   USB_OTG_FlushTxFifo(pdev , 0x10); /* all Tx FIFOs */
1307:USB/core/usb_core.c ****   USB_OTG_FlushRxFifo(pdev);
1308:USB/core/usb_core.c ****   /* Clear all pending Device Interrupts */
1309:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DIEPMSK, 0 );
1310:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DOEPMSK, 0 );
1311:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DAINT, 0xFFFFFFFF );
1312:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DAINTMSK, 0 );
1313:USB/core/usb_core.c ****   
1314:USB/core/usb_core.c ****   for (i = 0; i < pdev->cfg.dev_endpoints; i++)
1315:USB/core/usb_core.c ****   {
1316:USB/core/usb_core.c ****     depctl.d32 = USB_OTG_READ_REG32(&pdev->regs.INEP_REGS[i]->DIEPCTL);
1317:USB/core/usb_core.c ****     if (depctl.b.epena)
1318:USB/core/usb_core.c ****     {
1319:USB/core/usb_core.c ****       depctl.d32 = 0;
1320:USB/core/usb_core.c ****       depctl.b.epdis = 1;
1321:USB/core/usb_core.c ****       depctl.b.snak = 1;
1322:USB/core/usb_core.c ****     }
1323:USB/core/usb_core.c ****     else
1324:USB/core/usb_core.c ****     {
1325:USB/core/usb_core.c ****       depctl.d32 = 0;
1326:USB/core/usb_core.c ****     }
1327:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.INEP_REGS[i]->DIEPCTL, depctl.d32);
1328:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.INEP_REGS[i]->DIEPTSIZ, 0);
1329:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.INEP_REGS[i]->DIEPINT, 0xFF);
1330:USB/core/usb_core.c ****   }
1331:USB/core/usb_core.c ****   for (i = 0; i <  pdev->cfg.dev_endpoints; i++)
1332:USB/core/usb_core.c ****   {
1333:USB/core/usb_core.c ****     USB_OTG_DEPCTL_TypeDef  depctl;
1334:USB/core/usb_core.c ****     depctl.d32 = USB_OTG_READ_REG32(&pdev->regs.OUTEP_REGS[i]->DOEPCTL);
1335:USB/core/usb_core.c ****     if (depctl.b.epena)
1336:USB/core/usb_core.c ****     {
1337:USB/core/usb_core.c ****       depctl.d32 = 0;
1338:USB/core/usb_core.c ****       depctl.b.epdis = 1;
1339:USB/core/usb_core.c ****       depctl.b.snak = 1;
1340:USB/core/usb_core.c ****     }
1341:USB/core/usb_core.c ****     else
1342:USB/core/usb_core.c ****     {
1343:USB/core/usb_core.c ****       depctl.d32 = 0;
1344:USB/core/usb_core.c ****     }
1345:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.OUTEP_REGS[i]->DOEPCTL, depctl.d32);
1346:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.OUTEP_REGS[i]->DOEPTSIZ, 0);
1347:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.OUTEP_REGS[i]->DOEPINT, 0xFF);
1348:USB/core/usb_core.c ****   }
1349:USB/core/usb_core.c ****   msk.d32 = 0;
1350:USB/core/usb_core.c ****   msk.b.txfifoundrn = 1;
1351:USB/core/usb_core.c ****   USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DIEPMSK, msk.d32, msk.d32);
1352:USB/core/usb_core.c ****   
1353:USB/core/usb_core.c ****   if (pdev->cfg.dma_enable == 1)
1354:USB/core/usb_core.c ****   {
1355:USB/core/usb_core.c ****     dthrctl.d32 = 0;
1356:USB/core/usb_core.c ****     dthrctl.b.non_iso_thr_en = 1;
1357:USB/core/usb_core.c ****     dthrctl.b.iso_thr_en = 1;
1358:USB/core/usb_core.c ****     dthrctl.b.tx_thr_len = 64;
1359:USB/core/usb_core.c ****     dthrctl.b.rx_thr_en = 1;
1360:USB/core/usb_core.c ****     dthrctl.b.rx_thr_len = 64;
1361:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.DREGS->DTHRCTL, dthrctl.d32);  
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 42


1362:USB/core/usb_core.c ****   }
1363:USB/core/usb_core.c ****   USB_OTG_EnableDevInt(pdev);
1364:USB/core/usb_core.c ****   return status;
1365:USB/core/usb_core.c **** }
1366:USB/core/usb_core.c **** 
1367:USB/core/usb_core.c **** 
1368:USB/core/usb_core.c **** /**
1369:USB/core/usb_core.c **** * @brief  USB_OTG_EnableDevInt : Enables the Device mode interrupts
1370:USB/core/usb_core.c **** * @param  pdev : Selected device
1371:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1372:USB/core/usb_core.c **** */
1373:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_EnableDevInt(USB_OTG_CORE_HANDLE *pdev)
1374:USB/core/usb_core.c **** {
 995              		.loc 1 1374 0
 996              		.cfi_startproc
 997              		@ args = 0, pretend = 0, frame = 0
 998              		@ frame_needed = 0, uses_anonymous_args = 0
 999              	.LVL113:
 1000 0000 38B5     		push	{r3, r4, r5, lr}
 1001              	.LCFI19:
 1002              		.cfi_def_cfa_offset 16
 1003              		.cfi_offset 3, -16
 1004              		.cfi_offset 4, -12
 1005              		.cfi_offset 5, -8
 1006              		.cfi_offset 14, -4
 1007 0002 0546     		mov	r5, r0
 1008              	.LVL114:
1375:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
1376:USB/core/usb_core.c ****   USB_OTG_GINTMSK_TypeDef  intmsk;
1377:USB/core/usb_core.c ****   
1378:USB/core/usb_core.c ****   intmsk.d32 = 0;
 1009              		.loc 1 1378 0
 1010 0004 0024     		movs	r4, #0
 1011              	.LVL115:
1379:USB/core/usb_core.c ****   
1380:USB/core/usb_core.c ****   /* Disable all interrupts. */
1381:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.GREGS->GINTMSK, 0);
 1012              		.loc 1 1381 0
 1013 0006 C368     		ldr	r3, [r0, #12]
 1014              	.LVL116:
 1015 0008 9C61     		str	r4, [r3, #24]
1382:USB/core/usb_core.c ****   /* Clear any pending interrupts */
1383:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.GREGS->GINTSTS, 0xBFFFFFFF);
 1016              		.loc 1 1383 0
 1017 000a C368     		ldr	r3, [r0, #12]
 1018 000c 6FF08042 		mvn	r2, #1073741824
 1019 0010 5A61     		str	r2, [r3, #20]
1384:USB/core/usb_core.c ****   /* Enable the common interrupts */
1385:USB/core/usb_core.c ****   USB_OTG_EnableCommonInt(pdev);
 1020              		.loc 1 1385 0
 1021 0012 FFF7FEFF 		bl	USB_OTG_EnableCommonInt
 1022              	.LVL117:
1386:USB/core/usb_core.c ****   
1387:USB/core/usb_core.c ****   if (pdev->cfg.dma_enable == 0)
 1023              		.loc 1 1387 0
 1024 0016 EB78     		ldrb	r3, [r5, #3]	@ zero_extendqisi2
 1025 0018 03B9     		cbnz	r3, .L70
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 43


1388:USB/core/usb_core.c ****   {
1389:USB/core/usb_core.c ****     intmsk.b.rxstsqlvl = 1;
 1026              		.loc 1 1389 0
 1027 001a 1024     		movs	r4, #16
 1028              	.LVL118:
 1029              	.L70:
1390:USB/core/usb_core.c ****   }
1391:USB/core/usb_core.c ****   
1392:USB/core/usb_core.c ****   /* Enable interrupts matching to the Device mode ONLY */
1393:USB/core/usb_core.c ****   intmsk.b.usbsuspend = 1;
1394:USB/core/usb_core.c ****   intmsk.b.usbreset   = 1;
1395:USB/core/usb_core.c ****   intmsk.b.enumdone   = 1;
1396:USB/core/usb_core.c ****   intmsk.b.inepintr   = 1;
1397:USB/core/usb_core.c ****   intmsk.b.outepintr  = 1;
1398:USB/core/usb_core.c ****   intmsk.b.sofintr    = 1; 
1399:USB/core/usb_core.c ****   
1400:USB/core/usb_core.c ****   intmsk.b.incomplisoin    = 1; 
1401:USB/core/usb_core.c ****   intmsk.b.incomplisoout    = 1;   
 1030              		.loc 1 1401 0
 1031 001c 44F47014 		orr	r4, r4, #3932160
 1032              	.LVL119:
 1033 0020 44F46054 		orr	r4, r4, #14336
 1034              	.LVL120:
 1035 0024 44F00804 		orr	r4, r4, #8
 1036              	.LVL121:
1402:USB/core/usb_core.c **** #ifdef VBUS_SENSING_ENABLED
1403:USB/core/usb_core.c ****   intmsk.b.sessreqintr    = 1; 
1404:USB/core/usb_core.c ****   intmsk.b.otgintr    = 1;    
1405:USB/core/usb_core.c **** #endif  
1406:USB/core/usb_core.c ****   USB_OTG_MODIFY_REG32( &pdev->regs.GREGS->GINTMSK, intmsk.d32, intmsk.d32);
 1037              		.loc 1 1406 0
 1038 0028 EA68     		ldr	r2, [r5, #12]
 1039 002a 9369     		ldr	r3, [r2, #24]
 1040              	.LVL122:
 1041 002c 23EA0403 		bic	r3, r3, r4
 1042 0030 1C43     		orrs	r4, r4, r3
 1043              	.LVL123:
 1044 0032 9461     		str	r4, [r2, #24]
1407:USB/core/usb_core.c ****   return status;
1408:USB/core/usb_core.c **** }
 1045              		.loc 1 1408 0
 1046 0034 0020     		movs	r0, #0
 1047 0036 38BD     		pop	{r3, r4, r5, pc}
 1048              		.cfi_endproc
 1049              	.LFE142:
 1051              		.section	.text.USB_OTG_CoreInitDev,"ax",%progbits
 1052              		.align	2
 1053              		.global	USB_OTG_CoreInitDev
 1054              		.thumb
 1055              		.thumb_func
 1057              	USB_OTG_CoreInitDev:
 1058              	.LFB141:
1195:USB/core/usb_core.c ****   USB_OTG_STS             status       = USB_OTG_OK;
 1059              		.loc 1 1195 0
 1060              		.cfi_startproc
 1061              		@ args = 0, pretend = 0, frame = 0
 1062              		@ frame_needed = 0, uses_anonymous_args = 0
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 44


 1063              	.LVL124:
 1064 0000 70B5     		push	{r4, r5, r6, lr}
 1065              	.LCFI20:
 1066              		.cfi_def_cfa_offset 16
 1067              		.cfi_offset 4, -16
 1068              		.cfi_offset 5, -12
 1069              		.cfi_offset 6, -8
 1070              		.cfi_offset 14, -4
 1071 0002 0446     		mov	r4, r0
 1072              	.LVL125:
1207:USB/core/usb_core.c ****   txfifosize.d32 = 0;
 1073              		.loc 1 1207 0
 1074 0004 0025     		movs	r5, #0
 1075              	.LVL126:
1212:USB/core/usb_core.c ****   /* Device configuration register */
 1076              		.loc 1 1212 0
 1077 0006 D0F80C31 		ldr	r3, [r0, #268]
 1078              	.LVL127:
 1079 000a 1D60     		str	r5, [r3]
1214:USB/core/usb_core.c ****   dcfg.b.perfrint = DCFG_FRAME_INTERVAL_80;
 1080              		.loc 1 1214 0
 1081 000c 0269     		ldr	r2, [r0, #16]
 1082 000e 1368     		ldr	r3, [r2]
1215:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DCFG, dcfg.d32 );
 1083              		.loc 1 1215 0
 1084 0010 65F3CC23 		bfi	r3, r5, #11, #2
 1085              	.LVL128:
1216:USB/core/usb_core.c ****   
 1086              		.loc 1 1216 0
 1087 0014 1360     		str	r3, [r2]
1219:USB/core/usb_core.c ****   {  
 1088              		.loc 1 1219 0
 1089 0016 C37A     		ldrb	r3, [r0, #11]	@ zero_extendqisi2
 1090              	.LVL129:
 1091 0018 012B     		cmp	r3, #1
 1092 001a 27D1     		bne	.L73
 1093 001c 2E46     		mov	r6, r5
 1094              	.LVL130:
1223:USB/core/usb_core.c ****     
 1095              		.loc 1 1223 0
 1096 001e 0321     		movs	r1, #3
 1097 0020 FFF7FEFF 		bl	USB_OTG_InitDevSpeed
 1098              	.LVL131:
1226:USB/core/usb_core.c ****     
 1099              		.loc 1 1226 0
 1100 0024 E268     		ldr	r2, [r4, #12]
 1101 0026 8023     		movs	r3, #128
 1102 0028 5362     		str	r3, [r2, #36]
1229:USB/core/usb_core.c ****     nptxfifosize.b.startaddr = RX_FIFO_FS_SIZE;
 1103              		.loc 1 1229 0
 1104 002a 2022     		movs	r2, #32
 1105 002c 62F31F45 		bfi	r5, r2, #16, #16
1230:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF0_HNPTXFSIZ, nptxfifosize.d32 );
 1106              		.loc 1 1230 0
 1107 0030 63F30F05 		bfi	r5, r3, #0, #16
1231:USB/core/usb_core.c ****     
 1108              		.loc 1 1231 0
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 45


 1109 0034 E168     		ldr	r1, [r4, #12]
 1110 0036 8D62     		str	r5, [r1, #40]
1235:USB/core/usb_core.c ****     txfifosize.b.depth = TX1_FIFO_FS_SIZE;
 1111              		.loc 1 1235 0
 1112 0038 A021     		movs	r1, #160
 1113 003a 61F30F06 		bfi	r6, r1, #0, #16
 1114              	.LVL132:
1236:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[0], txfifosize.d32 );
 1115              		.loc 1 1236 0
 1116 003e 63F31F46 		bfi	r6, r3, #16, #16
1237:USB/core/usb_core.c ****     
 1117              		.loc 1 1237 0
 1118 0042 E368     		ldr	r3, [r4, #12]
 1119 0044 C3F80461 		str	r6, [r3, #260]
1241:USB/core/usb_core.c ****     txfifosize.b.depth = TX2_FIFO_FS_SIZE;
 1120              		.loc 1 1241 0
 1121 0048 4FF49073 		mov	r3, #288
 1122 004c 63F30F06 		bfi	r6, r3, #0, #16
1242:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[1], txfifosize.d32 );
 1123              		.loc 1 1242 0
 1124 0050 62F31F46 		bfi	r6, r2, #16, #16
1243:USB/core/usb_core.c ****     
 1125              		.loc 1 1243 0
 1126 0054 E368     		ldr	r3, [r4, #12]
 1127 0056 C3F80861 		str	r6, [r3, #264]
1247:USB/core/usb_core.c ****     txfifosize.b.depth = TX3_FIFO_FS_SIZE;
 1128              		.loc 1 1247 0
 1129 005a 4FF4A073 		mov	r3, #320
 1130 005e 63F30F06 		bfi	r6, r3, #0, #16
1248:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.GREGS->DIEPTXF[2], txfifosize.d32 );
 1131              		.loc 1 1248 0
 1132 0062 6FF31F46 		bfc	r6, #16, #16
1249:USB/core/usb_core.c ****   }
 1133              		.loc 1 1249 0
 1134 0066 E368     		ldr	r3, [r4, #12]
 1135 0068 C3F80C61 		str	r6, [r3, #268]
 1136              	.L73:
1306:USB/core/usb_core.c ****   USB_OTG_FlushRxFifo(pdev);
 1137              		.loc 1 1306 0
 1138 006c 1021     		movs	r1, #16
 1139 006e 2046     		mov	r0, r4
 1140 0070 FFF7FEFF 		bl	USB_OTG_FlushTxFifo
 1141              	.LVL133:
1307:USB/core/usb_core.c ****   /* Clear all pending Device Interrupts */
 1142              		.loc 1 1307 0
 1143 0074 2046     		mov	r0, r4
 1144 0076 FFF7FEFF 		bl	USB_OTG_FlushRxFifo
 1145              	.LVL134:
1309:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DOEPMSK, 0 );
 1146              		.loc 1 1309 0
 1147 007a 2369     		ldr	r3, [r4, #16]
 1148 007c 0022     		movs	r2, #0
 1149 007e 1A61     		str	r2, [r3, #16]
1310:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DAINT, 0xFFFFFFFF );
 1150              		.loc 1 1310 0
 1151 0080 2369     		ldr	r3, [r4, #16]
 1152 0082 5A61     		str	r2, [r3, #20]
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 46


1311:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DAINTMSK, 0 );
 1153              		.loc 1 1311 0
 1154 0084 2369     		ldr	r3, [r4, #16]
 1155 0086 4FF0FF31 		mov	r1, #-1
 1156 008a 9961     		str	r1, [r3, #24]
1312:USB/core/usb_core.c ****   
 1157              		.loc 1 1312 0
 1158 008c 2369     		ldr	r3, [r4, #16]
 1159 008e DA61     		str	r2, [r3, #28]
 1160              	.LVL135:
1314:USB/core/usb_core.c ****   {
 1161              		.loc 1 1314 0
 1162 0090 16E0     		b	.L74
 1163              	.LVL136:
 1164              	.L77:
1316:USB/core/usb_core.c ****     if (depctl.b.epena)
 1165              		.loc 1 1316 0
 1166 0092 131D     		adds	r3, r2, #4
 1167 0094 04EB8303 		add	r3, r4, r3, lsl #2
 1168 0098 9B68     		ldr	r3, [r3, #8]
 1169 009a 1B68     		ldr	r3, [r3]
1317:USB/core/usb_core.c ****     {
 1170              		.loc 1 1317 0
 1171 009c 002B     		cmp	r3, #0
 1172 009e 02DA     		bge	.L75
1321:USB/core/usb_core.c ****     }
 1173              		.loc 1 1321 0
 1174 00a0 4FF09041 		mov	r1, #1207959552
 1175              	.LVL137:
 1176 00a4 00E0     		b	.L76
 1177              	.L75:
1325:USB/core/usb_core.c ****     }
 1178              		.loc 1 1325 0
 1179 00a6 0021     		movs	r1, #0
 1180              	.L76:
1327:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.INEP_REGS[i]->DIEPTSIZ, 0);
 1181              		.loc 1 1327 0 discriminator 2
 1182 00a8 131D     		adds	r3, r2, #4
 1183 00aa 04EB8303 		add	r3, r4, r3, lsl #2
 1184 00ae 9868     		ldr	r0, [r3, #8]
 1185              	.LVL138:
 1186 00b0 0160     		str	r1, [r0]
1328:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.INEP_REGS[i]->DIEPINT, 0xFF);
 1187              		.loc 1 1328 0 discriminator 2
 1188 00b2 9968     		ldr	r1, [r3, #8]
 1189              	.LVL139:
 1190 00b4 0020     		movs	r0, #0
 1191 00b6 0861     		str	r0, [r1, #16]
1329:USB/core/usb_core.c ****   }
 1192              		.loc 1 1329 0 discriminator 2
 1193 00b8 9B68     		ldr	r3, [r3, #8]
 1194 00ba FF21     		movs	r1, #255
 1195 00bc 9960     		str	r1, [r3, #8]
1314:USB/core/usb_core.c ****   {
 1196              		.loc 1 1314 0 discriminator 2
 1197 00be 0132     		adds	r2, r2, #1
 1198              	.LVL140:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 47


 1199              	.L74:
1314:USB/core/usb_core.c ****   {
 1200              		.loc 1 1314 0 is_stmt 0 discriminator 1
 1201 00c0 6378     		ldrb	r3, [r4, #1]	@ zero_extendqisi2
 1202 00c2 9A42     		cmp	r2, r3
 1203 00c4 E5D3     		bcc	.L77
 1204 00c6 0022     		movs	r2, #0
 1205              	.LVL141:
 1206 00c8 18E0     		b	.L78
 1207              	.LVL142:
 1208              	.L81:
 1209              	.LBB3:
1334:USB/core/usb_core.c ****     if (depctl.b.epena)
 1210              		.loc 1 1334 0 is_stmt 1
 1211 00ca 02F11403 		add	r3, r2, #20
 1212 00ce 04EB8303 		add	r3, r4, r3, lsl #2
 1213 00d2 5B68     		ldr	r3, [r3, #4]
 1214 00d4 1B68     		ldr	r3, [r3]
1335:USB/core/usb_core.c ****     {
 1215              		.loc 1 1335 0
 1216 00d6 002B     		cmp	r3, #0
 1217 00d8 02DA     		bge	.L79
1339:USB/core/usb_core.c ****     }
 1218              		.loc 1 1339 0
 1219 00da 4FF09041 		mov	r1, #1207959552
 1220              	.LVL143:
 1221 00de 00E0     		b	.L80
 1222              	.L79:
1343:USB/core/usb_core.c ****     }
 1223              		.loc 1 1343 0
 1224 00e0 0021     		movs	r1, #0
 1225              	.L80:
1345:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.OUTEP_REGS[i]->DOEPTSIZ, 0);
 1226              		.loc 1 1345 0 discriminator 2
 1227 00e2 02F11403 		add	r3, r2, #20
 1228 00e6 04EB8303 		add	r3, r4, r3, lsl #2
 1229 00ea 5868     		ldr	r0, [r3, #4]
 1230              	.LVL144:
 1231 00ec 0160     		str	r1, [r0]
1346:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.OUTEP_REGS[i]->DOEPINT, 0xFF);
 1232              		.loc 1 1346 0 discriminator 2
 1233 00ee 5968     		ldr	r1, [r3, #4]
 1234              	.LVL145:
 1235 00f0 0020     		movs	r0, #0
 1236 00f2 0861     		str	r0, [r1, #16]
1347:USB/core/usb_core.c ****   }
 1237              		.loc 1 1347 0 discriminator 2
 1238 00f4 5B68     		ldr	r3, [r3, #4]
 1239 00f6 FF21     		movs	r1, #255
 1240 00f8 9960     		str	r1, [r3, #8]
 1241              	.LBE3:
1331:USB/core/usb_core.c ****   {
 1242              		.loc 1 1331 0 discriminator 2
 1243 00fa 0132     		adds	r2, r2, #1
 1244              	.LVL146:
 1245              	.L78:
1331:USB/core/usb_core.c ****   {
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 48


 1246              		.loc 1 1331 0 is_stmt 0 discriminator 1
 1247 00fc 6378     		ldrb	r3, [r4, #1]	@ zero_extendqisi2
 1248 00fe 9A42     		cmp	r2, r3
 1249 0100 E3D3     		bcc	.L81
1351:USB/core/usb_core.c ****   
 1250              		.loc 1 1351 0 is_stmt 1
 1251 0102 2269     		ldr	r2, [r4, #16]
 1252              	.LVL147:
 1253 0104 1369     		ldr	r3, [r2, #16]
 1254 0106 43F48073 		orr	r3, r3, #256
 1255 010a 1361     		str	r3, [r2, #16]
1353:USB/core/usb_core.c ****   {
 1256              		.loc 1 1353 0
 1257 010c E378     		ldrb	r3, [r4, #3]	@ zero_extendqisi2
 1258 010e 012B     		cmp	r3, #1
 1259 0110 09D1     		bne	.L82
1357:USB/core/usb_core.c ****     dthrctl.b.tx_thr_len = 64;
 1260              		.loc 1 1357 0
 1261 0112 0323     		movs	r3, #3
 1262              	.LVL148:
1358:USB/core/usb_core.c ****     dthrctl.b.rx_thr_en = 1;
 1263              		.loc 1 1358 0
 1264 0114 4022     		movs	r2, #64
 1265 0116 62F38A03 		bfi	r3, r2, #2, #9
 1266              	.LVL149:
1359:USB/core/usb_core.c ****     dthrctl.b.rx_thr_len = 64;
 1267              		.loc 1 1359 0
 1268 011a 43F48033 		orr	r3, r3, #65536
 1269              	.LVL150:
1360:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.DREGS->DTHRCTL, dthrctl.d32);  
 1270              		.loc 1 1360 0
 1271 011e 62F35943 		bfi	r3, r2, #17, #9
 1272              	.LVL151:
1361:USB/core/usb_core.c ****   }
 1273              		.loc 1 1361 0
 1274 0122 2269     		ldr	r2, [r4, #16]
 1275 0124 1363     		str	r3, [r2, #48]
 1276              	.L82:
1363:USB/core/usb_core.c ****   return status;
 1277              		.loc 1 1363 0
 1278 0126 2046     		mov	r0, r4
 1279 0128 FFF7FEFF 		bl	USB_OTG_EnableDevInt
 1280              	.LVL152:
1365:USB/core/usb_core.c **** 
 1281              		.loc 1 1365 0
 1282 012c 0020     		movs	r0, #0
 1283 012e 70BD     		pop	{r4, r5, r6, pc}
 1284              		.cfi_endproc
 1285              	.LFE141:
 1287              		.section	.text.USB_OTG_GetDeviceSpeed,"ax",%progbits
 1288              		.align	2
 1289              		.global	USB_OTG_GetDeviceSpeed
 1290              		.thumb
 1291              		.thumb_func
 1293              	USB_OTG_GetDeviceSpeed:
 1294              	.LFB143:
1409:USB/core/usb_core.c **** 
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 49


1410:USB/core/usb_core.c **** 
1411:USB/core/usb_core.c **** /**
1412:USB/core/usb_core.c **** * @brief  USB_OTG_GetDeviceSpeed
1413:USB/core/usb_core.c **** *         Get the device speed from the device status register
1414:USB/core/usb_core.c **** * @param  None
1415:USB/core/usb_core.c **** * @retval status
1416:USB/core/usb_core.c **** */
1417:USB/core/usb_core.c **** enum USB_OTG_SPEED USB_OTG_GetDeviceSpeed (USB_OTG_CORE_HANDLE *pdev)
1418:USB/core/usb_core.c **** {
 1295              		.loc 1 1418 0
 1296              		.cfi_startproc
 1297              		@ args = 0, pretend = 0, frame = 0
 1298              		@ frame_needed = 0, uses_anonymous_args = 0
 1299              		@ link register save eliminated.
 1300              	.LVL153:
1419:USB/core/usb_core.c ****   USB_OTG_DSTS_TypeDef  dsts;
1420:USB/core/usb_core.c ****   enum USB_OTG_SPEED speed = USB_SPEED_UNKNOWN;
1421:USB/core/usb_core.c ****   
1422:USB/core/usb_core.c ****   
1423:USB/core/usb_core.c ****   dsts.d32 = USB_OTG_READ_REG32(&pdev->regs.DREGS->DSTS);
 1301              		.loc 1 1423 0
 1302 0000 0369     		ldr	r3, [r0, #16]
 1303 0002 9B68     		ldr	r3, [r3, #8]
1424:USB/core/usb_core.c ****   
1425:USB/core/usb_core.c ****   switch (dsts.b.enumspd)
 1304              		.loc 1 1425 0
 1305 0004 C3F34103 		ubfx	r3, r3, #1, #2
 1306 0008 022B     		cmp	r3, #2
 1307 000a 04D0     		beq	.L86
 1308 000c 05D8     		bhi	.L88
 1309 000e 012B     		cmp	r3, #1
 1310 0010 03D0     		beq	.L88
1426:USB/core/usb_core.c ****   {
1427:USB/core/usb_core.c ****   case DSTS_ENUMSPD_HS_PHY_30MHZ_OR_60MHZ:
1428:USB/core/usb_core.c ****     speed = USB_SPEED_HIGH;
 1311              		.loc 1 1428 0
 1312 0012 0320     		movs	r0, #3
 1313              	.LVL154:
 1314 0014 7047     		bx	lr
 1315              	.LVL155:
 1316              	.L86:
1429:USB/core/usb_core.c ****     break;
1430:USB/core/usb_core.c ****   case DSTS_ENUMSPD_FS_PHY_30MHZ_OR_60MHZ:
1431:USB/core/usb_core.c ****   case DSTS_ENUMSPD_FS_PHY_48MHZ:
1432:USB/core/usb_core.c ****     speed = USB_SPEED_FULL;
1433:USB/core/usb_core.c ****     break;
1434:USB/core/usb_core.c ****     
1435:USB/core/usb_core.c ****   case DSTS_ENUMSPD_LS_PHY_6MHZ:
1436:USB/core/usb_core.c ****     speed = USB_SPEED_LOW;
 1317              		.loc 1 1436 0
 1318 0016 0120     		movs	r0, #1
 1319              	.LVL156:
1437:USB/core/usb_core.c ****     break;
 1320              		.loc 1 1437 0
 1321 0018 7047     		bx	lr
 1322              	.LVL157:
 1323              	.L88:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 50


1432:USB/core/usb_core.c ****     break;
 1324              		.loc 1 1432 0
 1325 001a 0220     		movs	r0, #2
 1326              	.LVL158:
1438:USB/core/usb_core.c ****   }
1439:USB/core/usb_core.c ****   
1440:USB/core/usb_core.c ****   return speed;
1441:USB/core/usb_core.c **** }
 1327              		.loc 1 1441 0
 1328 001c 7047     		bx	lr
 1329              		.cfi_endproc
 1330              	.LFE143:
 1332 001e 00BF     		.section	.text.USB_OTG_EP0Activate,"ax",%progbits
 1333              		.align	2
 1334              		.global	USB_OTG_EP0Activate
 1335              		.thumb
 1336              		.thumb_func
 1338              	USB_OTG_EP0Activate:
 1339              	.LFB144:
1442:USB/core/usb_core.c **** /**
1443:USB/core/usb_core.c **** * @brief  enables EP0 OUT to receive SETUP packets and configures EP0
1444:USB/core/usb_core.c **** *   for transmitting packets
1445:USB/core/usb_core.c **** * @param  None
1446:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1447:USB/core/usb_core.c **** */
1448:USB/core/usb_core.c **** USB_OTG_STS  USB_OTG_EP0Activate(USB_OTG_CORE_HANDLE *pdev)
1449:USB/core/usb_core.c **** {
 1340              		.loc 1 1449 0
 1341              		.cfi_startproc
 1342              		@ args = 0, pretend = 0, frame = 0
 1343              		@ frame_needed = 0, uses_anonymous_args = 0
 1344              		@ link register save eliminated.
 1345              	.LVL159:
1450:USB/core/usb_core.c ****   USB_OTG_STS             status = USB_OTG_OK;
1451:USB/core/usb_core.c ****   USB_OTG_DSTS_TypeDef    dsts;
1452:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef  diepctl;
1453:USB/core/usb_core.c ****   USB_OTG_DCTL_TypeDef    dctl;
1454:USB/core/usb_core.c ****   
1455:USB/core/usb_core.c ****   dctl.d32 = 0;
1456:USB/core/usb_core.c ****   /* Read the Device Status and Endpoint 0 Control registers */
1457:USB/core/usb_core.c ****   dsts.d32 = USB_OTG_READ_REG32(&pdev->regs.DREGS->DSTS);
 1346              		.loc 1 1457 0
 1347 0000 0369     		ldr	r3, [r0, #16]
 1348 0002 9B68     		ldr	r3, [r3, #8]
1458:USB/core/usb_core.c ****   diepctl.d32 = USB_OTG_READ_REG32(&pdev->regs.INEP_REGS[0]->DIEPCTL);
 1349              		.loc 1 1458 0
 1350 0004 8269     		ldr	r2, [r0, #24]
 1351 0006 1168     		ldr	r1, [r2]
 1352              	.LVL160:
1459:USB/core/usb_core.c ****   /* Set the MPS of the IN EP based on the enumeration speed */
1460:USB/core/usb_core.c ****   switch (dsts.b.enumspd)
 1353              		.loc 1 1460 0
 1354 0008 C3F34103 		ubfx	r3, r3, #1, #2
 1355 000c 022B     		cmp	r3, #2
 1356 000e 02D0     		beq	.L91
1461:USB/core/usb_core.c ****   {
1462:USB/core/usb_core.c ****   case DSTS_ENUMSPD_HS_PHY_30MHZ_OR_60MHZ:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 51


1463:USB/core/usb_core.c ****   case DSTS_ENUMSPD_FS_PHY_30MHZ_OR_60MHZ:
1464:USB/core/usb_core.c ****   case DSTS_ENUMSPD_FS_PHY_48MHZ:
1465:USB/core/usb_core.c ****     diepctl.b.mps = DEP0CTL_MPS_64;
 1357              		.loc 1 1465 0
 1358 0010 6FF30A01 		bfc	r1, #0, #11
1466:USB/core/usb_core.c ****     break;
 1359              		.loc 1 1466 0
 1360 0014 02E0     		b	.L92
 1361              	.L91:
1467:USB/core/usb_core.c ****   case DSTS_ENUMSPD_LS_PHY_6MHZ:
1468:USB/core/usb_core.c ****     diepctl.b.mps = DEP0CTL_MPS_8;
 1362              		.loc 1 1468 0
 1363 0016 0323     		movs	r3, #3
 1364 0018 63F30A01 		bfi	r1, r3, #0, #11
 1365              	.L92:
1469:USB/core/usb_core.c ****     break;
1470:USB/core/usb_core.c ****   }
1471:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(&pdev->regs.INEP_REGS[0]->DIEPCTL, diepctl.d32);
 1366              		.loc 1 1471 0
 1367 001c 1160     		str	r1, [r2]
1472:USB/core/usb_core.c ****   dctl.b.cgnpinnak = 1;
1473:USB/core/usb_core.c ****   USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DCTL, dctl.d32, dctl.d32);
 1368              		.loc 1 1473 0
 1369 001e 0269     		ldr	r2, [r0, #16]
 1370 0020 5368     		ldr	r3, [r2, #4]
 1371 0022 43F48073 		orr	r3, r3, #256
 1372 0026 5360     		str	r3, [r2, #4]
1474:USB/core/usb_core.c ****   return status;
1475:USB/core/usb_core.c **** }
 1373              		.loc 1 1475 0
 1374 0028 0020     		movs	r0, #0
 1375              	.LVL161:
 1376 002a 7047     		bx	lr
 1377              		.cfi_endproc
 1378              	.LFE144:
 1380              		.section	.text.USB_OTG_EPActivate,"ax",%progbits
 1381              		.align	2
 1382              		.global	USB_OTG_EPActivate
 1383              		.thumb
 1384              		.thumb_func
 1386              	USB_OTG_EPActivate:
 1387              	.LFB145:
1476:USB/core/usb_core.c **** 
1477:USB/core/usb_core.c **** 
1478:USB/core/usb_core.c **** /**
1479:USB/core/usb_core.c **** * @brief  USB_OTG_EPActivate : Activates an EP
1480:USB/core/usb_core.c **** * @param  pdev : Selected device
1481:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1482:USB/core/usb_core.c **** */
1483:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_EPActivate(USB_OTG_CORE_HANDLE *pdev , USB_OTG_EP *ep)
1484:USB/core/usb_core.c **** {
 1388              		.loc 1 1484 0
 1389              		.cfi_startproc
 1390              		@ args = 0, pretend = 0, frame = 0
 1391              		@ frame_needed = 0, uses_anonymous_args = 0
 1392              		@ link register save eliminated.
 1393              	.LVL162:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 52


 1394 0000 30B4     		push	{r4, r5}
 1395              	.LCFI21:
 1396              		.cfi_def_cfa_offset 8
 1397              		.cfi_offset 4, -8
 1398              		.cfi_offset 5, -4
 1399              	.LVL163:
1485:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
1486:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef  depctl;
1487:USB/core/usb_core.c ****   USB_OTG_DAINT_TypeDef  daintmsk;
1488:USB/core/usb_core.c ****   __IO uint32_t *addr;
1489:USB/core/usb_core.c ****   
1490:USB/core/usb_core.c ****   
1491:USB/core/usb_core.c ****   depctl.d32 = 0;
1492:USB/core/usb_core.c ****   daintmsk.d32 = 0;
 1400              		.loc 1 1492 0
 1401 0002 0022     		movs	r2, #0
 1402              	.LVL164:
1493:USB/core/usb_core.c ****   /* Read DEPCTLn register */
1494:USB/core/usb_core.c ****   if (ep->is_in == 1)
 1403              		.loc 1 1494 0
 1404 0004 4B78     		ldrb	r3, [r1, #1]	@ zero_extendqisi2
 1405 0006 012B     		cmp	r3, #1
 1406 0008 08D1     		bne	.L94
1495:USB/core/usb_core.c ****   {
1496:USB/core/usb_core.c ****     addr = &pdev->regs.INEP_REGS[ep->num]->DIEPCTL;
 1407              		.loc 1 1496 0
 1408 000a 0D78     		ldrb	r5, [r1]	@ zero_extendqisi2
 1409 000c 2C1D     		adds	r4, r5, #4
 1410 000e 00EB8404 		add	r4, r0, r4, lsl #2
 1411 0012 A468     		ldr	r4, [r4, #8]
 1412              	.LVL165:
1497:USB/core/usb_core.c ****     daintmsk.ep.in = 1 << ep->num;
 1413              		.loc 1 1497 0
 1414 0014 AB40     		lsls	r3, r3, r5
 1415 0016 63F30F02 		bfi	r2, r3, #0, #16
 1416              	.LVL166:
 1417 001a 09E0     		b	.L95
 1418              	.LVL167:
 1419              	.L94:
1498:USB/core/usb_core.c ****   }
1499:USB/core/usb_core.c ****   else
1500:USB/core/usb_core.c ****   {
1501:USB/core/usb_core.c ****     addr = &pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL;
 1420              		.loc 1 1501 0
 1421 001c 0D78     		ldrb	r5, [r1]	@ zero_extendqisi2
 1422 001e 05F11404 		add	r4, r5, #20
 1423 0022 00EB8404 		add	r4, r0, r4, lsl #2
 1424 0026 6468     		ldr	r4, [r4, #4]
 1425              	.LVL168:
1502:USB/core/usb_core.c ****     daintmsk.ep.out = 1 << ep->num;
 1426              		.loc 1 1502 0
 1427 0028 0123     		movs	r3, #1
 1428 002a AB40     		lsls	r3, r3, r5
 1429 002c 63F31F42 		bfi	r2, r3, #16, #16
 1430              	.LVL169:
 1431              	.L95:
1503:USB/core/usb_core.c ****   }
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 53


1504:USB/core/usb_core.c ****   /* If the EP is already active don't change the EP Control
1505:USB/core/usb_core.c ****   * register. */
1506:USB/core/usb_core.c ****   depctl.d32 = USB_OTG_READ_REG32(addr);
 1432              		.loc 1 1506 0
 1433 0030 2368     		ldr	r3, [r4]
 1434              	.LVL170:
1507:USB/core/usb_core.c ****   if (!depctl.b.usbactep)
 1435              		.loc 1 1507 0
 1436 0032 13F4004F 		tst	r3, #32768
 1437 0036 0DD1     		bne	.L96
1508:USB/core/usb_core.c ****   {
1509:USB/core/usb_core.c ****     depctl.b.mps    = ep->maxpacket;
 1438              		.loc 1 1509 0
 1439 0038 8D68     		ldr	r5, [r1, #8]
 1440 003a 65F30A03 		bfi	r3, r5, #0, #11
1510:USB/core/usb_core.c ****     depctl.b.eptype = ep->type;
 1441              		.loc 1 1510 0
 1442 003e CD78     		ldrb	r5, [r1, #3]	@ zero_extendqisi2
 1443 0040 65F39343 		bfi	r3, r5, #18, #2
1511:USB/core/usb_core.c ****     depctl.b.txfnum = ep->tx_fifo_num;
 1444              		.loc 1 1511 0
 1445 0044 C988     		ldrh	r1, [r1, #6]
 1446              	.LVL171:
 1447 0046 61F39953 		bfi	r3, r1, #22, #4
1512:USB/core/usb_core.c ****     depctl.b.setd0pid = 1;
1513:USB/core/usb_core.c ****     depctl.b.usbactep = 1;
 1448              		.loc 1 1513 0
 1449 004a 43F08053 		orr	r3, r3, #268435456
 1450              	.LVL172:
 1451 004e 43F40043 		orr	r3, r3, #32768
 1452              	.LVL173:
1514:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(addr, depctl.d32);
 1453              		.loc 1 1514 0
 1454 0052 2360     		str	r3, [r4]
 1455              	.L96:
1515:USB/core/usb_core.c ****   }
1516:USB/core/usb_core.c ****   /* Enable the Interrupt for this EP */
1517:USB/core/usb_core.c **** #ifdef USB_OTG_HS_DEDICATED_EP1_ENABLED
1518:USB/core/usb_core.c ****   if((ep->num == 1)&&(pdev->cfg.coreID == USB_OTG_HS_CORE_ID))
1519:USB/core/usb_core.c ****   {
1520:USB/core/usb_core.c ****     USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DEACHMSK, 0, daintmsk.d32);
1521:USB/core/usb_core.c ****   }
1522:USB/core/usb_core.c ****   else
1523:USB/core/usb_core.c **** #endif   
1524:USB/core/usb_core.c ****     USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DAINTMSK, 0, daintmsk.d32);
 1456              		.loc 1 1524 0
 1457 0054 0369     		ldr	r3, [r0, #16]
 1458              	.LVL174:
 1459 0056 D969     		ldr	r1, [r3, #28]
 1460 0058 0A43     		orrs	r2, r2, r1
 1461              	.LVL175:
 1462 005a DA61     		str	r2, [r3, #28]
1525:USB/core/usb_core.c ****   return status;
1526:USB/core/usb_core.c **** }
 1463              		.loc 1 1526 0
 1464 005c 0020     		movs	r0, #0
 1465              	.LVL176:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 54


 1466 005e 30BC     		pop	{r4, r5}
 1467              	.LCFI22:
 1468              		.cfi_restore 5
 1469              		.cfi_restore 4
 1470              		.cfi_def_cfa_offset 0
 1471              	.LVL177:
 1472 0060 7047     		bx	lr
 1473              		.cfi_endproc
 1474              	.LFE145:
 1476 0062 00BF     		.section	.text.USB_OTG_EPDeactivate,"ax",%progbits
 1477              		.align	2
 1478              		.global	USB_OTG_EPDeactivate
 1479              		.thumb
 1480              		.thumb_func
 1482              	USB_OTG_EPDeactivate:
 1483              	.LFB146:
1527:USB/core/usb_core.c **** 
1528:USB/core/usb_core.c **** 
1529:USB/core/usb_core.c **** /**
1530:USB/core/usb_core.c **** * @brief  USB_OTG_EPDeactivate : Deactivates an EP
1531:USB/core/usb_core.c **** * @param  pdev : Selected device
1532:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1533:USB/core/usb_core.c **** */
1534:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_EPDeactivate(USB_OTG_CORE_HANDLE *pdev , USB_OTG_EP *ep)
1535:USB/core/usb_core.c **** {
 1484              		.loc 1 1535 0
 1485              		.cfi_startproc
 1486              		@ args = 0, pretend = 0, frame = 0
 1487              		@ frame_needed = 0, uses_anonymous_args = 0
 1488              		@ link register save eliminated.
 1489              	.LVL178:
 1490 0000 70B4     		push	{r4, r5, r6}
 1491              	.LCFI23:
 1492              		.cfi_def_cfa_offset 12
 1493              		.cfi_offset 4, -12
 1494              		.cfi_offset 5, -8
 1495              		.cfi_offset 6, -4
 1496              	.LVL179:
1536:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
1537:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef  depctl;
1538:USB/core/usb_core.c ****   USB_OTG_DAINT_TypeDef  daintmsk;
1539:USB/core/usb_core.c ****   __IO uint32_t *addr;
1540:USB/core/usb_core.c ****   
1541:USB/core/usb_core.c ****   depctl.d32 = 0;
 1497              		.loc 1 1541 0
 1498 0002 0022     		movs	r2, #0
 1499              	.LVL180:
1542:USB/core/usb_core.c ****   daintmsk.d32 = 0;  
 1500              		.loc 1 1542 0
 1501 0004 1546     		mov	r5, r2
 1502              	.LVL181:
1543:USB/core/usb_core.c ****   /* Read DEPCTLn register */
1544:USB/core/usb_core.c ****   if (ep->is_in == 1)
 1503              		.loc 1 1544 0
 1504 0006 4B78     		ldrb	r3, [r1, #1]	@ zero_extendqisi2
 1505 0008 012B     		cmp	r3, #1
 1506 000a 08D1     		bne	.L99
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 55


1545:USB/core/usb_core.c ****   {
1546:USB/core/usb_core.c ****     addr = &pdev->regs.INEP_REGS[ep->num]->DIEPCTL;
 1507              		.loc 1 1546 0
 1508 000c 0E78     		ldrb	r6, [r1]	@ zero_extendqisi2
 1509 000e 311D     		adds	r1, r6, #4
 1510              	.LVL182:
 1511 0010 00EB8101 		add	r1, r0, r1, lsl #2
 1512 0014 8C68     		ldr	r4, [r1, #8]
 1513              	.LVL183:
1547:USB/core/usb_core.c ****     daintmsk.ep.in = 1 << ep->num;
 1514              		.loc 1 1547 0
 1515 0016 B340     		lsls	r3, r3, r6
 1516 0018 63F30F05 		bfi	r5, r3, #0, #16
 1517              	.LVL184:
 1518 001c 09E0     		b	.L100
 1519              	.LVL185:
 1520              	.L99:
1548:USB/core/usb_core.c ****   }
1549:USB/core/usb_core.c ****   else
1550:USB/core/usb_core.c ****   {
1551:USB/core/usb_core.c ****     addr = &pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL;
 1521              		.loc 1 1551 0
 1522 001e 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1523 0020 03F11404 		add	r4, r3, #20
 1524 0024 00EB8404 		add	r4, r0, r4, lsl #2
 1525 0028 6468     		ldr	r4, [r4, #4]
 1526              	.LVL186:
1552:USB/core/usb_core.c ****     daintmsk.ep.out = 1 << ep->num;
 1527              		.loc 1 1552 0
 1528 002a 0121     		movs	r1, #1
 1529              	.LVL187:
 1530 002c 9940     		lsls	r1, r1, r3
 1531 002e 61F31F45 		bfi	r5, r1, #16, #16
 1532              	.LVL188:
 1533              	.L100:
1553:USB/core/usb_core.c ****   }
1554:USB/core/usb_core.c ****   depctl.b.usbactep = 0;
 1534              		.loc 1 1554 0
 1535 0032 6FF3CF32 		bfc	r2, #15, #1
1555:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(addr, depctl.d32);
 1536              		.loc 1 1555 0
 1537 0036 2260     		str	r2, [r4]
1556:USB/core/usb_core.c ****   /* Disable the Interrupt for this EP */
1557:USB/core/usb_core.c ****   
1558:USB/core/usb_core.c **** #ifdef USB_OTG_HS_DEDICATED_EP1_ENABLED
1559:USB/core/usb_core.c ****   if((ep->num == 1)&&(pdev->cfg.coreID == USB_OTG_HS_CORE_ID))
1560:USB/core/usb_core.c ****   {
1561:USB/core/usb_core.c ****     USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DEACHMSK, daintmsk.d32, 0);
1562:USB/core/usb_core.c ****   }
1563:USB/core/usb_core.c ****   else
1564:USB/core/usb_core.c **** #endif    
1565:USB/core/usb_core.c ****     USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DAINTMSK, daintmsk.d32, 0);
 1538              		.loc 1 1565 0
 1539 0038 0269     		ldr	r2, [r0, #16]
 1540              	.LVL189:
 1541 003a D369     		ldr	r3, [r2, #28]
 1542 003c 23EA0503 		bic	r3, r3, r5
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 56


 1543 0040 D361     		str	r3, [r2, #28]
1566:USB/core/usb_core.c ****   return status;
1567:USB/core/usb_core.c **** }
 1544              		.loc 1 1567 0
 1545 0042 0020     		movs	r0, #0
 1546              	.LVL190:
 1547 0044 70BC     		pop	{r4, r5, r6}
 1548              	.LCFI24:
 1549              		.cfi_restore 6
 1550              		.cfi_restore 5
 1551              		.cfi_restore 4
 1552              		.cfi_def_cfa_offset 0
 1553              	.LVL191:
 1554 0046 7047     		bx	lr
 1555              		.cfi_endproc
 1556              	.LFE146:
 1558              		.section	.text.USB_OTG_EPStartXfer,"ax",%progbits
 1559              		.align	2
 1560              		.global	USB_OTG_EPStartXfer
 1561              		.thumb
 1562              		.thumb_func
 1564              	USB_OTG_EPStartXfer:
 1565              	.LFB147:
1568:USB/core/usb_core.c **** 
1569:USB/core/usb_core.c **** 
1570:USB/core/usb_core.c **** /**
1571:USB/core/usb_core.c **** * @brief  USB_OTG_EPStartXfer : Handle the setup for data xfer for an EP and 
1572:USB/core/usb_core.c **** *         starts the xfer
1573:USB/core/usb_core.c **** * @param  pdev : Selected device
1574:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1575:USB/core/usb_core.c **** */
1576:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_EPStartXfer(USB_OTG_CORE_HANDLE *pdev , USB_OTG_EP *ep)
1577:USB/core/usb_core.c **** {
 1566              		.loc 1 1577 0
 1567              		.cfi_startproc
 1568              		@ args = 0, pretend = 0, frame = 0
 1569              		@ frame_needed = 0, uses_anonymous_args = 0
 1570              	.LVL192:
 1571 0000 38B5     		push	{r3, r4, r5, lr}
 1572              	.LCFI25:
 1573              		.cfi_def_cfa_offset 16
 1574              		.cfi_offset 3, -16
 1575              		.cfi_offset 4, -12
 1576              		.cfi_offset 5, -8
 1577              		.cfi_offset 14, -4
 1578              	.LVL193:
1578:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
1579:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef     depctl;
1580:USB/core/usb_core.c ****   USB_OTG_DEPXFRSIZ_TypeDef  deptsiz;
1581:USB/core/usb_core.c ****   USB_OTG_DSTS_TypeDef       dsts;    
1582:USB/core/usb_core.c ****   uint32_t fifoemptymsk = 0;  
1583:USB/core/usb_core.c ****   
1584:USB/core/usb_core.c ****   depctl.d32 = 0;
1585:USB/core/usb_core.c ****   deptsiz.d32 = 0;
1586:USB/core/usb_core.c ****   /* IN endpoint */
1587:USB/core/usb_core.c ****   if (ep->is_in == 1)
 1579              		.loc 1 1587 0
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 57


 1580 0002 4B78     		ldrb	r3, [r1, #1]	@ zero_extendqisi2
 1581 0004 012B     		cmp	r3, #1
 1582 0006 58D1     		bne	.L103
1588:USB/core/usb_core.c ****   {
1589:USB/core/usb_core.c ****     depctl.d32  = USB_OTG_READ_REG32(&(pdev->regs.INEP_REGS[ep->num]->DIEPCTL));
 1583              		.loc 1 1589 0
 1584 0008 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1585 000a 0433     		adds	r3, r3, #4
 1586 000c 00EB8303 		add	r3, r0, r3, lsl #2
 1587 0010 9B68     		ldr	r3, [r3, #8]
 1588 0012 1A68     		ldr	r2, [r3]
 1589              	.LVL194:
1590:USB/core/usb_core.c ****     deptsiz.d32 = USB_OTG_READ_REG32(&(pdev->regs.INEP_REGS[ep->num]->DIEPTSIZ));
 1590              		.loc 1 1590 0
 1591 0014 1C69     		ldr	r4, [r3, #16]
 1592              	.LVL195:
1591:USB/core/usb_core.c ****     /* Zero Length Packet? */
1592:USB/core/usb_core.c ****     if (ep->xfer_len == 0)
 1593              		.loc 1 1592 0
 1594 0016 4B69     		ldr	r3, [r1, #20]
 1595 0018 2BB9     		cbnz	r3, .L104
1593:USB/core/usb_core.c ****     {
1594:USB/core/usb_core.c ****       deptsiz.b.xfersize = 0;
 1596              		.loc 1 1594 0
 1597 001a 6FF31204 		bfc	r4, #0, #19
1595:USB/core/usb_core.c ****       deptsiz.b.pktcnt = 1;
 1598              		.loc 1 1595 0
 1599 001e 0123     		movs	r3, #1
 1600 0020 63F3DC44 		bfi	r4, r3, #19, #10
 1601 0024 0DE0     		b	.L105
 1602              	.L104:
1596:USB/core/usb_core.c ****     }
1597:USB/core/usb_core.c ****     else
1598:USB/core/usb_core.c ****     {
1599:USB/core/usb_core.c ****       /* Program the transfer size and packet count
1600:USB/core/usb_core.c ****       * as follows: xfersize = N * maxpacket +
1601:USB/core/usb_core.c ****       * short_packet pktcnt = N + (short_packet
1602:USB/core/usb_core.c ****       * exist ? 1 : 0)
1603:USB/core/usb_core.c ****       */
1604:USB/core/usb_core.c ****       deptsiz.b.xfersize = ep->xfer_len;
 1603              		.loc 1 1604 0
 1604 0026 63F31204 		bfi	r4, r3, #0, #19
1605:USB/core/usb_core.c ****       deptsiz.b.pktcnt = (ep->xfer_len - 1 + ep->maxpacket) / ep->maxpacket;
 1605              		.loc 1 1605 0
 1606 002a 8D68     		ldr	r5, [r1, #8]
 1607 002c 2B44     		add	r3, r3, r5
 1608 002e 013B     		subs	r3, r3, #1
 1609 0030 B3FBF5F3 		udiv	r3, r3, r5
 1610 0034 63F3DC44 		bfi	r4, r3, #19, #10
1606:USB/core/usb_core.c ****       
1607:USB/core/usb_core.c ****       if (ep->type == EP_TYPE_ISOC)
 1611              		.loc 1 1607 0
 1612 0038 CB78     		ldrb	r3, [r1, #3]	@ zero_extendqisi2
 1613 003a 012B     		cmp	r3, #1
 1614 003c 01D1     		bne	.L105
1608:USB/core/usb_core.c ****       {
1609:USB/core/usb_core.c ****         deptsiz.b.mc = 1;
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 58


 1615              		.loc 1 1609 0
 1616 003e 63F35E74 		bfi	r4, r3, #29, #2
 1617              	.L105:
1610:USB/core/usb_core.c ****       }       
1611:USB/core/usb_core.c ****     }
1612:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.INEP_REGS[ep->num]->DIEPTSIZ, deptsiz.d32);
 1618              		.loc 1 1612 0
 1619 0042 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1620 0044 0433     		adds	r3, r3, #4
 1621 0046 00EB8303 		add	r3, r0, r3, lsl #2
 1622 004a 9B68     		ldr	r3, [r3, #8]
 1623 004c 1C61     		str	r4, [r3, #16]
1613:USB/core/usb_core.c ****     
1614:USB/core/usb_core.c ****     if (pdev->cfg.dma_enable == 1)
 1624              		.loc 1 1614 0
 1625 004e C378     		ldrb	r3, [r0, #3]	@ zero_extendqisi2
 1626 0050 012B     		cmp	r3, #1
 1627 0052 07D1     		bne	.L106
1615:USB/core/usb_core.c ****     {
1616:USB/core/usb_core.c ****       USB_OTG_WRITE_REG32(&pdev->regs.INEP_REGS[ep->num]->DIEPDMA, ep->dma_addr);
 1628              		.loc 1 1616 0
 1629 0054 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1630 0056 0433     		adds	r3, r3, #4
 1631 0058 00EB8303 		add	r3, r0, r3, lsl #2
 1632 005c 9B68     		ldr	r3, [r3, #8]
 1633 005e 0C69     		ldr	r4, [r1, #16]
 1634              	.LVL196:
 1635 0060 5C61     		str	r4, [r3, #20]
 1636 0062 0CE0     		b	.L107
 1637              	.LVL197:
 1638              	.L106:
1617:USB/core/usb_core.c ****     }
1618:USB/core/usb_core.c ****     else
1619:USB/core/usb_core.c ****     {
1620:USB/core/usb_core.c ****       if (ep->type != EP_TYPE_ISOC)
 1639              		.loc 1 1620 0
 1640 0064 CB78     		ldrb	r3, [r1, #3]	@ zero_extendqisi2
 1641 0066 012B     		cmp	r3, #1
 1642 0068 09D0     		beq	.L107
1621:USB/core/usb_core.c ****       {
1622:USB/core/usb_core.c ****         /* Enable the Tx FIFO Empty Interrupt for this EP */
1623:USB/core/usb_core.c ****         if (ep->xfer_len > 0)
 1643              		.loc 1 1623 0
 1644 006a 4B69     		ldr	r3, [r1, #20]
 1645 006c 3BB1     		cbz	r3, .L107
1624:USB/core/usb_core.c ****         {
1625:USB/core/usb_core.c ****           fifoemptymsk = 1 << ep->num;
 1646              		.loc 1 1625 0
 1647 006e 0C78     		ldrb	r4, [r1]	@ zero_extendqisi2
 1648              	.LVL198:
 1649 0070 0123     		movs	r3, #1
 1650 0072 03FA04F4 		lsl	r4, r3, r4
 1651              	.LVL199:
1626:USB/core/usb_core.c ****           USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DIEPEMPMSK, 0, fifoemptymsk);
 1652              		.loc 1 1626 0
 1653 0076 0569     		ldr	r5, [r0, #16]
 1654 0078 6B6B     		ldr	r3, [r5, #52]
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 59


 1655 007a 2343     		orrs	r3, r3, r4
 1656 007c 6B63     		str	r3, [r5, #52]
 1657              	.LVL200:
 1658              	.L107:
1627:USB/core/usb_core.c ****         }
1628:USB/core/usb_core.c ****       }
1629:USB/core/usb_core.c ****     }
1630:USB/core/usb_core.c ****     
1631:USB/core/usb_core.c ****     
1632:USB/core/usb_core.c ****     if (ep->type == EP_TYPE_ISOC)
 1659              		.loc 1 1632 0
 1660 007e CB78     		ldrb	r3, [r1, #3]	@ zero_extendqisi2
 1661 0080 012B     		cmp	r3, #1
 1662 0082 09D1     		bne	.L108
1633:USB/core/usb_core.c ****     {
1634:USB/core/usb_core.c ****       dsts.d32 = USB_OTG_READ_REG32(&pdev->regs.DREGS->DSTS);
 1663              		.loc 1 1634 0
 1664 0084 0369     		ldr	r3, [r0, #16]
 1665 0086 9B68     		ldr	r3, [r3, #8]
1635:USB/core/usb_core.c ****       
1636:USB/core/usb_core.c ****       if (((dsts.b.soffn)&0x1) == 0)
 1666              		.loc 1 1636 0
 1667 0088 13F4807F 		tst	r3, #256
 1668 008c 02D1     		bne	.L109
1637:USB/core/usb_core.c ****       {
1638:USB/core/usb_core.c ****         depctl.b.setd1pid = 1;
 1669              		.loc 1 1638 0
 1670 008e 42F00052 		orr	r2, r2, #536870912
 1671              	.LVL201:
 1672 0092 01E0     		b	.L108
 1673              	.LVL202:
 1674              	.L109:
1639:USB/core/usb_core.c ****       }
1640:USB/core/usb_core.c ****       else
1641:USB/core/usb_core.c ****       {
1642:USB/core/usb_core.c ****         depctl.b.setd0pid = 1;
 1675              		.loc 1 1642 0
 1676 0094 42F08052 		orr	r2, r2, #268435456
 1677              	.LVL203:
 1678              	.L108:
1643:USB/core/usb_core.c ****       }
1644:USB/core/usb_core.c ****     } 
1645:USB/core/usb_core.c ****     
1646:USB/core/usb_core.c ****     /* EP enable, IN data in FIFO */
1647:USB/core/usb_core.c ****     depctl.b.cnak = 1;
1648:USB/core/usb_core.c ****     depctl.b.epena = 1;
 1679              		.loc 1 1648 0
 1680 0098 42F00442 		orr	r2, r2, #-2080374784
 1681              	.LVL204:
1649:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.INEP_REGS[ep->num]->DIEPCTL, depctl.d32);
 1682              		.loc 1 1649 0
 1683 009c 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1684 009e 0433     		adds	r3, r3, #4
 1685 00a0 00EB8303 		add	r3, r0, r3, lsl #2
 1686 00a4 9B68     		ldr	r3, [r3, #8]
 1687              	.LVL205:
 1688 00a6 1A60     		str	r2, [r3]
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 60


1650:USB/core/usb_core.c ****     
1651:USB/core/usb_core.c ****     if (ep->type == EP_TYPE_ISOC)
 1689              		.loc 1 1651 0
 1690 00a8 CB78     		ldrb	r3, [r1, #3]	@ zero_extendqisi2
 1691 00aa 012B     		cmp	r3, #1
 1692 00ac 44D1     		bne	.L110
1652:USB/core/usb_core.c ****     {
1653:USB/core/usb_core.c ****       USB_OTG_WritePacket(pdev, ep->xfer_buff, ep->num, ep->xfer_len);   
 1693              		.loc 1 1653 0
 1694 00ae 8B8A     		ldrh	r3, [r1, #20]
 1695 00b0 0A78     		ldrb	r2, [r1]	@ zero_extendqisi2
 1696              	.LVL206:
 1697 00b2 C968     		ldr	r1, [r1, #12]
 1698              	.LVL207:
 1699 00b4 FFF7FEFF 		bl	USB_OTG_WritePacket
 1700              	.LVL208:
 1701 00b8 3EE0     		b	.L110
 1702              	.LVL209:
 1703              	.L103:
1654:USB/core/usb_core.c ****     }    
1655:USB/core/usb_core.c ****   }
1656:USB/core/usb_core.c ****   else
1657:USB/core/usb_core.c ****   {
1658:USB/core/usb_core.c ****     /* OUT endpoint */
1659:USB/core/usb_core.c ****     depctl.d32  = USB_OTG_READ_REG32(&(pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL));
 1704              		.loc 1 1659 0
 1705 00ba 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1706 00bc 1433     		adds	r3, r3, #20
 1707 00be 00EB8303 		add	r3, r0, r3, lsl #2
 1708 00c2 5B68     		ldr	r3, [r3, #4]
 1709 00c4 1A68     		ldr	r2, [r3]
 1710              	.LVL210:
1660:USB/core/usb_core.c ****     deptsiz.d32 = USB_OTG_READ_REG32(&(pdev->regs.OUTEP_REGS[ep->num]->DOEPTSIZ));
 1711              		.loc 1 1660 0
 1712 00c6 1C69     		ldr	r4, [r3, #16]
 1713              	.LVL211:
1661:USB/core/usb_core.c ****     /* Program the transfer size and packet count as follows:
1662:USB/core/usb_core.c ****     * pktcnt = N
1663:USB/core/usb_core.c ****     * xfersize = N * maxpacket
1664:USB/core/usb_core.c ****     */
1665:USB/core/usb_core.c ****     if (ep->xfer_len == 0)
 1714              		.loc 1 1665 0
 1715 00c8 4B69     		ldr	r3, [r1, #20]
 1716 00ca 33B9     		cbnz	r3, .L111
1666:USB/core/usb_core.c ****     {
1667:USB/core/usb_core.c ****       deptsiz.b.xfersize = ep->maxpacket;
 1717              		.loc 1 1667 0
 1718 00cc 8B68     		ldr	r3, [r1, #8]
 1719 00ce 63F31204 		bfi	r4, r3, #0, #19
1668:USB/core/usb_core.c ****       deptsiz.b.pktcnt = 1;
 1720              		.loc 1 1668 0
 1721 00d2 0123     		movs	r3, #1
 1722 00d4 63F3DC44 		bfi	r4, r3, #19, #10
 1723 00d8 0CE0     		b	.L112
 1724              	.L111:
1669:USB/core/usb_core.c ****     }
1670:USB/core/usb_core.c ****     else
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 61


1671:USB/core/usb_core.c ****     {
1672:USB/core/usb_core.c ****       deptsiz.b.pktcnt = (ep->xfer_len + (ep->maxpacket - 1)) / ep->maxpacket;
 1725              		.loc 1 1672 0
 1726 00da 8D68     		ldr	r5, [r1, #8]
 1727 00dc 2B44     		add	r3, r3, r5
 1728 00de 013B     		subs	r3, r3, #1
 1729 00e0 B3FBF5F3 		udiv	r3, r3, r5
 1730 00e4 C3F30903 		ubfx	r3, r3, #0, #10
 1731 00e8 63F3DC44 		bfi	r4, r3, #19, #10
1673:USB/core/usb_core.c ****       deptsiz.b.xfersize = deptsiz.b.pktcnt * ep->maxpacket;
 1732              		.loc 1 1673 0
 1733 00ec 05FB03F3 		mul	r3, r5, r3
 1734 00f0 63F31204 		bfi	r4, r3, #0, #19
 1735              	.L112:
1674:USB/core/usb_core.c ****     }
1675:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.OUTEP_REGS[ep->num]->DOEPTSIZ, deptsiz.d32);
 1736              		.loc 1 1675 0
 1737 00f4 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1738 00f6 1433     		adds	r3, r3, #20
 1739 00f8 00EB8303 		add	r3, r0, r3, lsl #2
 1740 00fc 5B68     		ldr	r3, [r3, #4]
 1741 00fe 1C61     		str	r4, [r3, #16]
1676:USB/core/usb_core.c ****     
1677:USB/core/usb_core.c ****     if (pdev->cfg.dma_enable == 1)
 1742              		.loc 1 1677 0
 1743 0100 C378     		ldrb	r3, [r0, #3]	@ zero_extendqisi2
 1744 0102 012B     		cmp	r3, #1
 1745 0104 06D1     		bne	.L113
1678:USB/core/usb_core.c ****     {
1679:USB/core/usb_core.c ****       USB_OTG_WRITE_REG32(&pdev->regs.OUTEP_REGS[ep->num]->DOEPDMA, ep->dma_addr);
 1746              		.loc 1 1679 0
 1747 0106 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1748 0108 1433     		adds	r3, r3, #20
 1749 010a 00EB8303 		add	r3, r0, r3, lsl #2
 1750 010e 5B68     		ldr	r3, [r3, #4]
 1751 0110 0C69     		ldr	r4, [r1, #16]
 1752              	.LVL212:
 1753 0112 5C61     		str	r4, [r3, #20]
 1754              	.LVL213:
 1755              	.L113:
1680:USB/core/usb_core.c ****     }
1681:USB/core/usb_core.c ****     
1682:USB/core/usb_core.c ****     if (ep->type == EP_TYPE_ISOC)
 1756              		.loc 1 1682 0
 1757 0114 CB78     		ldrb	r3, [r1, #3]	@ zero_extendqisi2
 1758 0116 012B     		cmp	r3, #1
 1759 0118 06D1     		bne	.L114
1683:USB/core/usb_core.c ****     {
1684:USB/core/usb_core.c ****       if (ep->even_odd_frame)
 1760              		.loc 1 1684 0
 1761 011a 4B79     		ldrb	r3, [r1, #5]	@ zero_extendqisi2
 1762 011c 13B1     		cbz	r3, .L115
1685:USB/core/usb_core.c ****       {
1686:USB/core/usb_core.c ****         depctl.b.setd1pid = 1;
 1763              		.loc 1 1686 0
 1764 011e 42F00052 		orr	r2, r2, #536870912
 1765              	.LVL214:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 62


 1766 0122 01E0     		b	.L114
 1767              	.LVL215:
 1768              	.L115:
1687:USB/core/usb_core.c ****       }
1688:USB/core/usb_core.c ****       else
1689:USB/core/usb_core.c ****       {
1690:USB/core/usb_core.c ****         depctl.b.setd0pid = 1;
 1769              		.loc 1 1690 0
 1770 0124 42F08052 		orr	r2, r2, #268435456
 1771              	.LVL216:
 1772              	.L114:
1691:USB/core/usb_core.c ****       }
1692:USB/core/usb_core.c ****     }
1693:USB/core/usb_core.c ****     /* EP enable */
1694:USB/core/usb_core.c ****     depctl.b.cnak = 1;
1695:USB/core/usb_core.c ****     depctl.b.epena = 1;
 1773              		.loc 1 1695 0
 1774 0128 42F00442 		orr	r2, r2, #-2080374784
 1775              	.LVL217:
1696:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL, depctl.d32);
 1776              		.loc 1 1696 0
 1777 012c 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1778 012e 1433     		adds	r3, r3, #20
 1779 0130 00EB8300 		add	r0, r0, r3, lsl #2
 1780              	.LVL218:
 1781 0134 4368     		ldr	r3, [r0, #4]
 1782              	.LVL219:
 1783 0136 1A60     		str	r2, [r3]
 1784              	.LVL220:
 1785              	.L110:
1697:USB/core/usb_core.c ****   }
1698:USB/core/usb_core.c ****   return status;
1699:USB/core/usb_core.c **** }
 1786              		.loc 1 1699 0
 1787 0138 0020     		movs	r0, #0
 1788 013a 38BD     		pop	{r3, r4, r5, pc}
 1789              		.cfi_endproc
 1790              	.LFE147:
 1792              		.section	.text.USB_OTG_EP0StartXfer,"ax",%progbits
 1793              		.align	2
 1794              		.global	USB_OTG_EP0StartXfer
 1795              		.thumb
 1796              		.thumb_func
 1798              	USB_OTG_EP0StartXfer:
 1799              	.LFB148:
1700:USB/core/usb_core.c **** 
1701:USB/core/usb_core.c **** 
1702:USB/core/usb_core.c **** /**
1703:USB/core/usb_core.c **** * @brief  USB_OTG_EP0StartXfer : Handle the setup for a data xfer for EP0 and 
1704:USB/core/usb_core.c **** *         starts the xfer
1705:USB/core/usb_core.c **** * @param  pdev : Selected device
1706:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1707:USB/core/usb_core.c **** */
1708:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_EP0StartXfer(USB_OTG_CORE_HANDLE *pdev , USB_OTG_EP *ep)
1709:USB/core/usb_core.c **** {
 1800              		.loc 1 1709 0
 1801              		.cfi_startproc
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 63


 1802              		@ args = 0, pretend = 0, frame = 8
 1803              		@ frame_needed = 0, uses_anonymous_args = 0
 1804              		@ link register save eliminated.
 1805              	.LVL221:
 1806 0000 30B4     		push	{r4, r5}
 1807              	.LCFI26:
 1808              		.cfi_def_cfa_offset 8
 1809              		.cfi_offset 4, -8
 1810              		.cfi_offset 5, -4
 1811 0002 82B0     		sub	sp, sp, #8
 1812              	.LCFI27:
 1813              		.cfi_def_cfa_offset 16
 1814              	.LVL222:
1710:USB/core/usb_core.c ****   USB_OTG_STS                 status = USB_OTG_OK;
1711:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef      depctl;
1712:USB/core/usb_core.c ****   USB_OTG_DEP0XFRSIZ_TypeDef  deptsiz;
1713:USB/core/usb_core.c ****   USB_OTG_INEPREGS          *in_regs;
1714:USB/core/usb_core.c ****   uint32_t fifoemptymsk = 0;
1715:USB/core/usb_core.c ****   
1716:USB/core/usb_core.c ****   depctl.d32   = 0;
1717:USB/core/usb_core.c ****   deptsiz.d32  = 0;
1718:USB/core/usb_core.c ****   /* IN endpoint */
1719:USB/core/usb_core.c ****   if (ep->is_in == 1)
 1815              		.loc 1 1719 0
 1816 0004 4B78     		ldrb	r3, [r1, #1]	@ zero_extendqisi2
 1817 0006 012B     		cmp	r3, #1
 1818 0008 49D1     		bne	.L118
1720:USB/core/usb_core.c ****   {
1721:USB/core/usb_core.c ****     in_regs = pdev->regs.INEP_REGS[0];
 1819              		.loc 1 1721 0
 1820 000a 8369     		ldr	r3, [r0, #24]
 1821              	.LVL223:
1722:USB/core/usb_core.c ****     depctl.d32  = USB_OTG_READ_REG32(&in_regs->DIEPCTL);
 1822              		.loc 1 1722 0
 1823 000c 1A68     		ldr	r2, [r3]
 1824              	.LVL224:
1723:USB/core/usb_core.c ****     deptsiz.d32 = USB_OTG_READ_REG32(&in_regs->DIEPTSIZ);
 1825              		.loc 1 1723 0
 1826 000e 1C69     		ldr	r4, [r3, #16]
 1827 0010 0094     		str	r4, [sp]
1724:USB/core/usb_core.c ****     /* Zero Length Packet? */
1725:USB/core/usb_core.c ****     if (ep->xfer_len == 0)
 1828              		.loc 1 1725 0
 1829 0012 4C69     		ldr	r4, [r1, #20]
 1830 0014 6CB9     		cbnz	r4, .L119
1726:USB/core/usb_core.c ****     {
1727:USB/core/usb_core.c ****       deptsiz.b.xfersize = 0;
 1831              		.loc 1 1727 0
 1832 0016 9DF80040 		ldrb	r4, [sp]	@ zero_extendqisi2
 1833 001a 6FF30604 		bfc	r4, #0, #7
 1834 001e 8DF80040 		strb	r4, [sp]
1728:USB/core/usb_core.c ****       deptsiz.b.pktcnt = 1;
 1835              		.loc 1 1728 0
 1836 0022 9DF80240 		ldrb	r4, [sp, #2]	@ zero_extendqisi2
 1837 0026 0125     		movs	r5, #1
 1838 0028 65F3C404 		bfi	r4, r5, #3, #2
 1839 002c 8DF80240 		strb	r4, [sp, #2]
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 64


 1840 0030 17E0     		b	.L120
 1841              	.L119:
1729:USB/core/usb_core.c ****       
1730:USB/core/usb_core.c ****     }
1731:USB/core/usb_core.c ****     else
1732:USB/core/usb_core.c ****     {
1733:USB/core/usb_core.c ****       if (ep->xfer_len > ep->maxpacket)
 1842              		.loc 1 1733 0
 1843 0032 8D68     		ldr	r5, [r1, #8]
 1844 0034 AC42     		cmp	r4, r5
 1845 0036 07D9     		bls	.L121
1734:USB/core/usb_core.c ****       {
1735:USB/core/usb_core.c ****         ep->xfer_len = ep->maxpacket;
 1846              		.loc 1 1735 0
 1847 0038 4D61     		str	r5, [r1, #20]
1736:USB/core/usb_core.c ****         deptsiz.b.xfersize = ep->maxpacket;
 1848              		.loc 1 1736 0
 1849 003a 9DF80040 		ldrb	r4, [sp]	@ zero_extendqisi2
 1850 003e 65F30604 		bfi	r4, r5, #0, #7
 1851 0042 8DF80040 		strb	r4, [sp]
 1852 0046 05E0     		b	.L122
 1853              	.L121:
1737:USB/core/usb_core.c ****       }
1738:USB/core/usb_core.c ****       else
1739:USB/core/usb_core.c ****       {
1740:USB/core/usb_core.c ****         deptsiz.b.xfersize = ep->xfer_len;
 1854              		.loc 1 1740 0
 1855 0048 9DF80050 		ldrb	r5, [sp]	@ zero_extendqisi2
 1856 004c 64F30605 		bfi	r5, r4, #0, #7
 1857 0050 8DF80050 		strb	r5, [sp]
 1858              	.L122:
1741:USB/core/usb_core.c ****       }
1742:USB/core/usb_core.c ****       deptsiz.b.pktcnt = 1;
 1859              		.loc 1 1742 0
 1860 0054 9DF80240 		ldrb	r4, [sp, #2]	@ zero_extendqisi2
 1861 0058 0125     		movs	r5, #1
 1862 005a 65F3C404 		bfi	r4, r5, #3, #2
 1863 005e 8DF80240 		strb	r4, [sp, #2]
 1864              	.L120:
1743:USB/core/usb_core.c ****     }
1744:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&in_regs->DIEPTSIZ, deptsiz.d32);
 1865              		.loc 1 1744 0
 1866 0062 009C     		ldr	r4, [sp]
 1867 0064 1C61     		str	r4, [r3, #16]
1745:USB/core/usb_core.c ****     
1746:USB/core/usb_core.c ****     if (pdev->cfg.dma_enable == 1)
 1868              		.loc 1 1746 0
 1869 0066 C478     		ldrb	r4, [r0, #3]	@ zero_extendqisi2
 1870 0068 012C     		cmp	r4, #1
 1871 006a 06D1     		bne	.L123
1747:USB/core/usb_core.c ****     {
1748:USB/core/usb_core.c ****       USB_OTG_WRITE_REG32(&pdev->regs.INEP_REGS[ep->num]->DIEPDMA, ep->dma_addr);  
 1872              		.loc 1 1748 0
 1873 006c 0C78     		ldrb	r4, [r1]	@ zero_extendqisi2
 1874 006e 0434     		adds	r4, r4, #4
 1875 0070 00EB8404 		add	r4, r0, r4, lsl #2
 1876 0074 A468     		ldr	r4, [r4, #8]
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 65


 1877 0076 0D69     		ldr	r5, [r1, #16]
 1878 0078 6561     		str	r5, [r4, #20]
 1879              	.L123:
1749:USB/core/usb_core.c ****     }
1750:USB/core/usb_core.c ****     
1751:USB/core/usb_core.c ****     /* EP enable, IN data in FIFO */
1752:USB/core/usb_core.c ****     depctl.b.cnak = 1;
1753:USB/core/usb_core.c ****     depctl.b.epena = 1;
 1880              		.loc 1 1753 0
 1881 007a 42F00442 		orr	r2, r2, #-2080374784
 1882              	.LVL225:
1754:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&in_regs->DIEPCTL, depctl.d32);
 1883              		.loc 1 1754 0
 1884 007e 1A60     		str	r2, [r3]
1755:USB/core/usb_core.c ****     
1756:USB/core/usb_core.c ****     
1757:USB/core/usb_core.c ****     
1758:USB/core/usb_core.c ****     if (pdev->cfg.dma_enable == 0)
 1885              		.loc 1 1758 0
 1886 0080 C378     		ldrb	r3, [r0, #3]	@ zero_extendqisi2
 1887              	.LVL226:
 1888 0082 002B     		cmp	r3, #0
 1889 0084 4CD1     		bne	.L124
1759:USB/core/usb_core.c ****     {
1760:USB/core/usb_core.c ****       /* Enable the Tx FIFO Empty Interrupt for this EP */
1761:USB/core/usb_core.c ****       if (ep->xfer_len > 0)
 1890              		.loc 1 1761 0
 1891 0086 4B69     		ldr	r3, [r1, #20]
 1892 0088 002B     		cmp	r3, #0
 1893 008a 49D0     		beq	.L124
1762:USB/core/usb_core.c ****       {
1763:USB/core/usb_core.c ****         {
1764:USB/core/usb_core.c ****           fifoemptymsk |= 1 << ep->num;
 1894              		.loc 1 1764 0
 1895 008c 0A78     		ldrb	r2, [r1]	@ zero_extendqisi2
 1896              	.LVL227:
 1897 008e 0123     		movs	r3, #1
 1898 0090 03FA02F2 		lsl	r2, r3, r2
 1899              	.LVL228:
1765:USB/core/usb_core.c ****           USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DIEPEMPMSK, 0, fifoemptymsk);
 1900              		.loc 1 1765 0
 1901 0094 0169     		ldr	r1, [r0, #16]
 1902              	.LVL229:
 1903 0096 4B6B     		ldr	r3, [r1, #52]
 1904 0098 1343     		orrs	r3, r3, r2
 1905 009a 4B63     		str	r3, [r1, #52]
 1906 009c 40E0     		b	.L124
 1907              	.LVL230:
 1908              	.L118:
1766:USB/core/usb_core.c ****         }
1767:USB/core/usb_core.c ****       }
1768:USB/core/usb_core.c ****     }
1769:USB/core/usb_core.c ****   }
1770:USB/core/usb_core.c ****   else
1771:USB/core/usb_core.c ****   {
1772:USB/core/usb_core.c ****     /* OUT endpoint */
1773:USB/core/usb_core.c ****     depctl.d32  = USB_OTG_READ_REG32(&pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL);
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 66


 1909              		.loc 1 1773 0
 1910 009e 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1911 00a0 1433     		adds	r3, r3, #20
 1912 00a2 00EB8303 		add	r3, r0, r3, lsl #2
 1913 00a6 5B68     		ldr	r3, [r3, #4]
 1914 00a8 1A68     		ldr	r2, [r3]
 1915              	.LVL231:
1774:USB/core/usb_core.c ****     deptsiz.d32 = USB_OTG_READ_REG32(&pdev->regs.OUTEP_REGS[ep->num]->DOEPTSIZ);
 1916              		.loc 1 1774 0
 1917 00aa 1B69     		ldr	r3, [r3, #16]
 1918 00ac 0093     		str	r3, [sp]
1775:USB/core/usb_core.c ****     /* Program the transfer size and packet count as follows:
1776:USB/core/usb_core.c ****     * xfersize = N * (maxpacket + 4 - (maxpacket % 4))
1777:USB/core/usb_core.c ****     * pktcnt = N           */
1778:USB/core/usb_core.c ****     if (ep->xfer_len == 0)
 1919              		.loc 1 1778 0
 1920 00ae 4B69     		ldr	r3, [r1, #20]
 1921 00b0 73B9     		cbnz	r3, .L125
1779:USB/core/usb_core.c ****     {
1780:USB/core/usb_core.c ****       deptsiz.b.xfersize = ep->maxpacket;
 1922              		.loc 1 1780 0
 1923 00b2 8C68     		ldr	r4, [r1, #8]
 1924 00b4 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
 1925 00b8 64F30603 		bfi	r3, r4, #0, #7
 1926 00bc 8DF80030 		strb	r3, [sp]
1781:USB/core/usb_core.c ****       deptsiz.b.pktcnt = 1;
 1927              		.loc 1 1781 0
 1928 00c0 9DF80230 		ldrb	r3, [sp, #2]	@ zero_extendqisi2
 1929 00c4 0124     		movs	r4, #1
 1930 00c6 64F3C403 		bfi	r3, r4, #3, #2
 1931 00ca 8DF80230 		strb	r3, [sp, #2]
 1932 00ce 0EE0     		b	.L126
 1933              	.L125:
1782:USB/core/usb_core.c ****     }
1783:USB/core/usb_core.c ****     else
1784:USB/core/usb_core.c ****     {
1785:USB/core/usb_core.c ****       ep->xfer_len = ep->maxpacket;
 1934              		.loc 1 1785 0
 1935 00d0 8C68     		ldr	r4, [r1, #8]
 1936 00d2 4C61     		str	r4, [r1, #20]
1786:USB/core/usb_core.c ****       deptsiz.b.xfersize = ep->maxpacket;
 1937              		.loc 1 1786 0
 1938 00d4 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
 1939 00d8 64F30603 		bfi	r3, r4, #0, #7
 1940 00dc 8DF80030 		strb	r3, [sp]
1787:USB/core/usb_core.c ****       deptsiz.b.pktcnt = 1;
 1941              		.loc 1 1787 0
 1942 00e0 9DF80230 		ldrb	r3, [sp, #2]	@ zero_extendqisi2
 1943 00e4 0124     		movs	r4, #1
 1944 00e6 64F3C403 		bfi	r3, r4, #3, #2
 1945 00ea 8DF80230 		strb	r3, [sp, #2]
 1946              	.L126:
1788:USB/core/usb_core.c ****     }
1789:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(&pdev->regs.OUTEP_REGS[ep->num]->DOEPTSIZ, deptsiz.d32);
 1947              		.loc 1 1789 0
 1948 00ee 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1949 00f0 1433     		adds	r3, r3, #20
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 67


 1950 00f2 00EB8303 		add	r3, r0, r3, lsl #2
 1951 00f6 5B68     		ldr	r3, [r3, #4]
 1952 00f8 009C     		ldr	r4, [sp]
 1953 00fa 1C61     		str	r4, [r3, #16]
1790:USB/core/usb_core.c ****     if (pdev->cfg.dma_enable == 1)
 1954              		.loc 1 1790 0
 1955 00fc C378     		ldrb	r3, [r0, #3]	@ zero_extendqisi2
 1956 00fe 012B     		cmp	r3, #1
 1957 0100 06D1     		bne	.L127
1791:USB/core/usb_core.c ****     {
1792:USB/core/usb_core.c ****       USB_OTG_WRITE_REG32(&pdev->regs.OUTEP_REGS[ep->num]->DOEPDMA, ep->dma_addr);
 1958              		.loc 1 1792 0
 1959 0102 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1960 0104 1433     		adds	r3, r3, #20
 1961 0106 00EB8303 		add	r3, r0, r3, lsl #2
 1962 010a 5B68     		ldr	r3, [r3, #4]
 1963 010c 0C69     		ldr	r4, [r1, #16]
 1964 010e 5C61     		str	r4, [r3, #20]
 1965              	.L127:
1793:USB/core/usb_core.c ****     }
1794:USB/core/usb_core.c ****     /* EP enable */
1795:USB/core/usb_core.c ****     depctl.b.cnak = 1;
1796:USB/core/usb_core.c ****     depctl.b.epena = 1;
 1966              		.loc 1 1796 0
 1967 0110 42F00442 		orr	r2, r2, #-2080374784
 1968              	.LVL232:
1797:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32 (&(pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL), depctl.d32);
 1969              		.loc 1 1797 0
 1970 0114 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 1971 0116 1433     		adds	r3, r3, #20
 1972 0118 00EB8300 		add	r0, r0, r3, lsl #2
 1973              	.LVL233:
 1974 011c 4368     		ldr	r3, [r0, #4]
 1975              	.LVL234:
 1976 011e 1A60     		str	r2, [r3]
 1977              	.LVL235:
 1978              	.L124:
1798:USB/core/usb_core.c ****     
1799:USB/core/usb_core.c ****   }
1800:USB/core/usb_core.c ****   return status;
1801:USB/core/usb_core.c **** }
 1979              		.loc 1 1801 0
 1980 0120 0020     		movs	r0, #0
 1981 0122 02B0     		add	sp, sp, #8
 1982              	.LCFI28:
 1983              		.cfi_def_cfa_offset 8
 1984              		@ sp needed
 1985 0124 30BC     		pop	{r4, r5}
 1986              	.LCFI29:
 1987              		.cfi_restore 5
 1988              		.cfi_restore 4
 1989              		.cfi_def_cfa_offset 0
 1990 0126 7047     		bx	lr
 1991              		.cfi_endproc
 1992              	.LFE148:
 1994              		.section	.text.USB_OTG_EPSetStall,"ax",%progbits
 1995              		.align	2
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 68


 1996              		.global	USB_OTG_EPSetStall
 1997              		.thumb
 1998              		.thumb_func
 2000              	USB_OTG_EPSetStall:
 2001              	.LFB149:
1802:USB/core/usb_core.c **** 
1803:USB/core/usb_core.c **** 
1804:USB/core/usb_core.c **** /**
1805:USB/core/usb_core.c **** * @brief  USB_OTG_EPSetStall : Set the EP STALL
1806:USB/core/usb_core.c **** * @param  pdev : Selected device
1807:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1808:USB/core/usb_core.c **** */
1809:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_EPSetStall(USB_OTG_CORE_HANDLE *pdev , USB_OTG_EP *ep)
1810:USB/core/usb_core.c **** {
 2002              		.loc 1 1810 0
 2003              		.cfi_startproc
 2004              		@ args = 0, pretend = 0, frame = 0
 2005              		@ frame_needed = 0, uses_anonymous_args = 0
 2006              		@ link register save eliminated.
 2007              	.LVL236:
1811:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
1812:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef  depctl;
1813:USB/core/usb_core.c ****   __IO uint32_t *depctl_addr;
1814:USB/core/usb_core.c ****   
1815:USB/core/usb_core.c ****   depctl.d32 = 0;
1816:USB/core/usb_core.c ****   if (ep->is_in == 1)
 2008              		.loc 1 1816 0
 2009 0000 4B78     		ldrb	r3, [r1, #1]	@ zero_extendqisi2
 2010 0002 012B     		cmp	r3, #1
 2011 0004 0DD1     		bne	.L130
1817:USB/core/usb_core.c ****   {
1818:USB/core/usb_core.c ****     depctl_addr = &(pdev->regs.INEP_REGS[ep->num]->DIEPCTL);
 2012              		.loc 1 1818 0
 2013 0006 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 2014 0008 0433     		adds	r3, r3, #4
 2015 000a 00EB8300 		add	r0, r0, r3, lsl #2
 2016              	.LVL237:
 2017 000e 8268     		ldr	r2, [r0, #8]
 2018              	.LVL238:
1819:USB/core/usb_core.c ****     depctl.d32 = USB_OTG_READ_REG32(depctl_addr);
 2019              		.loc 1 1819 0
 2020 0010 1368     		ldr	r3, [r2]
 2021              	.LVL239:
1820:USB/core/usb_core.c ****     /* set the disable and stall bits */
1821:USB/core/usb_core.c ****     if (depctl.b.epena)
 2022              		.loc 1 1821 0
 2023 0012 002B     		cmp	r3, #0
 2024 0014 01DA     		bge	.L131
1822:USB/core/usb_core.c ****     {
1823:USB/core/usb_core.c ****       depctl.b.epdis = 1;
 2025              		.loc 1 1823 0
 2026 0016 43F08043 		orr	r3, r3, #1073741824
 2027              	.LVL240:
 2028              	.L131:
1824:USB/core/usb_core.c ****     }
1825:USB/core/usb_core.c ****     depctl.b.stall = 1;
 2029              		.loc 1 1825 0
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 69


 2030 001a 43F40013 		orr	r3, r3, #2097152
 2031              	.LVL241:
1826:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(depctl_addr, depctl.d32);
 2032              		.loc 1 1826 0
 2033 001e 1360     		str	r3, [r2]
 2034 0020 08E0     		b	.L132
 2035              	.LVL242:
 2036              	.L130:
1827:USB/core/usb_core.c ****   }
1828:USB/core/usb_core.c ****   else
1829:USB/core/usb_core.c ****   {
1830:USB/core/usb_core.c ****     depctl_addr = &(pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL);
 2037              		.loc 1 1830 0
 2038 0022 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 2039 0024 1433     		adds	r3, r3, #20
 2040 0026 00EB8300 		add	r0, r0, r3, lsl #2
 2041              	.LVL243:
 2042 002a 4268     		ldr	r2, [r0, #4]
 2043              	.LVL244:
1831:USB/core/usb_core.c ****     depctl.d32 = USB_OTG_READ_REG32(depctl_addr);
 2044              		.loc 1 1831 0
 2045 002c 1168     		ldr	r1, [r2]
 2046              	.LVL245:
1832:USB/core/usb_core.c ****     /* set the stall bit */
1833:USB/core/usb_core.c ****     depctl.b.stall = 1;
 2047              		.loc 1 1833 0
 2048 002e 41F40013 		orr	r3, r1, #2097152
 2049              	.LVL246:
1834:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32(depctl_addr, depctl.d32);
 2050              		.loc 1 1834 0
 2051 0032 1360     		str	r3, [r2]
 2052              	.LVL247:
 2053              	.L132:
1835:USB/core/usb_core.c ****   }
1836:USB/core/usb_core.c ****   return status;
1837:USB/core/usb_core.c **** }
 2054              		.loc 1 1837 0
 2055 0034 0020     		movs	r0, #0
 2056 0036 7047     		bx	lr
 2057              		.cfi_endproc
 2058              	.LFE149:
 2060              		.section	.text.USB_OTG_EPClearStall,"ax",%progbits
 2061              		.align	2
 2062              		.global	USB_OTG_EPClearStall
 2063              		.thumb
 2064              		.thumb_func
 2066              	USB_OTG_EPClearStall:
 2067              	.LFB150:
1838:USB/core/usb_core.c **** 
1839:USB/core/usb_core.c **** 
1840:USB/core/usb_core.c **** /**
1841:USB/core/usb_core.c **** * @brief  Clear the EP STALL
1842:USB/core/usb_core.c **** * @param  pdev : Selected device
1843:USB/core/usb_core.c **** * @retval USB_OTG_STS : status
1844:USB/core/usb_core.c **** */
1845:USB/core/usb_core.c **** USB_OTG_STS USB_OTG_EPClearStall(USB_OTG_CORE_HANDLE *pdev , USB_OTG_EP *ep)
1846:USB/core/usb_core.c **** {
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 70


 2068              		.loc 1 1846 0
 2069              		.cfi_startproc
 2070              		@ args = 0, pretend = 0, frame = 0
 2071              		@ frame_needed = 0, uses_anonymous_args = 0
 2072              		@ link register save eliminated.
 2073              	.LVL248:
1847:USB/core/usb_core.c ****   USB_OTG_STS status = USB_OTG_OK;
1848:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef  depctl;
1849:USB/core/usb_core.c ****   __IO uint32_t *depctl_addr;
1850:USB/core/usb_core.c ****   
1851:USB/core/usb_core.c ****   depctl.d32 = 0;
1852:USB/core/usb_core.c ****   
1853:USB/core/usb_core.c ****   if (ep->is_in == 1)
 2074              		.loc 1 1853 0
 2075 0000 4B78     		ldrb	r3, [r1, #1]	@ zero_extendqisi2
 2076 0002 012B     		cmp	r3, #1
 2077 0004 05D1     		bne	.L134
1854:USB/core/usb_core.c ****   {
1855:USB/core/usb_core.c ****     depctl_addr = &(pdev->regs.INEP_REGS[ep->num]->DIEPCTL);
 2078              		.loc 1 1855 0
 2079 0006 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 2080 0008 0433     		adds	r3, r3, #4
 2081 000a 00EB8300 		add	r0, r0, r3, lsl #2
 2082              	.LVL249:
 2083 000e 8068     		ldr	r0, [r0, #8]
 2084              	.LVL250:
 2085 0010 04E0     		b	.L135
 2086              	.LVL251:
 2087              	.L134:
1856:USB/core/usb_core.c ****   }
1857:USB/core/usb_core.c ****   else
1858:USB/core/usb_core.c ****   {
1859:USB/core/usb_core.c ****     depctl_addr = &(pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL);
 2088              		.loc 1 1859 0
 2089 0012 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 2090 0014 1433     		adds	r3, r3, #20
 2091 0016 00EB8300 		add	r0, r0, r3, lsl #2
 2092              	.LVL252:
 2093 001a 4068     		ldr	r0, [r0, #4]
 2094              	.LVL253:
 2095              	.L135:
1860:USB/core/usb_core.c ****   }
1861:USB/core/usb_core.c ****   depctl.d32 = USB_OTG_READ_REG32(depctl_addr);
 2096              		.loc 1 1861 0
 2097 001c 0268     		ldr	r2, [r0]
 2098              	.LVL254:
1862:USB/core/usb_core.c ****   /* clear the stall bits */
1863:USB/core/usb_core.c ****   depctl.b.stall = 0;
 2099              		.loc 1 1863 0
 2100 001e 6FF35552 		bfc	r2, #21, #1
1864:USB/core/usb_core.c ****   if (ep->type == EP_TYPE_INTR || ep->type == EP_TYPE_BULK)
 2101              		.loc 1 1864 0
 2102 0022 CB78     		ldrb	r3, [r1, #3]	@ zero_extendqisi2
 2103 0024 023B     		subs	r3, r3, #2
 2104 0026 DBB2     		uxtb	r3, r3
 2105 0028 012B     		cmp	r3, #1
 2106 002a 01D8     		bhi	.L136
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 71


1865:USB/core/usb_core.c ****   {
1866:USB/core/usb_core.c ****     depctl.b.setd0pid = 1; /* DATA0 */
 2107              		.loc 1 1866 0
 2108 002c 42F08052 		orr	r2, r2, #268435456
 2109              	.LVL255:
 2110              	.L136:
1867:USB/core/usb_core.c ****   }
1868:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(depctl_addr, depctl.d32);
 2111              		.loc 1 1868 0
 2112 0030 0260     		str	r2, [r0]
1869:USB/core/usb_core.c ****   return status;
1870:USB/core/usb_core.c **** }
 2113              		.loc 1 1870 0
 2114 0032 0020     		movs	r0, #0
 2115              	.LVL256:
 2116 0034 7047     		bx	lr
 2117              		.cfi_endproc
 2118              	.LFE150:
 2120 0036 00BF     		.section	.text.USB_OTG_ReadDevAllOutEp_itr,"ax",%progbits
 2121              		.align	2
 2122              		.global	USB_OTG_ReadDevAllOutEp_itr
 2123              		.thumb
 2124              		.thumb_func
 2126              	USB_OTG_ReadDevAllOutEp_itr:
 2127              	.LFB151:
1871:USB/core/usb_core.c **** 
1872:USB/core/usb_core.c **** 
1873:USB/core/usb_core.c **** /**
1874:USB/core/usb_core.c **** * @brief  USB_OTG_ReadDevAllOutEp_itr : returns OUT endpoint interrupt bits
1875:USB/core/usb_core.c **** * @param  pdev : Selected device
1876:USB/core/usb_core.c **** * @retval OUT endpoint interrupt bits
1877:USB/core/usb_core.c **** */
1878:USB/core/usb_core.c **** uint32_t USB_OTG_ReadDevAllOutEp_itr(USB_OTG_CORE_HANDLE *pdev)
1879:USB/core/usb_core.c **** {
 2128              		.loc 1 1879 0
 2129              		.cfi_startproc
 2130              		@ args = 0, pretend = 0, frame = 0
 2131              		@ frame_needed = 0, uses_anonymous_args = 0
 2132              		@ link register save eliminated.
 2133              	.LVL257:
1880:USB/core/usb_core.c ****   uint32_t v;
1881:USB/core/usb_core.c ****   v  = USB_OTG_READ_REG32(&pdev->regs.DREGS->DAINT);
 2134              		.loc 1 1881 0
 2135 0000 0369     		ldr	r3, [r0, #16]
 2136 0002 9869     		ldr	r0, [r3, #24]
 2137              	.LVL258:
1882:USB/core/usb_core.c ****   v &= USB_OTG_READ_REG32(&pdev->regs.DREGS->DAINTMSK);
 2138              		.loc 1 1882 0
 2139 0004 DB69     		ldr	r3, [r3, #28]
 2140 0006 1840     		ands	r0, r0, r3
 2141              	.LVL259:
1883:USB/core/usb_core.c ****   return ((v & 0xffff0000) >> 16);
1884:USB/core/usb_core.c **** }
 2142              		.loc 1 1884 0
 2143 0008 000C     		lsrs	r0, r0, #16
 2144              	.LVL260:
 2145 000a 7047     		bx	lr
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 72


 2146              		.cfi_endproc
 2147              	.LFE151:
 2149              		.section	.text.USB_OTG_ReadDevOutEP_itr,"ax",%progbits
 2150              		.align	2
 2151              		.global	USB_OTG_ReadDevOutEP_itr
 2152              		.thumb
 2153              		.thumb_func
 2155              	USB_OTG_ReadDevOutEP_itr:
 2156              	.LFB152:
1885:USB/core/usb_core.c **** 
1886:USB/core/usb_core.c **** 
1887:USB/core/usb_core.c **** /**
1888:USB/core/usb_core.c **** * @brief  USB_OTG_ReadDevOutEP_itr : returns Device OUT EP Interrupt register
1889:USB/core/usb_core.c **** * @param  pdev : Selected device
1890:USB/core/usb_core.c **** * @param  ep : end point number
1891:USB/core/usb_core.c **** * @retval Device OUT EP Interrupt register
1892:USB/core/usb_core.c **** */
1893:USB/core/usb_core.c **** uint32_t USB_OTG_ReadDevOutEP_itr(USB_OTG_CORE_HANDLE *pdev , uint8_t epnum)
1894:USB/core/usb_core.c **** {
 2157              		.loc 1 1894 0
 2158              		.cfi_startproc
 2159              		@ args = 0, pretend = 0, frame = 0
 2160              		@ frame_needed = 0, uses_anonymous_args = 0
 2161              		@ link register save eliminated.
 2162              	.LVL261:
1895:USB/core/usb_core.c ****   uint32_t v;
1896:USB/core/usb_core.c ****   v  = USB_OTG_READ_REG32(&pdev->regs.OUTEP_REGS[epnum]->DOEPINT);
 2163              		.loc 1 1896 0
 2164 0000 1431     		adds	r1, r1, #20
 2165              	.LVL262:
 2166 0002 00EB8101 		add	r1, r0, r1, lsl #2
 2167 0006 4B68     		ldr	r3, [r1, #4]
 2168 0008 9A68     		ldr	r2, [r3, #8]
 2169              	.LVL263:
1897:USB/core/usb_core.c ****   v &= USB_OTG_READ_REG32(&pdev->regs.DREGS->DOEPMSK);
 2170              		.loc 1 1897 0
 2171 000a 0369     		ldr	r3, [r0, #16]
 2172 000c 5869     		ldr	r0, [r3, #20]
 2173              	.LVL264:
1898:USB/core/usb_core.c ****   return v;
1899:USB/core/usb_core.c **** }
 2174              		.loc 1 1899 0
 2175 000e 1040     		ands	r0, r0, r2
 2176              	.LVL265:
 2177 0010 7047     		bx	lr
 2178              		.cfi_endproc
 2179              	.LFE152:
 2181 0012 00BF     		.section	.text.USB_OTG_ReadDevAllInEPItr,"ax",%progbits
 2182              		.align	2
 2183              		.global	USB_OTG_ReadDevAllInEPItr
 2184              		.thumb
 2185              		.thumb_func
 2187              	USB_OTG_ReadDevAllInEPItr:
 2188              	.LFB153:
1900:USB/core/usb_core.c **** 
1901:USB/core/usb_core.c **** 
1902:USB/core/usb_core.c **** /**
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 73


1903:USB/core/usb_core.c **** * @brief  USB_OTG_ReadDevAllInEPItr : Get int status register
1904:USB/core/usb_core.c **** * @param  pdev : Selected device
1905:USB/core/usb_core.c **** * @retval int status register
1906:USB/core/usb_core.c **** */
1907:USB/core/usb_core.c **** uint32_t USB_OTG_ReadDevAllInEPItr(USB_OTG_CORE_HANDLE *pdev)
1908:USB/core/usb_core.c **** {
 2189              		.loc 1 1908 0
 2190              		.cfi_startproc
 2191              		@ args = 0, pretend = 0, frame = 0
 2192              		@ frame_needed = 0, uses_anonymous_args = 0
 2193              		@ link register save eliminated.
 2194              	.LVL266:
1909:USB/core/usb_core.c ****   uint32_t v;
1910:USB/core/usb_core.c ****   v = USB_OTG_READ_REG32(&pdev->regs.DREGS->DAINT);
 2195              		.loc 1 1910 0
 2196 0000 0369     		ldr	r3, [r0, #16]
 2197 0002 9869     		ldr	r0, [r3, #24]
 2198              	.LVL267:
1911:USB/core/usb_core.c ****   v &= USB_OTG_READ_REG32(&pdev->regs.DREGS->DAINTMSK);
 2199              		.loc 1 1911 0
 2200 0004 DB69     		ldr	r3, [r3, #28]
 2201 0006 1840     		ands	r0, r0, r3
 2202              	.LVL268:
1912:USB/core/usb_core.c ****   return (v & 0xffff);
1913:USB/core/usb_core.c **** }
 2203              		.loc 1 1913 0
 2204 0008 80B2     		uxth	r0, r0
 2205              	.LVL269:
 2206 000a 7047     		bx	lr
 2207              		.cfi_endproc
 2208              	.LFE153:
 2210              		.section	.text.USB_OTG_EP0_OutStart,"ax",%progbits
 2211              		.align	2
 2212              		.global	USB_OTG_EP0_OutStart
 2213              		.thumb
 2214              		.thumb_func
 2216              	USB_OTG_EP0_OutStart:
 2217              	.LFB154:
1914:USB/core/usb_core.c **** 
1915:USB/core/usb_core.c **** /**
1916:USB/core/usb_core.c **** * @brief  configures EPO to receive SETUP packets
1917:USB/core/usb_core.c **** * @param  None
1918:USB/core/usb_core.c **** * @retval : None
1919:USB/core/usb_core.c **** */
1920:USB/core/usb_core.c **** void USB_OTG_EP0_OutStart(USB_OTG_CORE_HANDLE *pdev)
1921:USB/core/usb_core.c **** {
 2218              		.loc 1 1921 0
 2219              		.cfi_startproc
 2220              		@ args = 0, pretend = 0, frame = 8
 2221              		@ frame_needed = 0, uses_anonymous_args = 0
 2222              		@ link register save eliminated.
 2223              	.LVL270:
 2224 0000 82B0     		sub	sp, sp, #8
 2225              	.LCFI30:
 2226              		.cfi_def_cfa_offset 8
1922:USB/core/usb_core.c ****   USB_OTG_DEP0XFRSIZ_TypeDef  doeptsize0;
1923:USB/core/usb_core.c ****   doeptsize0.d32 = 0;
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 74


 2227              		.loc 1 1923 0
 2228 0002 0023     		movs	r3, #0
 2229 0004 0093     		str	r3, [sp]
1924:USB/core/usb_core.c ****   doeptsize0.b.supcnt = 3;
 2230              		.loc 1 1924 0
 2231 0006 C023     		movs	r3, #192
 2232 0008 8DF80330 		strb	r3, [sp, #3]
1925:USB/core/usb_core.c ****   doeptsize0.b.pktcnt = 1;
 2233              		.loc 1 1925 0
 2234 000c 4FF00003 		mov	r3, #0
 2235 0010 0122     		movs	r2, #1
 2236 0012 62F3C403 		bfi	r3, r2, #3, #2
 2237 0016 8DF80230 		strb	r3, [sp, #2]
1926:USB/core/usb_core.c ****   doeptsize0.b.xfersize = 8 * 3;
 2238              		.loc 1 1926 0
 2239 001a 1823     		movs	r3, #24
 2240 001c 8DF80030 		strb	r3, [sp]
1927:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.OUTEP_REGS[0]->DOEPTSIZ, doeptsize0.d32 );
 2241              		.loc 1 1927 0
 2242 0020 436D     		ldr	r3, [r0, #84]
 2243 0022 009A     		ldr	r2, [sp]
 2244 0024 1A61     		str	r2, [r3, #16]
1928:USB/core/usb_core.c ****   
1929:USB/core/usb_core.c ****   if (pdev->cfg.dma_enable == 1)
 2245              		.loc 1 1929 0
 2246 0026 C378     		ldrb	r3, [r0, #3]	@ zero_extendqisi2
 2247 0028 012B     		cmp	r3, #1
 2248 002a 08D1     		bne	.L140
 2249              	.LBB4:
1930:USB/core/usb_core.c ****   {
1931:USB/core/usb_core.c ****     USB_OTG_DEPCTL_TypeDef  doepctl;
1932:USB/core/usb_core.c ****     doepctl.d32 = 0;
1933:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.OUTEP_REGS[0]->DOEPDMA, 
 2250              		.loc 1 1933 0
 2251 002c 436D     		ldr	r3, [r0, #84]
 2252 002e 00F2CC52 		addw	r2, r0, #1484
 2253 0032 5A61     		str	r2, [r3, #20]
1934:USB/core/usb_core.c ****                         (uint32_t)&pdev->dev.setup_packet);
1935:USB/core/usb_core.c ****     
1936:USB/core/usb_core.c ****     /* EP enable */
1937:USB/core/usb_core.c ****     doepctl.d32 = USB_OTG_READ_REG32(&pdev->regs.OUTEP_REGS[0]->DOEPCTL);
 2254              		.loc 1 1937 0
 2255 0034 436D     		ldr	r3, [r0, #84]
 2256 0036 1A68     		ldr	r2, [r3]
1938:USB/core/usb_core.c ****     doepctl.b.epena = 1;
1939:USB/core/usb_core.c ****     doepctl.d32 = 0x80008000;
1940:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.OUTEP_REGS[0]->DOEPCTL, doepctl.d32);
 2257              		.loc 1 1940 0
 2258 0038 4FF08022 		mov	r2, #-2147450880
 2259 003c 1A60     		str	r2, [r3]
 2260              	.L140:
 2261              	.LBE4:
1941:USB/core/usb_core.c ****   }
1942:USB/core/usb_core.c **** }
 2262              		.loc 1 1942 0
 2263 003e 02B0     		add	sp, sp, #8
 2264              	.LCFI31:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 75


 2265              		.cfi_def_cfa_offset 0
 2266              		@ sp needed
 2267 0040 7047     		bx	lr
 2268              		.cfi_endproc
 2269              	.LFE154:
 2271 0042 00BF     		.section	.text.USB_OTG_ActiveRemoteWakeup,"ax",%progbits
 2272              		.align	2
 2273              		.global	USB_OTG_ActiveRemoteWakeup
 2274              		.thumb
 2275              		.thumb_func
 2277              	USB_OTG_ActiveRemoteWakeup:
 2278              	.LFB155:
1943:USB/core/usb_core.c **** 
1944:USB/core/usb_core.c **** /**
1945:USB/core/usb_core.c **** * @brief  USB_OTG_RemoteWakeup : active remote wakeup signalling
1946:USB/core/usb_core.c **** * @param  None
1947:USB/core/usb_core.c **** * @retval : None
1948:USB/core/usb_core.c **** */
1949:USB/core/usb_core.c **** void USB_OTG_ActiveRemoteWakeup(USB_OTG_CORE_HANDLE *pdev)
1950:USB/core/usb_core.c **** {
 2279              		.loc 1 1950 0
 2280              		.cfi_startproc
 2281              		@ args = 0, pretend = 0, frame = 0
 2282              		@ frame_needed = 0, uses_anonymous_args = 0
 2283              	.LVL271:
1951:USB/core/usb_core.c ****   
1952:USB/core/usb_core.c ****   USB_OTG_DCTL_TypeDef     dctl;
1953:USB/core/usb_core.c ****   USB_OTG_DSTS_TypeDef     dsts;
1954:USB/core/usb_core.c ****   USB_OTG_PCGCCTL_TypeDef  power;  
1955:USB/core/usb_core.c ****   
1956:USB/core/usb_core.c ****   if (pdev->dev.DevRemoteWakeup) 
 2284              		.loc 1 1956 0
 2285 0000 D0F81831 		ldr	r3, [r0, #280]
 2286 0004 FBB1     		cbz	r3, .L147
1957:USB/core/usb_core.c ****   {
1958:USB/core/usb_core.c ****     dsts.d32 = USB_OTG_READ_REG32(&pdev->regs.DREGS->DSTS);
 2287              		.loc 1 1958 0
 2288 0006 0369     		ldr	r3, [r0, #16]
 2289 0008 9B68     		ldr	r3, [r3, #8]
1959:USB/core/usb_core.c ****     if(dsts.b.suspsts == 1)
 2290              		.loc 1 1959 0
 2291 000a 13F0010F 		tst	r3, #1
 2292 000e 1AD0     		beq	.L147
1950:USB/core/usb_core.c ****   
 2293              		.loc 1 1950 0
 2294 0010 10B5     		push	{r4, lr}
 2295              	.LCFI32:
 2296              		.cfi_def_cfa_offset 8
 2297              		.cfi_offset 4, -8
 2298              		.cfi_offset 14, -4
1960:USB/core/usb_core.c ****     {
1961:USB/core/usb_core.c ****       if(pdev->cfg.low_power)
 2299              		.loc 1 1961 0
 2300 0012 837A     		ldrb	r3, [r0, #10]	@ zero_extendqisi2
 2301 0014 43B1     		cbz	r3, .L145
1962:USB/core/usb_core.c ****       {
1963:USB/core/usb_core.c ****         /* un-gate USB Core clock */
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 76


1964:USB/core/usb_core.c ****         power.d32 = USB_OTG_READ_REG32(&pdev->regs.PCGCCTL);
 2302              		.loc 1 1964 0
 2303 0016 D0F80C31 		ldr	r3, [r0, #268]
1965:USB/core/usb_core.c ****         power.b.gatehclk = 0;
 2304              		.loc 1 1965 0
 2305 001a 6FF34103 		bfc	r3, #1, #1
 2306              	.LVL272:
1966:USB/core/usb_core.c ****         power.b.stoppclk = 0;
 2307              		.loc 1 1966 0
 2308 001e 6FF30003 		bfc	r3, #0, #1
1967:USB/core/usb_core.c ****         USB_OTG_WRITE_REG32(pdev->regs.PCGCCTL, power.d32);
 2309              		.loc 1 1967 0
 2310 0022 D0F80C21 		ldr	r2, [r0, #268]
 2311 0026 1360     		str	r3, [r2]
 2312              	.L145:
 2313 0028 0446     		mov	r4, r0
1968:USB/core/usb_core.c ****       }   
1969:USB/core/usb_core.c ****       /* active Remote wakeup signaling */
1970:USB/core/usb_core.c ****       dctl.d32 = 0;
1971:USB/core/usb_core.c ****       dctl.b.rmtwkupsig = 1;
1972:USB/core/usb_core.c ****       USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DCTL, 0, dctl.d32);
 2314              		.loc 1 1972 0
 2315 002a 0269     		ldr	r2, [r0, #16]
 2316 002c 5368     		ldr	r3, [r2, #4]
 2317              	.LVL273:
 2318 002e 43F00103 		orr	r3, r3, #1
 2319 0032 5360     		str	r3, [r2, #4]
1973:USB/core/usb_core.c ****       USB_OTG_BSP_mDelay(5);
 2320              		.loc 1 1973 0
 2321 0034 0520     		movs	r0, #5
 2322              	.LVL274:
 2323 0036 FFF7FEFF 		bl	USB_OTG_BSP_mDelay
 2324              	.LVL275:
1974:USB/core/usb_core.c ****       USB_OTG_MODIFY_REG32(&pdev->regs.DREGS->DCTL, dctl.d32, 0 );
 2325              		.loc 1 1974 0
 2326 003a 2269     		ldr	r2, [r4, #16]
 2327 003c 5368     		ldr	r3, [r2, #4]
 2328 003e 23F00103 		bic	r3, r3, #1
 2329 0042 5360     		str	r3, [r2, #4]
 2330 0044 10BD     		pop	{r4, pc}
 2331              	.LVL276:
 2332              	.L147:
 2333              	.LCFI33:
 2334              		.cfi_def_cfa_offset 0
 2335              		.cfi_restore 4
 2336              		.cfi_restore 14
 2337 0046 7047     		bx	lr
 2338              		.cfi_endproc
 2339              	.LFE155:
 2341              		.section	.text.USB_OTG_UngateClock,"ax",%progbits
 2342              		.align	2
 2343              		.global	USB_OTG_UngateClock
 2344              		.thumb
 2345              		.thumb_func
 2347              	USB_OTG_UngateClock:
 2348              	.LFB156:
1975:USB/core/usb_core.c ****     }
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 77


1976:USB/core/usb_core.c ****   }
1977:USB/core/usb_core.c **** }
1978:USB/core/usb_core.c **** 
1979:USB/core/usb_core.c **** 
1980:USB/core/usb_core.c **** /**
1981:USB/core/usb_core.c **** * @brief  USB_OTG_UngateClock : active USB Core clock
1982:USB/core/usb_core.c **** * @param  None
1983:USB/core/usb_core.c **** * @retval : None
1984:USB/core/usb_core.c **** */
1985:USB/core/usb_core.c **** void USB_OTG_UngateClock(USB_OTG_CORE_HANDLE *pdev)
1986:USB/core/usb_core.c **** {
 2349              		.loc 1 1986 0
 2350              		.cfi_startproc
 2351              		@ args = 0, pretend = 0, frame = 0
 2352              		@ frame_needed = 0, uses_anonymous_args = 0
 2353              		@ link register save eliminated.
 2354              	.LVL277:
1987:USB/core/usb_core.c ****   if(pdev->cfg.low_power)
 2355              		.loc 1 1987 0
 2356 0000 837A     		ldrb	r3, [r0, #10]	@ zero_extendqisi2
 2357 0002 6BB1     		cbz	r3, .L148
 2358              	.LBB5:
1988:USB/core/usb_core.c ****   {
1989:USB/core/usb_core.c ****     
1990:USB/core/usb_core.c ****     USB_OTG_DSTS_TypeDef     dsts;
1991:USB/core/usb_core.c ****     USB_OTG_PCGCCTL_TypeDef  power; 
1992:USB/core/usb_core.c ****     
1993:USB/core/usb_core.c ****     dsts.d32 = USB_OTG_READ_REG32(&pdev->regs.DREGS->DSTS);
 2359              		.loc 1 1993 0
 2360 0004 0369     		ldr	r3, [r0, #16]
 2361 0006 9B68     		ldr	r3, [r3, #8]
1994:USB/core/usb_core.c ****     
1995:USB/core/usb_core.c ****     if(dsts.b.suspsts == 1)
 2362              		.loc 1 1995 0
 2363 0008 13F0010F 		tst	r3, #1
 2364 000c 08D0     		beq	.L148
1996:USB/core/usb_core.c ****     {
1997:USB/core/usb_core.c ****       /* un-gate USB Core clock */
1998:USB/core/usb_core.c ****       power.d32 = USB_OTG_READ_REG32(&pdev->regs.PCGCCTL);
 2365              		.loc 1 1998 0
 2366 000e D0F80C31 		ldr	r3, [r0, #268]
1999:USB/core/usb_core.c ****       power.b.gatehclk = 0;
 2367              		.loc 1 1999 0
 2368 0012 6FF34103 		bfc	r3, #1, #1
 2369              	.LVL278:
2000:USB/core/usb_core.c ****       power.b.stoppclk = 0;
 2370              		.loc 1 2000 0
 2371 0016 6FF30003 		bfc	r3, #0, #1
2001:USB/core/usb_core.c ****       USB_OTG_WRITE_REG32(pdev->regs.PCGCCTL, power.d32);
 2372              		.loc 1 2001 0
 2373 001a D0F80C21 		ldr	r2, [r0, #268]
 2374 001e 1360     		str	r3, [r2]
 2375              	.L148:
 2376 0020 7047     		bx	lr
 2377              	.LBE5:
 2378              		.cfi_endproc
 2379              	.LFE156:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 78


 2381 0022 00BF     		.section	.text.USB_OTG_StopDevice,"ax",%progbits
 2382              		.align	2
 2383              		.global	USB_OTG_StopDevice
 2384              		.thumb
 2385              		.thumb_func
 2387              	USB_OTG_StopDevice:
 2388              	.LFB157:
2002:USB/core/usb_core.c ****       
2003:USB/core/usb_core.c ****     }
2004:USB/core/usb_core.c ****   }
2005:USB/core/usb_core.c **** }
2006:USB/core/usb_core.c **** 
2007:USB/core/usb_core.c **** /**
2008:USB/core/usb_core.c **** * @brief  Stop the device and clean up fifo's
2009:USB/core/usb_core.c **** * @param  None
2010:USB/core/usb_core.c **** * @retval : None
2011:USB/core/usb_core.c **** */
2012:USB/core/usb_core.c **** void USB_OTG_StopDevice(USB_OTG_CORE_HANDLE *pdev)
2013:USB/core/usb_core.c **** {
 2389              		.loc 1 2013 0
 2390              		.cfi_startproc
 2391              		@ args = 0, pretend = 0, frame = 0
 2392              		@ frame_needed = 0, uses_anonymous_args = 0
 2393              	.LVL279:
 2394 0000 10B5     		push	{r4, lr}
 2395              	.LCFI34:
 2396              		.cfi_def_cfa_offset 8
 2397              		.cfi_offset 4, -8
 2398              		.cfi_offset 14, -4
 2399 0002 0446     		mov	r4, r0
2014:USB/core/usb_core.c ****   uint32_t i;
2015:USB/core/usb_core.c ****   
2016:USB/core/usb_core.c ****   pdev->dev.device_status = 1;
 2400              		.loc 1 2016 0
 2401 0004 0123     		movs	r3, #1
 2402 0006 80F81231 		strb	r3, [r0, #274]
 2403              	.LVL280:
2017:USB/core/usb_core.c ****   
2018:USB/core/usb_core.c ****   for (i = 0; i < pdev->cfg.dev_endpoints ; i++)
 2404              		.loc 1 2018 0
 2405 000a 0023     		movs	r3, #0
 2406 000c 0CE0     		b	.L152
 2407              	.LVL281:
 2408              	.L153:
2019:USB/core/usb_core.c ****   {
2020:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.INEP_REGS[i]->DIEPINT, 0xFF);
 2409              		.loc 1 2020 0 discriminator 3
 2410 000e 1A1D     		adds	r2, r3, #4
 2411 0010 04EB8202 		add	r2, r4, r2, lsl #2
 2412 0014 9268     		ldr	r2, [r2, #8]
 2413 0016 FF21     		movs	r1, #255
 2414 0018 9160     		str	r1, [r2, #8]
2021:USB/core/usb_core.c ****     USB_OTG_WRITE_REG32( &pdev->regs.OUTEP_REGS[i]->DOEPINT, 0xFF);
 2415              		.loc 1 2021 0 discriminator 3
 2416 001a 03F11402 		add	r2, r3, #20
 2417 001e 04EB8202 		add	r2, r4, r2, lsl #2
 2418 0022 5268     		ldr	r2, [r2, #4]
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 79


 2419 0024 9160     		str	r1, [r2, #8]
2018:USB/core/usb_core.c ****   {
 2420              		.loc 1 2018 0 discriminator 3
 2421 0026 0133     		adds	r3, r3, #1
 2422              	.LVL282:
 2423              	.L152:
2018:USB/core/usb_core.c ****   {
 2424              		.loc 1 2018 0 is_stmt 0 discriminator 1
 2425 0028 6278     		ldrb	r2, [r4, #1]	@ zero_extendqisi2
 2426 002a 9342     		cmp	r3, r2
 2427 002c EFD3     		bcc	.L153
2022:USB/core/usb_core.c ****   }
2023:USB/core/usb_core.c ****   
2024:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DIEPMSK, 0 );
 2428              		.loc 1 2024 0 is_stmt 1
 2429 002e 2269     		ldr	r2, [r4, #16]
 2430 0030 0023     		movs	r3, #0
 2431              	.LVL283:
 2432 0032 1361     		str	r3, [r2, #16]
2025:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DOEPMSK, 0 );
 2433              		.loc 1 2025 0
 2434 0034 2269     		ldr	r2, [r4, #16]
 2435 0036 5361     		str	r3, [r2, #20]
2026:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DAINTMSK, 0 );
 2436              		.loc 1 2026 0
 2437 0038 2269     		ldr	r2, [r4, #16]
 2438 003a D361     		str	r3, [r2, #28]
2027:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32( &pdev->regs.DREGS->DAINT, 0xFFFFFFFF );  
 2439              		.loc 1 2027 0
 2440 003c 2369     		ldr	r3, [r4, #16]
 2441 003e 4FF0FF32 		mov	r2, #-1
 2442 0042 9A61     		str	r2, [r3, #24]
2028:USB/core/usb_core.c ****   
2029:USB/core/usb_core.c ****   /* Flush the FIFO */
2030:USB/core/usb_core.c ****   USB_OTG_FlushRxFifo(pdev);
 2443              		.loc 1 2030 0
 2444 0044 2046     		mov	r0, r4
 2445              	.LVL284:
 2446 0046 FFF7FEFF 		bl	USB_OTG_FlushRxFifo
 2447              	.LVL285:
2031:USB/core/usb_core.c ****   USB_OTG_FlushTxFifo(pdev ,  0x10 );  
 2448              		.loc 1 2031 0
 2449 004a 1021     		movs	r1, #16
 2450 004c 2046     		mov	r0, r4
 2451 004e FFF7FEFF 		bl	USB_OTG_FlushTxFifo
 2452              	.LVL286:
 2453 0052 10BD     		pop	{r4, pc}
 2454              		.cfi_endproc
 2455              	.LFE157:
 2457              		.section	.text.USB_OTG_GetEPStatus,"ax",%progbits
 2458              		.align	2
 2459              		.global	USB_OTG_GetEPStatus
 2460              		.thumb
 2461              		.thumb_func
 2463              	USB_OTG_GetEPStatus:
 2464              	.LFB158:
2032:USB/core/usb_core.c **** }
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 80


2033:USB/core/usb_core.c **** 
2034:USB/core/usb_core.c **** /**
2035:USB/core/usb_core.c **** * @brief  returns the EP Status
2036:USB/core/usb_core.c **** * @param  pdev : Selected device
2037:USB/core/usb_core.c **** *         ep : endpoint structure
2038:USB/core/usb_core.c **** * @retval : EP status
2039:USB/core/usb_core.c **** */
2040:USB/core/usb_core.c **** 
2041:USB/core/usb_core.c **** uint32_t USB_OTG_GetEPStatus(USB_OTG_CORE_HANDLE *pdev ,USB_OTG_EP *ep)
2042:USB/core/usb_core.c **** {
 2465              		.loc 1 2042 0
 2466              		.cfi_startproc
 2467              		@ args = 0, pretend = 0, frame = 0
 2468              		@ frame_needed = 0, uses_anonymous_args = 0
 2469              		@ link register save eliminated.
 2470              	.LVL287:
2043:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef  depctl;
2044:USB/core/usb_core.c ****   __IO uint32_t *depctl_addr;
2045:USB/core/usb_core.c ****   uint32_t Status = 0;  
2046:USB/core/usb_core.c ****   
2047:USB/core/usb_core.c ****   depctl.d32 = 0;
2048:USB/core/usb_core.c ****   if (ep->is_in == 1)
 2471              		.loc 1 2048 0
 2472 0000 4B78     		ldrb	r3, [r1, #1]	@ zero_extendqisi2
 2473 0002 012B     		cmp	r3, #1
 2474 0004 0FD1     		bne	.L156
2049:USB/core/usb_core.c ****   {
2050:USB/core/usb_core.c ****     depctl_addr = &(pdev->regs.INEP_REGS[ep->num]->DIEPCTL);
 2475              		.loc 1 2050 0
 2476 0006 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 2477 0008 0433     		adds	r3, r3, #4
 2478 000a 00EB8300 		add	r0, r0, r3, lsl #2
 2479              	.LVL288:
 2480 000e 8368     		ldr	r3, [r0, #8]
 2481              	.LVL289:
2051:USB/core/usb_core.c ****     depctl.d32 = USB_OTG_READ_REG32(depctl_addr);
 2482              		.loc 1 2051 0
 2483 0010 1B68     		ldr	r3, [r3]
 2484              	.LVL290:
2052:USB/core/usb_core.c ****     
2053:USB/core/usb_core.c ****     if (depctl.b.stall == 1)  
 2485              		.loc 1 2053 0
 2486 0012 C3F30743 		ubfx	r3, r3, #16, #8
 2487 0016 13F0200F 		tst	r3, #32
 2488 001a 15D1     		bne	.L158
2054:USB/core/usb_core.c ****       Status = USB_OTG_EP_TX_STALL;
2055:USB/core/usb_core.c ****     else if (depctl.b.naksts == 1)
 2489              		.loc 1 2055 0
 2490 001c 13F0020F 		tst	r3, #2
 2491 0020 14D0     		beq	.L159
2056:USB/core/usb_core.c ****       Status = USB_OTG_EP_TX_NAK;
 2492              		.loc 1 2056 0
 2493 0022 2020     		movs	r0, #32
 2494              	.LVL291:
 2495 0024 7047     		bx	lr
 2496              	.LVL292:
 2497              	.L156:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 81


2057:USB/core/usb_core.c ****     else 
2058:USB/core/usb_core.c ****       Status = USB_OTG_EP_TX_VALID;     
2059:USB/core/usb_core.c ****     
2060:USB/core/usb_core.c ****   }
2061:USB/core/usb_core.c ****   else
2062:USB/core/usb_core.c ****   {
2063:USB/core/usb_core.c ****     depctl_addr = &(pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL);
 2498              		.loc 1 2063 0
 2499 0026 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 2500 0028 1433     		adds	r3, r3, #20
 2501 002a 00EB8300 		add	r0, r0, r3, lsl #2
 2502              	.LVL293:
 2503 002e 4368     		ldr	r3, [r0, #4]
 2504              	.LVL294:
2064:USB/core/usb_core.c ****     depctl.d32 = USB_OTG_READ_REG32(depctl_addr);
 2505              		.loc 1 2064 0
 2506 0030 1B68     		ldr	r3, [r3]
 2507              	.LVL295:
2065:USB/core/usb_core.c ****     if (depctl.b.stall == 1)  
 2508              		.loc 1 2065 0
 2509 0032 C3F30743 		ubfx	r3, r3, #16, #8
 2510 0036 13F0200F 		tst	r3, #32
 2511 003a 09D1     		bne	.L160
2066:USB/core/usb_core.c ****       Status = USB_OTG_EP_RX_STALL;
2067:USB/core/usb_core.c ****     else if (depctl.b.naksts == 1)
 2512              		.loc 1 2067 0
 2513 003c 13F0020F 		tst	r3, #2
 2514 0040 09D0     		beq	.L161
2068:USB/core/usb_core.c ****       Status = USB_OTG_EP_RX_NAK;
 2515              		.loc 1 2068 0
 2516 0042 4FF40050 		mov	r0, #8192
 2517              	.LVL296:
 2518 0046 7047     		bx	lr
 2519              	.LVL297:
 2520              	.L158:
2054:USB/core/usb_core.c ****     else if (depctl.b.naksts == 1)
 2521              		.loc 1 2054 0
 2522 0048 1020     		movs	r0, #16
 2523              	.LVL298:
 2524 004a 7047     		bx	lr
 2525              	.LVL299:
 2526              	.L159:
2058:USB/core/usb_core.c ****     
 2527              		.loc 1 2058 0
 2528 004c 3020     		movs	r0, #48
 2529              	.LVL300:
 2530 004e 7047     		bx	lr
 2531              	.LVL301:
 2532              	.L160:
2066:USB/core/usb_core.c ****     else if (depctl.b.naksts == 1)
 2533              		.loc 1 2066 0
 2534 0050 4FF48050 		mov	r0, #4096
 2535              	.LVL302:
 2536 0054 7047     		bx	lr
 2537              	.LVL303:
 2538              	.L161:
2069:USB/core/usb_core.c ****     else 
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 82


2070:USB/core/usb_core.c ****       Status = USB_OTG_EP_RX_VALID; 
 2539              		.loc 1 2070 0
 2540 0056 4FF44050 		mov	r0, #12288
 2541              	.LVL304:
2071:USB/core/usb_core.c ****   } 
2072:USB/core/usb_core.c ****   
2073:USB/core/usb_core.c ****   /* Return the current status */
2074:USB/core/usb_core.c ****   return Status;
2075:USB/core/usb_core.c **** }
 2542              		.loc 1 2075 0
 2543 005a 7047     		bx	lr
 2544              		.cfi_endproc
 2545              	.LFE158:
 2547              		.section	.text.USB_OTG_SetEPStatus,"ax",%progbits
 2548              		.align	2
 2549              		.global	USB_OTG_SetEPStatus
 2550              		.thumb
 2551              		.thumb_func
 2553              	USB_OTG_SetEPStatus:
 2554              	.LFB159:
2076:USB/core/usb_core.c **** 
2077:USB/core/usb_core.c **** /**
2078:USB/core/usb_core.c **** * @brief  Set the EP Status
2079:USB/core/usb_core.c **** * @param  pdev : Selected device
2080:USB/core/usb_core.c **** *         Status : new Status
2081:USB/core/usb_core.c **** *         ep : EP structure
2082:USB/core/usb_core.c **** * @retval : None
2083:USB/core/usb_core.c **** */
2084:USB/core/usb_core.c **** void USB_OTG_SetEPStatus (USB_OTG_CORE_HANDLE *pdev , USB_OTG_EP *ep , uint32_t Status)
2085:USB/core/usb_core.c **** {
 2555              		.loc 1 2085 0
 2556              		.cfi_startproc
 2557              		@ args = 0, pretend = 0, frame = 0
 2558              		@ frame_needed = 0, uses_anonymous_args = 0
 2559              	.LVL305:
 2560 0000 10B5     		push	{r4, lr}
 2561              	.LCFI35:
 2562              		.cfi_def_cfa_offset 8
 2563              		.cfi_offset 4, -8
 2564              		.cfi_offset 14, -4
2086:USB/core/usb_core.c ****   USB_OTG_DEPCTL_TypeDef  depctl;
2087:USB/core/usb_core.c ****   __IO uint32_t *depctl_addr;
2088:USB/core/usb_core.c ****   
2089:USB/core/usb_core.c ****   depctl.d32 = 0;
2090:USB/core/usb_core.c ****   
2091:USB/core/usb_core.c ****   /* Process for IN endpoint */
2092:USB/core/usb_core.c ****   if (ep->is_in == 1)
 2565              		.loc 1 2092 0
 2566 0002 4B78     		ldrb	r3, [r1, #1]	@ zero_extendqisi2
 2567 0004 012B     		cmp	r3, #1
 2568 0006 22D1     		bne	.L163
2093:USB/core/usb_core.c ****   {
2094:USB/core/usb_core.c ****     depctl_addr = &(pdev->regs.INEP_REGS[ep->num]->DIEPCTL);
 2569              		.loc 1 2094 0
 2570 0008 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 2571 000a 0433     		adds	r3, r3, #4
 2572 000c 00EB8303 		add	r3, r0, r3, lsl #2
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 83


 2573 0010 9C68     		ldr	r4, [r3, #8]
 2574              	.LVL306:
2095:USB/core/usb_core.c ****     depctl.d32 = USB_OTG_READ_REG32(depctl_addr);
 2575              		.loc 1 2095 0
 2576 0012 2368     		ldr	r3, [r4]
 2577              	.LVL307:
2096:USB/core/usb_core.c ****     
2097:USB/core/usb_core.c ****     if (Status == USB_OTG_EP_TX_STALL)  
 2578              		.loc 1 2097 0
 2579 0014 102A     		cmp	r2, #16
 2580 0016 02D1     		bne	.L164
2098:USB/core/usb_core.c ****     {
2099:USB/core/usb_core.c ****       USB_OTG_EPSetStall(pdev, ep); return;
 2581              		.loc 1 2099 0
 2582 0018 FFF7FEFF 		bl	USB_OTG_EPSetStall
 2583              	.LVL308:
 2584 001c 10BD     		pop	{r4, pc}
 2585              	.LVL309:
 2586              	.L164:
2100:USB/core/usb_core.c ****     }
2101:USB/core/usb_core.c ****     else if (Status == USB_OTG_EP_TX_NAK)
 2587              		.loc 1 2101 0
 2588 001e 202A     		cmp	r2, #32
 2589 0020 02D1     		bne	.L166
2102:USB/core/usb_core.c ****       depctl.b.snak = 1;
 2590              		.loc 1 2102 0
 2591 0022 43F00063 		orr	r3, r3, #134217728
 2592              	.LVL310:
 2593 0026 37E0     		b	.L167
 2594              	.LVL311:
 2595              	.L166:
2103:USB/core/usb_core.c ****     else if (Status == USB_OTG_EP_TX_VALID)
 2596              		.loc 1 2103 0
 2597 0028 302A     		cmp	r2, #48
 2598 002a 0CD1     		bne	.L168
2104:USB/core/usb_core.c ****     {
2105:USB/core/usb_core.c ****       if (depctl.b.stall == 1)
 2599              		.loc 1 2105 0
 2600 002c 13F4001F 		tst	r3, #2097152
 2601 0030 04D0     		beq	.L169
2106:USB/core/usb_core.c ****       {  
2107:USB/core/usb_core.c ****         ep->even_odd_frame = 0;
 2602              		.loc 1 2107 0
 2603 0032 0023     		movs	r3, #0
 2604              	.LVL312:
 2605 0034 4B71     		strb	r3, [r1, #5]
2108:USB/core/usb_core.c ****         USB_OTG_EPClearStall(pdev, ep);
 2606              		.loc 1 2108 0
 2607 0036 FFF7FEFF 		bl	USB_OTG_EPClearStall
 2608              	.LVL313:
2109:USB/core/usb_core.c ****         return;
 2609              		.loc 1 2109 0
 2610 003a 10BD     		pop	{r4, pc}
 2611              	.LVL314:
 2612              	.L169:
2110:USB/core/usb_core.c ****       }      
2111:USB/core/usb_core.c ****       depctl.b.cnak = 1;
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 84


2112:USB/core/usb_core.c ****       depctl.b.usbactep = 1; 
2113:USB/core/usb_core.c ****       depctl.b.epena = 1;
 2613              		.loc 1 2113 0
 2614 003c 43F00443 		orr	r3, r3, #-2080374784
 2615              	.LVL315:
 2616 0040 43F40043 		orr	r3, r3, #32768
 2617              	.LVL316:
 2618 0044 28E0     		b	.L167
 2619              	.LVL317:
 2620              	.L168:
2114:USB/core/usb_core.c ****     }
2115:USB/core/usb_core.c ****     else if (Status == USB_OTG_EP_TX_DIS)
 2621              		.loc 1 2115 0
 2622 0046 3ABB     		cbnz	r2, .L167
2116:USB/core/usb_core.c ****       depctl.b.usbactep = 0;
 2623              		.loc 1 2116 0
 2624 0048 6FF3CF33 		bfc	r3, #15, #1
 2625 004c 24E0     		b	.L167
 2626              	.LVL318:
 2627              	.L163:
2117:USB/core/usb_core.c ****   } 
2118:USB/core/usb_core.c ****   else /* Process for OUT endpoint */
2119:USB/core/usb_core.c ****   {
2120:USB/core/usb_core.c ****     depctl_addr = &(pdev->regs.OUTEP_REGS[ep->num]->DOEPCTL);
 2628              		.loc 1 2120 0
 2629 004e 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
 2630 0050 1433     		adds	r3, r3, #20
 2631 0052 00EB8303 		add	r3, r0, r3, lsl #2
 2632 0056 5C68     		ldr	r4, [r3, #4]
 2633              	.LVL319:
2121:USB/core/usb_core.c ****     depctl.d32 = USB_OTG_READ_REG32(depctl_addr);    
 2634              		.loc 1 2121 0
 2635 0058 2368     		ldr	r3, [r4]
 2636              	.LVL320:
2122:USB/core/usb_core.c ****     
2123:USB/core/usb_core.c ****     if (Status == USB_OTG_EP_RX_STALL)  {
 2637              		.loc 1 2123 0
 2638 005a B2F5805F 		cmp	r2, #4096
 2639 005e 02D1     		bne	.L170
2124:USB/core/usb_core.c ****       depctl.b.stall = 1;
 2640              		.loc 1 2124 0
 2641 0060 43F40013 		orr	r3, r3, #2097152
 2642              	.LVL321:
 2643 0064 18E0     		b	.L167
 2644              	.LVL322:
 2645              	.L170:
2125:USB/core/usb_core.c ****     }
2126:USB/core/usb_core.c ****     else if (Status == USB_OTG_EP_RX_NAK)
 2646              		.loc 1 2126 0
 2647 0066 B2F5005F 		cmp	r2, #8192
 2648 006a 02D1     		bne	.L171
2127:USB/core/usb_core.c ****       depctl.b.snak = 1;
 2649              		.loc 1 2127 0
 2650 006c 43F00063 		orr	r3, r3, #134217728
 2651              	.LVL323:
 2652 0070 12E0     		b	.L167
 2653              	.LVL324:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 85


 2654              	.L171:
2128:USB/core/usb_core.c ****     else if (Status == USB_OTG_EP_RX_VALID)
 2655              		.loc 1 2128 0
 2656 0072 B2F5405F 		cmp	r2, #12288
 2657 0076 0CD1     		bne	.L172
2129:USB/core/usb_core.c ****     {
2130:USB/core/usb_core.c ****       if (depctl.b.stall == 1)
 2658              		.loc 1 2130 0
 2659 0078 13F4001F 		tst	r3, #2097152
 2660 007c 04D0     		beq	.L173
2131:USB/core/usb_core.c ****       {  
2132:USB/core/usb_core.c ****         ep->even_odd_frame = 0;
 2661              		.loc 1 2132 0
 2662 007e 0023     		movs	r3, #0
 2663              	.LVL325:
 2664 0080 4B71     		strb	r3, [r1, #5]
2133:USB/core/usb_core.c ****         USB_OTG_EPClearStall(pdev, ep);
 2665              		.loc 1 2133 0
 2666 0082 FFF7FEFF 		bl	USB_OTG_EPClearStall
 2667              	.LVL326:
2134:USB/core/usb_core.c ****         return;
 2668              		.loc 1 2134 0
 2669 0086 10BD     		pop	{r4, pc}
 2670              	.LVL327:
 2671              	.L173:
2135:USB/core/usb_core.c ****       }  
2136:USB/core/usb_core.c ****       depctl.b.cnak = 1;
2137:USB/core/usb_core.c ****       depctl.b.usbactep = 1;    
2138:USB/core/usb_core.c ****       depctl.b.epena = 1;
 2672              		.loc 1 2138 0
 2673 0088 43F00443 		orr	r3, r3, #-2080374784
 2674              	.LVL328:
 2675 008c 43F40043 		orr	r3, r3, #32768
 2676              	.LVL329:
 2677 0090 02E0     		b	.L167
 2678              	.LVL330:
 2679              	.L172:
2139:USB/core/usb_core.c ****     }
2140:USB/core/usb_core.c ****     else if (Status == USB_OTG_EP_RX_DIS)
 2680              		.loc 1 2140 0
 2681 0092 0AB9     		cbnz	r2, .L167
2141:USB/core/usb_core.c ****     {
2142:USB/core/usb_core.c ****       depctl.b.usbactep = 0;    
 2682              		.loc 1 2142 0
 2683 0094 6FF3CF33 		bfc	r3, #15, #1
 2684              	.L167:
2143:USB/core/usb_core.c ****     }
2144:USB/core/usb_core.c ****   }
2145:USB/core/usb_core.c ****   
2146:USB/core/usb_core.c ****   USB_OTG_WRITE_REG32(depctl_addr, depctl.d32); 
 2685              		.loc 1 2146 0 discriminator 1
 2686 0098 2360     		str	r3, [r4]
 2687 009a 10BD     		pop	{r4, pc}
 2688              		.cfi_endproc
 2689              	.LFE159:
 2691              		.text
 2692              	.Letext0:
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 86


 2693              		.file 2 "d:\\gcc_arm\\5.4 2016q3\\arm-none-eabi\\include\\machine\\_default_types.h"
 2694              		.file 3 "d:\\gcc_arm\\5.4 2016q3\\arm-none-eabi\\include\\sys\\_stdint.h"
 2695              		.file 4 "USB/core/usb_regs.h"
 2696              		.file 5 "USB/core/usb_defines.h"
 2697              		.file 6 "USB/core/usb_core.h"
 2698              		.file 7 "USB/core/usb_bsp.h"
 2699              		.file 8 "F4_CORE/core_cm4.h"
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 87


DEFINED SYMBOLS
                            *ABS*:00000000 usb_core.c
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:22     .text.USB_OTG_EnableCommonInt:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:26     .text.USB_OTG_EnableCommonInt:00000000 USB_OTG_EnableCommonInt
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:54     .text.USB_OTG_EnableCommonInt:00000018 $d
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:59     .text.USB_OTG_CoreReset:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:63     .text.USB_OTG_CoreReset:00000000 USB_OTG_CoreReset
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:147    .text.USB_OTG_CoreReset:00000054 $d
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:152    .text.USB_OTG_WritePacket:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:157    .text.USB_OTG_WritePacket:00000000 USB_OTG_WritePacket
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:217    .text.USB_OTG_ReadPacket:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:222    .text.USB_OTG_ReadPacket:00000000 USB_OTG_ReadPacket
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:271    .text.USB_OTG_SelectCore:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:276    .text.USB_OTG_SelectCore:00000000 USB_OTG_SelectCore
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:442    .text.USB_OTG_SelectCore:000000d0 $d
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:447    .text.USB_OTG_CoreInit:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:452    .text.USB_OTG_CoreInit:00000000 USB_OTG_CoreInit
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:580    .text.USB_OTG_EnableGlobalInt:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:585    .text.USB_OTG_EnableGlobalInt:00000000 USB_OTG_EnableGlobalInt
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:606    .text.USB_OTG_DisableGlobalInt:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:611    .text.USB_OTG_DisableGlobalInt:00000000 USB_OTG_DisableGlobalInt
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:632    .text.USB_OTG_FlushTxFifo:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:637    .text.USB_OTG_FlushTxFifo:00000000 USB_OTG_FlushTxFifo
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:700    .text.USB_OTG_FlushTxFifo:00000044 $d
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:705    .text.USB_OTG_FlushRxFifo:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:710    .text.USB_OTG_FlushRxFifo:00000000 USB_OTG_FlushRxFifo
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:768    .text.USB_OTG_FlushRxFifo:0000003c $d
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:773    .text.USB_OTG_SetCurrentMode:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:778    .text.USB_OTG_SetCurrentMode:00000000 USB_OTG_SetCurrentMode
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:828    .text.USB_OTG_GetMode:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:833    .text.USB_OTG_GetMode:00000000 USB_OTG_GetMode
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:852    .text.USB_OTG_IsDeviceMode:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:857    .text.USB_OTG_IsDeviceMode:00000000 USB_OTG_IsDeviceMode
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:881    .text.USB_OTG_IsHostMode:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:886    .text.USB_OTG_IsHostMode:00000000 USB_OTG_IsHostMode
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:911    .text.USB_OTG_ReadCoreItr:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:916    .text.USB_OTG_ReadCoreItr:00000000 USB_OTG_ReadCoreItr
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:939    .text.USB_OTG_ReadOtgItr:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:944    .text.USB_OTG_ReadOtgItr:00000000 USB_OTG_ReadOtgItr
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:962    .text.USB_OTG_InitDevSpeed:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:967    .text.USB_OTG_InitDevSpeed:00000000 USB_OTG_InitDevSpeed
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:988    .text.USB_OTG_EnableDevInt:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:993    .text.USB_OTG_EnableDevInt:00000000 USB_OTG_EnableDevInt
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1052   .text.USB_OTG_CoreInitDev:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1057   .text.USB_OTG_CoreInitDev:00000000 USB_OTG_CoreInitDev
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1288   .text.USB_OTG_GetDeviceSpeed:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1293   .text.USB_OTG_GetDeviceSpeed:00000000 USB_OTG_GetDeviceSpeed
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1333   .text.USB_OTG_EP0Activate:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1338   .text.USB_OTG_EP0Activate:00000000 USB_OTG_EP0Activate
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1381   .text.USB_OTG_EPActivate:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1386   .text.USB_OTG_EPActivate:00000000 USB_OTG_EPActivate
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1477   .text.USB_OTG_EPDeactivate:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1482   .text.USB_OTG_EPDeactivate:00000000 USB_OTG_EPDeactivate
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1559   .text.USB_OTG_EPStartXfer:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1564   .text.USB_OTG_EPStartXfer:00000000 USB_OTG_EPStartXfer
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1793   .text.USB_OTG_EP0StartXfer:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1798   .text.USB_OTG_EP0StartXfer:00000000 USB_OTG_EP0StartXfer
ARM GAS  C:\Users\why\AppData\Local\Temp\cctq5OQp.s 			page 88


C:\Users\why\AppData\Local\Temp\cctq5OQp.s:1995   .text.USB_OTG_EPSetStall:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2000   .text.USB_OTG_EPSetStall:00000000 USB_OTG_EPSetStall
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2061   .text.USB_OTG_EPClearStall:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2066   .text.USB_OTG_EPClearStall:00000000 USB_OTG_EPClearStall
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2121   .text.USB_OTG_ReadDevAllOutEp_itr:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2126   .text.USB_OTG_ReadDevAllOutEp_itr:00000000 USB_OTG_ReadDevAllOutEp_itr
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2150   .text.USB_OTG_ReadDevOutEP_itr:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2155   .text.USB_OTG_ReadDevOutEP_itr:00000000 USB_OTG_ReadDevOutEP_itr
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2182   .text.USB_OTG_ReadDevAllInEPItr:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2187   .text.USB_OTG_ReadDevAllInEPItr:00000000 USB_OTG_ReadDevAllInEPItr
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2211   .text.USB_OTG_EP0_OutStart:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2216   .text.USB_OTG_EP0_OutStart:00000000 USB_OTG_EP0_OutStart
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2272   .text.USB_OTG_ActiveRemoteWakeup:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2277   .text.USB_OTG_ActiveRemoteWakeup:00000000 USB_OTG_ActiveRemoteWakeup
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2342   .text.USB_OTG_UngateClock:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2347   .text.USB_OTG_UngateClock:00000000 USB_OTG_UngateClock
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2382   .text.USB_OTG_StopDevice:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2387   .text.USB_OTG_StopDevice:00000000 USB_OTG_StopDevice
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2458   .text.USB_OTG_GetEPStatus:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2463   .text.USB_OTG_GetEPStatus:00000000 USB_OTG_GetEPStatus
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2548   .text.USB_OTG_SetEPStatus:00000000 $t
C:\Users\why\AppData\Local\Temp\cctq5OQp.s:2553   .text.USB_OTG_SetEPStatus:00000000 USB_OTG_SetEPStatus
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
USB_OTG_BSP_uDelay
USB_OTG_BSP_mDelay
