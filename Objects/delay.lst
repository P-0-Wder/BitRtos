ARM GAS  /tmp/cc02jhVt.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"delay.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.delay_init,"ax",%progbits
  18              		.align	1
  19              		.global	delay_init
  20              		.syntax unified
  21              		.thumb
  22              		.thumb_func
  23              		.fpu fpv4-sp-d16
  25              	delay_init:
  26              	.LFB123:
  27              		.file 1 "SYS/delay/delay.c"
   1:SYS/delay/delay.c **** #include "delay.h"
   2:SYS/delay/delay.c **** #include "runtime.h"
   3:SYS/delay/delay.c **** #include "stm32f4xx_it.h"
   4:SYS/delay/delay.c **** #include "misc.h"
   5:SYS/delay/delay.c **** 
   6:SYS/delay/delay.c **** #define configTICK_RATE_HZ 167
   7:SYS/delay/delay.c **** 
   8:SYS/delay/delay.c **** static volatile uint32_t us_time;
   9:SYS/delay/delay.c **** 
  10:SYS/delay/delay.c **** static u8 fac_us = 0;
  11:SYS/delay/delay.c **** static u16 fac_ms = 0;
  12:SYS/delay/delay.c **** 
  13:SYS/delay/delay.c **** void delay_init(void)
  14:SYS/delay/delay.c **** {
  28              		.loc 1 14 0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32 0000 08B5     		push	{r3, lr}
  33              	.LCFI0:
  34              		.cfi_def_cfa_offset 8
  35              		.cfi_offset 3, -8
  36              		.cfi_offset 14, -4
  15:SYS/delay/delay.c **** 	u32 reload;
  16:SYS/delay/delay.c **** 	SysTick_CLKSourceConfig(SysTick_CLKSource_HCLK);
  37              		.loc 1 16 0
  38 0002 0420     		movs	r0, #4
  39 0004 FFF7FEFF 		bl	SysTick_CLKSourceConfig
  40              	.LVL0:
  17:SYS/delay/delay.c **** 	fac_us = configTICK_RATE_HZ + 1;
  41              		.loc 1 17 0
ARM GAS  /tmp/cc02jhVt.s 			page 2


  42 0008 A822     		movs	r2, #168
  43 000a 074B     		ldr	r3, .L3
  44 000c 1A70     		strb	r2, [r3]
  45              	.LVL1:
  18:SYS/delay/delay.c **** 	reload = configTICK_RATE_HZ + 1;
  19:SYS/delay/delay.c **** 	reload *= 1000000 / configTICK_RATE_HZ;
  20:SYS/delay/delay.c **** 	fac_ms = 1000 / configTICK_RATE_HZ;
  21:SYS/delay/delay.c **** 	SysTick->CTRL |= SysTick_CTRL_TICKINT_Msk;
  46              		.loc 1 21 0
  47 000e 074B     		ldr	r3, .L3+4
  48 0010 1A68     		ldr	r2, [r3]
  49 0012 42F00202 		orr	r2, r2, #2
  50 0016 1A60     		str	r2, [r3]
  22:SYS/delay/delay.c **** 	SysTick->LOAD = reload;
  51              		.loc 1 22 0
  52 0018 054A     		ldr	r2, .L3+8
  53 001a 5A60     		str	r2, [r3, #4]
  23:SYS/delay/delay.c **** 	SysTick->CTRL |= SysTick_CTRL_ENABLE_Msk;
  54              		.loc 1 23 0
  55 001c 1A68     		ldr	r2, [r3]
  56 001e 42F00102 		orr	r2, r2, #1
  57 0022 1A60     		str	r2, [r3]
  58 0024 08BD     		pop	{r3, pc}
  59              	.L4:
  60 0026 00BF     		.align	2
  61              	.L3:
  62 0028 00000000 		.word	.LANCHOR0
  63 002c 10E000E0 		.word	-536813552
  64 0030 A0590F00 		.word	1005984
  65              		.cfi_endproc
  66              	.LFE123:
  68              		.section	.text.delay_us,"ax",%progbits
  69              		.align	1
  70              		.global	delay_us
  71              		.syntax unified
  72              		.thumb
  73              		.thumb_func
  74              		.fpu fpv4-sp-d16
  76              	delay_us:
  77              	.LFB124:
  24:SYS/delay/delay.c **** }
  25:SYS/delay/delay.c **** 
  26:SYS/delay/delay.c **** void delay_us(u32 nus)
  27:SYS/delay/delay.c **** {
  78              		.loc 1 27 0
  79              		.cfi_startproc
  80              		@ args = 0, pretend = 0, frame = 0
  81              		@ frame_needed = 0, uses_anonymous_args = 0
  82              		@ link register save eliminated.
  83              	.LVL2:
  84 0000 30B4     		push	{r4, r5}
  85              	.LCFI1:
  86              		.cfi_def_cfa_offset 8
  87              		.cfi_offset 4, -8
  88              		.cfi_offset 5, -4
  28:SYS/delay/delay.c **** 	nus *= 2;
  89              		.loc 1 28 0
ARM GAS  /tmp/cc02jhVt.s 			page 3


  90 0002 4000     		lsls	r0, r0, #1
  91              	.LVL3:
  29:SYS/delay/delay.c **** 	u32 ticks;
  30:SYS/delay/delay.c **** 	u32 told, tnow, tcnt = 0;
  31:SYS/delay/delay.c **** 	u32 reload = SysTick->LOAD; //LOAD的值
  92              		.loc 1 31 0
  93 0004 0C4A     		ldr	r2, .L12
  94 0006 5568     		ldr	r5, [r2, #4]
  95              	.LVL4:
  32:SYS/delay/delay.c **** 	ticks = nus * fac_us;		//需要的节拍数
  96              		.loc 1 32 0
  97 0008 0C4B     		ldr	r3, .L12+4
  98 000a 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
  99 000c 03FB00F0 		mul	r0, r3, r0
 100              	.LVL5:
  33:SYS/delay/delay.c **** 	told = SysTick->VAL;		//刚进入时的计数器值
 101              		.loc 1 33 0
 102 0010 9268     		ldr	r2, [r2, #8]
 103              	.LVL6:
  30:SYS/delay/delay.c **** 	u32 reload = SysTick->LOAD; //LOAD的值
 104              		.loc 1 30 0
 105 0012 0021     		movs	r1, #0
 106 0014 05E0     		b	.L6
 107              	.LVL7:
 108              	.L7:
  34:SYS/delay/delay.c **** 	while (1)
  35:SYS/delay/delay.c **** 	{
  36:SYS/delay/delay.c **** 		tnow = SysTick->VAL;
  37:SYS/delay/delay.c **** 		if (tnow != told)
  38:SYS/delay/delay.c **** 		{
  39:SYS/delay/delay.c **** 			if (tnow < told)
  40:SYS/delay/delay.c **** 				tcnt += told - tnow; //这里注意一下SYSTICK是一个递减的计数器就可以了.
  41:SYS/delay/delay.c **** 			else
  42:SYS/delay/delay.c **** 				tcnt += reload - tnow + told;
 109              		.loc 1 42 0
 110 0016 EC1A     		subs	r4, r5, r3
 111 0018 2244     		add	r2, r2, r4
 112              	.LVL8:
 113 001a 1144     		add	r1, r1, r2
 114              	.LVL9:
 115              	.L8:
  43:SYS/delay/delay.c **** 			told = tnow;
 116              		.loc 1 43 0
 117 001c 1A46     		mov	r2, r3
  44:SYS/delay/delay.c **** 			if (tcnt >= ticks)
 118              		.loc 1 44 0
 119 001e 8142     		cmp	r1, r0
 120 0020 07D2     		bcs	.L11
 121              	.LVL10:
 122              	.L6:
  36:SYS/delay/delay.c **** 		if (tnow != told)
 123              		.loc 1 36 0
 124 0022 054B     		ldr	r3, .L12
 125 0024 9B68     		ldr	r3, [r3, #8]
 126              	.LVL11:
  37:SYS/delay/delay.c **** 		{
 127              		.loc 1 37 0
ARM GAS  /tmp/cc02jhVt.s 			page 4


 128 0026 9A42     		cmp	r2, r3
 129 0028 FBD0     		beq	.L6
  39:SYS/delay/delay.c **** 				tcnt += told - tnow; //这里注意一下SYSTICK是一个递减的计数器就可以了.
 130              		.loc 1 39 0
 131 002a F4D9     		bls	.L7
  40:SYS/delay/delay.c **** 			else
 132              		.loc 1 40 0
 133 002c D21A     		subs	r2, r2, r3
 134              	.LVL12:
 135 002e 1144     		add	r1, r1, r2
 136              	.LVL13:
 137 0030 F4E7     		b	.L8
 138              	.LVL14:
 139              	.L11:
  45:SYS/delay/delay.c **** 				break; //时间超过/等于要延迟的时间,则退出.
  46:SYS/delay/delay.c **** 		}
  47:SYS/delay/delay.c **** 	};
  48:SYS/delay/delay.c **** }
 140              		.loc 1 48 0
 141 0032 30BC     		pop	{r4, r5}
 142              	.LCFI2:
 143              		.cfi_restore 5
 144              		.cfi_restore 4
 145              		.cfi_def_cfa_offset 0
 146              	.LVL15:
 147 0034 7047     		bx	lr
 148              	.L13:
 149 0036 00BF     		.align	2
 150              	.L12:
 151 0038 10E000E0 		.word	-536813552
 152 003c 00000000 		.word	.LANCHOR0
 153              		.cfi_endproc
 154              	.LFE124:
 156              		.section	.text.delay_ms,"ax",%progbits
 157              		.align	1
 158              		.global	delay_ms
 159              		.syntax unified
 160              		.thumb
 161              		.thumb_func
 162              		.fpu fpv4-sp-d16
 164              	delay_ms:
 165              	.LFB125:
  49:SYS/delay/delay.c **** 
  50:SYS/delay/delay.c **** void delay_ms(uint32_t MS)
  51:SYS/delay/delay.c **** {
 166              		.loc 1 51 0
 167              		.cfi_startproc
 168              		@ args = 0, pretend = 0, frame = 0
 169              		@ frame_needed = 0, uses_anonymous_args = 0
 170              	.LVL16:
 171 0000 10B5     		push	{r4, lr}
 172              	.LCFI3:
 173              		.cfi_def_cfa_offset 8
 174              		.cfi_offset 4, -8
 175              		.cfi_offset 14, -4
  52:SYS/delay/delay.c **** 	while (MS--)
 176              		.loc 1 52 0
ARM GAS  /tmp/cc02jhVt.s 			page 5


 177 0002 04E0     		b	.L15
 178              	.LVL17:
 179              	.L16:
  53:SYS/delay/delay.c **** 	{
  54:SYS/delay/delay.c **** 		delay_us(REAL_MS);
 180              		.loc 1 54 0
 181 0004 4FF47A70 		mov	r0, #1000
 182 0008 FFF7FEFF 		bl	delay_us
 183              	.LVL18:
  52:SYS/delay/delay.c **** 	while (MS--)
 184              		.loc 1 52 0
 185 000c 2046     		mov	r0, r4
 186              	.LVL19:
 187              	.L15:
 188 000e 441E     		subs	r4, r0, #1
 189              	.LVL20:
 190 0010 0028     		cmp	r0, #0
 191 0012 F7D1     		bne	.L16
  55:SYS/delay/delay.c **** 	}
  56:SYS/delay/delay.c **** }
 192              		.loc 1 56 0
 193 0014 10BD     		pop	{r4, pc}
 194              		.cfi_endproc
 195              	.LFE125:
 197              		.section	.bss.fac_us,"aw",%nobits
 198              		.set	.LANCHOR0,. + 0
 201              	fac_us:
 202 0000 00       		.space	1
 203              		.section	.bss.us_time,"aw",%nobits
 204              		.align	2
 207              	us_time:
 208 0000 00000000 		.space	4
 209              		.text
 210              	.Letext0:
 211              		.file 2 "/usr/include/newlib/machine/_default_types.h"
 212              		.file 3 "/usr/include/newlib/sys/_stdint.h"
 213              		.file 4 "F4_CORE/core_cm4.h"
 214              		.file 5 "USER/system_stm32f4xx.h"
 215              		.file 6 "USER/stm32f4xx.h"
 216              		.file 7 "USER/stm32f4xx_it.h"
 217              		.file 8 "FWLIB/inc/misc.h"
ARM GAS  /tmp/cc02jhVt.s 			page 6


DEFINED SYMBOLS
                            *ABS*:0000000000000000 delay.c
     /tmp/cc02jhVt.s:18     .text.delay_init:0000000000000000 $t
     /tmp/cc02jhVt.s:25     .text.delay_init:0000000000000000 delay_init
     /tmp/cc02jhVt.s:62     .text.delay_init:0000000000000028 $d
     /tmp/cc02jhVt.s:69     .text.delay_us:0000000000000000 $t
     /tmp/cc02jhVt.s:76     .text.delay_us:0000000000000000 delay_us
     /tmp/cc02jhVt.s:151    .text.delay_us:0000000000000038 $d
     /tmp/cc02jhVt.s:157    .text.delay_ms:0000000000000000 $t
     /tmp/cc02jhVt.s:164    .text.delay_ms:0000000000000000 delay_ms
     /tmp/cc02jhVt.s:201    .bss.fac_us:0000000000000000 fac_us
     /tmp/cc02jhVt.s:202    .bss.fac_us:0000000000000000 $d
     /tmp/cc02jhVt.s:204    .bss.us_time:0000000000000000 $d
     /tmp/cc02jhVt.s:207    .bss.us_time:0000000000000000 us_time
                     .debug_frame:0000000000000010 $d

UNDEFINED SYMBOLS
SysTick_CLKSourceConfig
