ARM GAS  /tmp/ccxDNfTT.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"delay.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.delay_init,"ax",%progbits
  18              		.align	1
  19              		.global	delay_init
  20              		.arch armv7e-m
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  24              		.fpu fpv4-sp-d16
  26              	delay_init:
  27              	.LFB123:
  28              		.file 1 "SYS/delay/delay.c"
   1:SYS/delay/delay.c **** #include "delay.h"
   2:SYS/delay/delay.c **** #include "runtime.h"
   3:SYS/delay/delay.c **** #include "stm32f4xx_it.h"
   4:SYS/delay/delay.c **** #include "misc.h"
   5:SYS/delay/delay.c **** 
   6:SYS/delay/delay.c **** #define configTICK_RATE_HZ 167
   7:SYS/delay/delay.c **** 
   8:SYS/delay/delay.c **** static volatile uint32_t us_time;
   9:SYS/delay/delay.c **** 
  10:SYS/delay/delay.c **** static u8 fac_us = 0;
  11:SYS/delay/delay.c **** static u16 fac_ms = 0;
  12:SYS/delay/delay.c **** 
  13:SYS/delay/delay.c **** void delay_init(void)
  14:SYS/delay/delay.c **** {
  29              		.loc 1 14 1 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33 0000 08B5     		push	{r3, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 8
  36              		.cfi_offset 3, -8
  37              		.cfi_offset 14, -4
  15:SYS/delay/delay.c **** 	u32 reload;
  38              		.loc 1 15 2 view .LVU1
  16:SYS/delay/delay.c **** 	SysTick_CLKSourceConfig(SysTick_CLKSource_HCLK);
  39              		.loc 1 16 2 view .LVU2
  40 0002 0420     		movs	r0, #4
  41 0004 FFF7FEFF 		bl	SysTick_CLKSourceConfig
  42              	.LVL0:
ARM GAS  /tmp/ccxDNfTT.s 			page 2


  17:SYS/delay/delay.c **** 	fac_us = configTICK_RATE_HZ + 1;
  43              		.loc 1 17 2 view .LVU3
  44              		.loc 1 17 9 is_stmt 0 view .LVU4
  45 0008 074B     		ldr	r3, .L3
  46 000a A822     		movs	r2, #168
  47 000c 1A70     		strb	r2, [r3]
  18:SYS/delay/delay.c **** 	reload = configTICK_RATE_HZ + 1;
  48              		.loc 1 18 2 is_stmt 1 view .LVU5
  49              	.LVL1:
  19:SYS/delay/delay.c **** 	reload *= 1000000 / configTICK_RATE_HZ;
  50              		.loc 1 19 2 view .LVU6
  20:SYS/delay/delay.c **** 	fac_ms = 1000 / configTICK_RATE_HZ;
  51              		.loc 1 20 2 view .LVU7
  21:SYS/delay/delay.c **** 	SysTick->CTRL |= SysTick_CTRL_TICKINT_Msk;
  52              		.loc 1 21 2 view .LVU8
  53              		.loc 1 21 16 is_stmt 0 view .LVU9
  54 000e 074B     		ldr	r3, .L3+4
  55 0010 1A68     		ldr	r2, [r3]
  56 0012 42F00202 		orr	r2, r2, #2
  57 0016 1A60     		str	r2, [r3]
  22:SYS/delay/delay.c **** 	SysTick->LOAD = reload;
  58              		.loc 1 22 2 is_stmt 1 view .LVU10
  59              		.loc 1 22 16 is_stmt 0 view .LVU11
  60 0018 054A     		ldr	r2, .L3+8
  61 001a 5A60     		str	r2, [r3, #4]
  23:SYS/delay/delay.c **** 	SysTick->CTRL |= SysTick_CTRL_ENABLE_Msk;
  62              		.loc 1 23 2 is_stmt 1 view .LVU12
  63              		.loc 1 23 16 is_stmt 0 view .LVU13
  64 001c 1A68     		ldr	r2, [r3]
  65 001e 42F00102 		orr	r2, r2, #1
  66 0022 1A60     		str	r2, [r3]
  24:SYS/delay/delay.c **** }
  67              		.loc 1 24 1 view .LVU14
  68 0024 08BD     		pop	{r3, pc}
  69              	.L4:
  70 0026 00BF     		.align	2
  71              	.L3:
  72 0028 00000000 		.word	.LANCHOR0
  73 002c 10E000E0 		.word	-536813552
  74 0030 A0590F00 		.word	1005984
  75              		.cfi_endproc
  76              	.LFE123:
  78              		.section	.text.delay_us,"ax",%progbits
  79              		.align	1
  80              		.global	delay_us
  81              		.syntax unified
  82              		.thumb
  83              		.thumb_func
  84              		.fpu fpv4-sp-d16
  86              	delay_us:
  87              	.LVL2:
  88              	.LFB124:
  25:SYS/delay/delay.c **** 
  26:SYS/delay/delay.c **** void delay_us(u32 nus)
  27:SYS/delay/delay.c **** {
  89              		.loc 1 27 1 is_stmt 1 view -0
  90              		.cfi_startproc
ARM GAS  /tmp/ccxDNfTT.s 			page 3


  91              		@ args = 0, pretend = 0, frame = 0
  92              		@ frame_needed = 0, uses_anonymous_args = 0
  93              		@ link register save eliminated.
  94              		.loc 1 27 1 is_stmt 0 view .LVU16
  95 0000 30B4     		push	{r4, r5}
  96              	.LCFI1:
  97              		.cfi_def_cfa_offset 8
  98              		.cfi_offset 4, -8
  99              		.cfi_offset 5, -4
  28:SYS/delay/delay.c **** 	nus *= 2;
 100              		.loc 1 28 2 is_stmt 1 view .LVU17
 101              	.LVL3:
  29:SYS/delay/delay.c **** 	u32 ticks;
 102              		.loc 1 29 2 view .LVU18
  30:SYS/delay/delay.c **** 	u32 told, tnow, tcnt = 0;
 103              		.loc 1 30 2 view .LVU19
  31:SYS/delay/delay.c **** 	u32 reload = SysTick->LOAD; //LOAD的值
 104              		.loc 1 31 2 view .LVU20
 105              		.loc 1 31 6 is_stmt 0 view .LVU21
 106 0002 0D4A     		ldr	r2, .L12
 107 0004 5568     		ldr	r5, [r2, #4]
 108              	.LVL4:
  32:SYS/delay/delay.c **** 	ticks = nus * fac_us;		//需要的节拍数
 109              		.loc 1 32 2 is_stmt 1 view .LVU22
 110              		.loc 1 32 14 is_stmt 0 view .LVU23
 111 0006 0D4B     		ldr	r3, .L12+4
 112 0008 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 113              		.loc 1 32 8 view .LVU24
 114 000a 00FB03F3 		mul	r3, r0, r3
 115 000e 5C00     		lsls	r4, r3, #1
 116              	.LVL5:
  33:SYS/delay/delay.c **** 	told = SysTick->VAL;		//刚进入时的计数器值
 117              		.loc 1 33 2 is_stmt 1 view .LVU25
 118              		.loc 1 33 7 is_stmt 0 view .LVU26
 119 0010 9268     		ldr	r2, [r2, #8]
 120              	.LVL6:
  30:SYS/delay/delay.c **** 	u32 reload = SysTick->LOAD; //LOAD的值
 121              		.loc 1 30 18 view .LVU27
 122 0012 0021     		movs	r1, #0
 123 0014 05E0     		b	.L6
 124              	.LVL7:
 125              	.L7:
  34:SYS/delay/delay.c **** 	while (1)
  35:SYS/delay/delay.c **** 	{
  36:SYS/delay/delay.c **** 		tnow = SysTick->VAL;
  37:SYS/delay/delay.c **** 		if (tnow != told)
  38:SYS/delay/delay.c **** 		{
  39:SYS/delay/delay.c **** 			if (tnow < told)
  40:SYS/delay/delay.c **** 				tcnt += told - tnow; //这里注意一下SYSTICK是一个递减的计数器就可以了.
  41:SYS/delay/delay.c **** 			else
  42:SYS/delay/delay.c **** 				tcnt += reload - tnow + told;
 126              		.loc 1 42 5 is_stmt 1 view .LVU28
 127              		.loc 1 42 20 is_stmt 0 view .LVU29
 128 0016 E81A     		subs	r0, r5, r3
 129              		.loc 1 42 27 view .LVU30
 130 0018 0244     		add	r2, r2, r0
 131              	.LVL8:
ARM GAS  /tmp/ccxDNfTT.s 			page 4


 132              		.loc 1 42 10 view .LVU31
 133 001a 1144     		add	r1, r1, r2
 134              	.LVL9:
 135              	.L8:
  43:SYS/delay/delay.c **** 			told = tnow;
 136              		.loc 1 43 4 is_stmt 1 view .LVU32
  44:SYS/delay/delay.c **** 			if (tcnt >= ticks)
 137              		.loc 1 44 4 view .LVU33
  43:SYS/delay/delay.c **** 			told = tnow;
 138              		.loc 1 43 9 is_stmt 0 view .LVU34
 139 001c 1A46     		mov	r2, r3
 140              		.loc 1 44 7 view .LVU35
 141 001e A142     		cmp	r1, r4
 142 0020 07D2     		bcs	.L11
 143              	.LVL10:
 144              	.L6:
  34:SYS/delay/delay.c **** 	while (1)
 145              		.loc 1 34 2 is_stmt 1 view .LVU36
  36:SYS/delay/delay.c **** 		if (tnow != told)
 146              		.loc 1 36 3 view .LVU37
  36:SYS/delay/delay.c **** 		if (tnow != told)
 147              		.loc 1 36 8 is_stmt 0 view .LVU38
 148 0022 054B     		ldr	r3, .L12
 149 0024 9B68     		ldr	r3, [r3, #8]
 150              	.LVL11:
  37:SYS/delay/delay.c **** 		{
 151              		.loc 1 37 3 is_stmt 1 view .LVU39
  37:SYS/delay/delay.c **** 		{
 152              		.loc 1 37 6 is_stmt 0 view .LVU40
 153 0026 9A42     		cmp	r2, r3
 154 0028 FBD0     		beq	.L6
  39:SYS/delay/delay.c **** 				tcnt += told - tnow; //这里注意一下SYSTICK是一个递减的计数器就可以了.
 155              		.loc 1 39 4 is_stmt 1 view .LVU41
  39:SYS/delay/delay.c **** 				tcnt += told - tnow; //这里注意一下SYSTICK是一个递减的计数器就可以了.
 156              		.loc 1 39 7 is_stmt 0 view .LVU42
 157 002a F4D9     		bls	.L7
  40:SYS/delay/delay.c **** 			else
 158              		.loc 1 40 5 is_stmt 1 view .LVU43
  40:SYS/delay/delay.c **** 			else
 159              		.loc 1 40 18 is_stmt 0 view .LVU44
 160 002c D21A     		subs	r2, r2, r3
 161              	.LVL12:
  40:SYS/delay/delay.c **** 			else
 162              		.loc 1 40 10 view .LVU45
 163 002e 1144     		add	r1, r1, r2
 164              	.LVL13:
  40:SYS/delay/delay.c **** 			else
 165              		.loc 1 40 10 view .LVU46
 166 0030 F4E7     		b	.L8
 167              	.LVL14:
 168              	.L11:
  45:SYS/delay/delay.c **** 				break; //时间超过/等于要延迟的时间,则退出.
  46:SYS/delay/delay.c **** 		}
  47:SYS/delay/delay.c **** 	};
  48:SYS/delay/delay.c **** }
 169              		.loc 1 48 1 view .LVU47
 170 0032 30BC     		pop	{r4, r5}
ARM GAS  /tmp/ccxDNfTT.s 			page 5


 171              	.LCFI2:
 172              		.cfi_restore 5
 173              		.cfi_restore 4
 174              		.cfi_def_cfa_offset 0
 175              	.LVL15:
 176              		.loc 1 48 1 view .LVU48
 177 0034 7047     		bx	lr
 178              	.L13:
 179 0036 00BF     		.align	2
 180              	.L12:
 181 0038 10E000E0 		.word	-536813552
 182 003c 00000000 		.word	.LANCHOR0
 183              		.cfi_endproc
 184              	.LFE124:
 186              		.section	.text.delay_ms,"ax",%progbits
 187              		.align	1
 188              		.global	delay_ms
 189              		.syntax unified
 190              		.thumb
 191              		.thumb_func
 192              		.fpu fpv4-sp-d16
 194              	delay_ms:
 195              	.LVL16:
 196              	.LFB125:
  49:SYS/delay/delay.c **** 
  50:SYS/delay/delay.c **** void delay_ms(uint32_t MS)
  51:SYS/delay/delay.c **** {
 197              		.loc 1 51 1 is_stmt 1 view -0
 198              		.cfi_startproc
 199              		@ args = 0, pretend = 0, frame = 0
 200              		@ frame_needed = 0, uses_anonymous_args = 0
 201              		.loc 1 51 1 is_stmt 0 view .LVU50
 202 0000 10B5     		push	{r4, lr}
 203              	.LCFI3:
 204              		.cfi_def_cfa_offset 8
 205              		.cfi_offset 4, -8
 206              		.cfi_offset 14, -4
  52:SYS/delay/delay.c **** 	while (MS--)
 207              		.loc 1 52 2 is_stmt 1 view .LVU51
 208              	.L15:
 209              		.loc 1 52 11 is_stmt 0 view .LVU52
 210 0002 441E     		subs	r4, r0, #1
 211              	.LVL17:
 212              		.loc 1 52 8 view .LVU53
 213 0004 28B1     		cbz	r0, .L18
  53:SYS/delay/delay.c **** 	{
  54:SYS/delay/delay.c **** 		delay_us(REAL_MS);
 214              		.loc 1 54 3 is_stmt 1 view .LVU54
 215 0006 4FF47A70 		mov	r0, #1000
 216 000a FFF7FEFF 		bl	delay_us
 217              	.LVL18:
  52:SYS/delay/delay.c **** 	while (MS--)
 218              		.loc 1 52 11 is_stmt 0 view .LVU55
 219 000e 2046     		mov	r0, r4
 220 0010 F7E7     		b	.L15
 221              	.L18:
  55:SYS/delay/delay.c **** 	}
ARM GAS  /tmp/ccxDNfTT.s 			page 6


  56:SYS/delay/delay.c **** }
 222              		.loc 1 56 1 view .LVU56
 223 0012 10BD     		pop	{r4, pc}
 224              		.loc 1 56 1 view .LVU57
 225              		.cfi_endproc
 226              	.LFE125:
 228              		.section	.bss.fac_us,"aw",%nobits
 229              		.set	.LANCHOR0,. + 0
 232              	fac_us:
 233 0000 00       		.space	1
 234              		.section	.bss.us_time,"aw",%nobits
 235              		.align	2
 238              	us_time:
 239 0000 00000000 		.space	4
 240              		.text
 241              	.Letext0:
 242              		.file 2 "/home/bt0/stm32/compile-tool/gcc-arm-none-eabi-8-2018-q4-major-linux/gcc-arm-none-eabi-8-
 243              		.file 3 "/home/bt0/stm32/compile-tool/gcc-arm-none-eabi-8-2018-q4-major-linux/gcc-arm-none-eabi-8-
 244              		.file 4 "F4_CORE/core_cm4.h"
 245              		.file 5 "USER/system_stm32f4xx.h"
 246              		.file 6 "USER/stm32f4xx.h"
 247              		.file 7 "USER/stm32f4xx_it.h"
 248              		.file 8 "FWLIB/inc/misc.h"
ARM GAS  /tmp/ccxDNfTT.s 			page 7


DEFINED SYMBOLS
                            *ABS*:0000000000000000 delay.c
     /tmp/ccxDNfTT.s:18     .text.delay_init:0000000000000000 $t
     /tmp/ccxDNfTT.s:26     .text.delay_init:0000000000000000 delay_init
     /tmp/ccxDNfTT.s:72     .text.delay_init:0000000000000028 $d
     /tmp/ccxDNfTT.s:79     .text.delay_us:0000000000000000 $t
     /tmp/ccxDNfTT.s:86     .text.delay_us:0000000000000000 delay_us
     /tmp/ccxDNfTT.s:181    .text.delay_us:0000000000000038 $d
     /tmp/ccxDNfTT.s:187    .text.delay_ms:0000000000000000 $t
     /tmp/ccxDNfTT.s:194    .text.delay_ms:0000000000000000 delay_ms
     /tmp/ccxDNfTT.s:232    .bss.fac_us:0000000000000000 fac_us
     /tmp/ccxDNfTT.s:233    .bss.fac_us:0000000000000000 $d
     /tmp/ccxDNfTT.s:235    .bss.us_time:0000000000000000 $d
     /tmp/ccxDNfTT.s:238    .bss.us_time:0000000000000000 us_time

UNDEFINED SYMBOLS
SysTick_CLKSourceConfig
